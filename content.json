{"meta":{"title":"Clarence的博客","subtitle":"Hard is the road of the world. Learning! -- Blog of Clarence","description":"Hard is the road of the world. Learning! -- Blog of Clarence","author":"Clarence Pan","url":"http://www.clarencep.com"},"pages":[{"title":"","date":"2017-10-25T03:09:10.852Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"about-me/index.html","permalink":"http://www.clarencep.com/about-me/index.html","excerpt":"","text":"Abount Me本人姓甚名谁暂不可泄露。此乃某放置技术博文之处。初学乍道，若有不正住处欢迎诸位多多谅解，多多指教: GitHub Cnblogs"},{"title":"","date":"2017-10-25T03:09:10.852Z","updated":"2017-10-25T03:09:10.852Z","comments":false,"path":"categories/index.html","permalink":"http://www.clarencep.com/categories/index.html","excerpt":"","text":""},{"title":"","date":"2017-10-25T03:09:10.852Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"fe-lab/index.html","permalink":"http://www.clarencep.com/fe-lab/index.html","excerpt":"","text":"The site has moved here."},{"title":"","date":"2017-10-25T03:09:10.852Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"lib/SourceCodePro.css","permalink":"http://www.clarencep.com/lib/SourceCodePro.css","excerpt":"","text":"/* latin-ext */ @font-face { font-family: 'Source Code Pro'; font-style: normal; font-weight: 400; src: local('Source Code Pro'), local('SourceCodePro-Regular'), url(/lib/SourceCodePro.woff2) format('woff2'); unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF; } /* latin */ @font-face { font-family: 'Source Code Pro'; font-style: normal; font-weight: 400; src: local('Source Code Pro'), local('SourceCodePro-Regular'), url(/lib/SourceCodePro.woff2) format('woff2'); unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000; }"},{"title":"","date":"2017-10-25T03:09:10.856Z","updated":"2017-10-25T03:09:10.856Z","comments":true,"path":"lib/duoshuo-embed.min.js","permalink":"http://www.clarencep.com/lib/duoshuo-embed.min.js","excerpt":"","text":"!function(e,t,s){function a(){return c.short_name?g+\"//\"+c.short_name+\".\"+S.DOMAIN:S.REMOTE} function i(){function t(){for(var t;t=y.shift();){var a=t.url,i=new s(t.title,{dir:\"auto\",icon:t.iconUrl,body:t.body});try{i.onclick=function(){e.focus(),h.href=a,i.close()}}catch(r){} setTimeout(function(){i.close&&i.close()},8e3)}} var s=e.Notification;\"Notification\" in e&&\"denied\"!==s.permission&&(\"granted\"===s.permission&&t(),s.requestPermission(function(e){\"granted\"===e&&t()}))} function r(){return 0==nt.data.user_id} function n(e){S.theme=e,\"none\"!=e&&o.injectStylesheet(S.STATIC_URL+\"/styles/embed\"+(e?\".\"+e+\".css?\"+M[e]:\".\"+short_name)+\".css\")} var o={},d=t.getElementsByTagName(\"head\")[0]||t.getElementsByTagName(\"body\")[0];if(o.extend=function(e,t){for(var s in t)e[s]=t[s];return e},o.injectScript=function(a,i){var r=t.createElement(\"script\"),n=t.head||t.getElementsByTagName(\"head\")[0]||t.documentElement;r.type=\"text/javascript\",r.src=a,r.async=\"async\",r.charset=\"utf-8\",i&&(r.onload=r.onreadystatechange=function(t,a){var o=a||!r.readyState||/loaded|complete/.test(r.readyState);o&&(r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),r=s,a||i.call(e))}),n.insertBefore(r,n.firstChild)},o.injectStylesheet=function(e){var s=t.createElement(\"link\");s.type=\"text/css\",s.rel=\"stylesheet\",s.href=e,d.appendChild(s)},o.injectStyle=function(e){var s=t.createElement(\"style\");return s.type=\"text/css\",d.appendChild(s),e=e.replace(/\\}/g,\"}\\n\"),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),s},o.getCookie=function(e){for(var a,i,r,n=\" \"+e+\"=\",o=t.cookie.split(\";\"),d=0;d=0&&i+n.length==(r=a.indexOf(\"=\")+1))return decodeURIComponent(a.substring(r,a.length).replace(/\\+/g,\"\"));return s},o.param=function(e){var t=[];for(var a in e)e[a]!=s&&t.push(a+\"=\"+encodeURIComponent(e[a]));return t.join(\"&\")},o.cssProperty=function(e,s){var a=(t.body||t.documentElement).style;if(\"undefined\"==typeof a)return !1;if(\"string\"==typeof a[e])return s?e:!0;for(var i=[\"Moz\",\"Webkit\",\"ms\"],e=e.charAt(0).toUpperCase()+e.substr(1),r=0;r=0&&(t+=''+(e.index+1)+z.floor+\"\"),t+=''+e.post.message,e.index>=0&&(t+=' i;)a=s[i+=1],t+=''+S.sourceName[a]+\"\";return t+=\"\",e.options.deny_anonymous||(t+='作为游客留言名字(必填)',e.options.require_guest_email&&(t+='邮箱(必填)'),e.options.require_guest_url&&(t+='网址(可选)'),t+='发布'),t},et[\"dialog-ask-for-auth\"]=function(){var e='社交帐号登录'+et.serviceList(X)+''+et.serviceList(K)+\"\";return e},et[\"dialog-bind-more\"]=function(){var e='绑定更多帐号'+et.serviceBindList(X)+''+et.serviceBindList(K)+'';return e},et[\"dialog-qrcode\"]=function(e){var t='微信扫一扫，分享到朋友圈';return t},et[\"dialog-reposts\"]=function(e){var t='转发到微博@'+u(e.post.theAuthor.name)+\": \"+e.post.message+\"\"+tt({post_id:e.post.post_id})+''+u(e.repostMessage)+'';return t+='',e.service?t+=tt({\"service[]\":e.service}):(t+='0?\"已喜欢\":\"喜欢\",t+='取消喜欢'},et.notify=function(e){var t='d;)o=n[d+=1],1==d&&s.parents.length>2&&(t+='还有'+(s.parents.length-2)+\"条评论\"),t+=et.ctxPost({post:o,index:d,hidden:d&&d=i.max_depth&&(!i.show_context||i.max_depth>1)&&s.parent_id&&lt[s.parent_id]&&(t+=''+z.reply_to+u(lt[s.parent_id].toJSON().author.name)+\": \"),t+=s.message+''+z.reply+\"\"+et.likePost(s)+''+z.repost+''+z.report+\"\",s.privileges[\"delete\"]&&(t+=''+z[\"delete\"]+\"\")):(\"qqt\"==s.source||\"weibo\"==s.source)&&(t+=''+z.comments,s.type.match(/\\-comment$/)||(t+='('+s.comments+\")\"),t+=''+z.reposts,s.type.match(/\\-comment$/)||(t+='('+s.reposts+\")\"),t+=\"\"),t+=\"1&&(s.childrenArray||s.children)&&\"weibo\"!=s.source&&\"qqt\"!=s.source){t+='';var c=lt.getJSON(s.childrenArray||s.children);if(c)for(var s,d=-1,p=c.length-1;p>d;)s=c[d+=1],t+=et.post({post:s,options:i});t+=\"\"} return t+=\"\"},et.postListHead=function(e){var t=''+z.latest+''+z.earliest+''+z.hottest+'';return e.options.show_reposts&&e.thread.reposts&&(t+=''),t+=\" \",e.options.show_weibo&&e.thread.weibo_reposts&&(t+=''),t+=\" \",e.options.show_qqt&&e.thread.qqt_reposts&&(t+=''),t+=\"\"},et.recentVisitors=function(e){var t=\"\",s=e.response;if(s)for(var a,i=-1,r=s.length-1;r>i;)a=s[i+=1],t+=''+et.avatar(a,e.options.avatar_size)+\"\";return t},et[\"related-read\"]=function(e){var t=\"\";if(e&&e.length){t+='头条推荐 ';var s=e;if(s)for(var a,i=-1,r=s.length-1;r>i;){if(a=s[i+=1],t+=' ',3==a.imgs.length){t+=\" \"+a.title+' ';var n=a.imgs;if(n)for(var o,d=-1,l=n.length-1;l>d;)o=n[d+=1],t+=' ';t+=' ',1==a.type&&(t+=' 打开头条阅读 '),t+=' '}else t+=' i;)a=s[i+=1],t+=''+S.serviceNames[a],nt.data.social_uid[a]&&(t+=' '),t+=\"\";return t},et.serviceList=function(e){var t=\"\",s=e;if(s)for(var a,i=-1,r=s.length-1;r>i;)a=s[i+=1],t+=''+S.serviceNames[a]+\"\";return t},et.shareWidget=function(e){var t=' ',s=e.services;if(s)for(var a,i=-1,r=s.length-1;r>i;)a=s[i+=1],t+=' '+S.sourceName[a]+\" \";return t+=' '+e.copyright+\"\"},et.smiliesTooltip=function(e){var t='';for(var s in e)t+=\"\"+s+\"\";return t+=''},et.toolbar=function(){var e=' 帐号管理绑定更多'+u(z.settings)+'登出';return e+=nt.data.url?''+u(nt.data.name)+\"\":''+u(nt.data.name)+\"\",e+=''},et.topThreads=function(e){var t=\"\",s=e.response;if(s)for(var a,i=-1,r=s.length-1;r>i;)a=s[i+=1],t+=''+u(a.title)+\"\";return t},et.topUsers=function(e){var t=\"\",s=e.response;if(s)for(var a,i=-1,r=s.length-1;r>i;)a=s[i+=1],t+=''+et.avatar(a,e.options.avatar_size)+\"\"+u(a.name)+\"\";return t},et.userInfo=function(e){var t=''+et.avatarImg(e)+''+u(e.name)+\"\";for(var s in e.social_uid)t+='';return t+=''+e.comments+\"条评论\",e.description&&(t+=''+u(e.description)+\"\"),t};var st=S.Views={},at=(S.Callbacks={},S.pagelets=[]),it=S.events=new J,rt=S.site=new V,nt=S.visitor=new $,ot=S.unread=new V,dt=S.threadPool=new Y(G),lt=S.postPool=new Y(F),ct=S.userPool=new Y($);it.on(\"queryDefined\",function(){var e=c.short_name;if(c.theme&&n(c.theme),m){var t=m[\"ds_site_\"+e],s=m[\"ds_lang_\"+e];t&&rt.reset(p.parse(t)),s&&o.extend(z,p.parse(s))}}),q(),S.require(\"embed.compat\",function(){function i(e){e.stopPropagation()} function n(e){(e.ctrlKey&&13==e.which||10==e.which)&&H(this.form).trigger(\"submit\")} function d(){var e=H(this);e.height(Math.max(54,e.next(\".ds-hidden-text\").text(this.value).height()+27))} function l(){if(P.authInWin){var e=this.href.match(/\\/(login|bind)\\/(\\w+)\\//i);if(e&&S.serviceNames[e[2]])return !b(e[2],this.href)}} function u(){var e,s,a,i,r,n=this,o=0,d=0;t.selection&&(s=t.selection.createRange(),s&&s.parentElement()==n&&(i=n.value.length,e=n.value.replace(/\\r\\n/g,\"\\n\"),a=n.createTextRange(),a.moveToBookmark(s.getBookmark()),r=n.createTextRange(),r.collapse(!1),a.compareEndPoints(\"StartToEnd\",r)>-1?o=d=i:(o=-a.moveStart(\"character\",-i),o+=e.slice(0,o).split(\"\\n\").length-1,a.compareEndPoints(\"EndToEnd\",r)>-1?d=i:(d=-a.moveEnd(\"character\",-i),d+=e.slice(0,d).split(\"\\n\").length-1)))),H(n).data(\"ds-range-start\",o).data(\"ds-range-end\",d)} function p(e){return P.touch&&e.addClass(\"ds-touch\"),o.cssProperty(\"transition\")||e.addClass(\"ds-no-transition\"),P.ie6&&e.addClass(\"ds-ie6\"),P.opacity||e.addClass(\"ds-no-opacity\"),e} function f(e){if(!P.placeholder){var t=e.attr(\"placeholder\");e.val(t).focus(function(){this.value===t&&(this.value=\"\")}).blur(function(){\"\"===this.value&&(this.value=t)})} return e} function g(e){if(\"http://duoshuo.com\"===e.origin)switch(e.data.type){case\"login\":h.href=e.data.redirectUrl}} function b(t,s){var a={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[t]||[550,400];return e.open(s+(-1==s.indexOf(\"?\")?\"?\":\"&\")+o.param({origin:h.origin||\"http://\"+h.host}),\"_blank\",\"width=\"+a[0]+\",height=\"+a[1]+\",toolbar=no,menubar=no,location=yes\")} function y(e){var t=Z[r()?\"loginUrl\":\"bindUrl\"](e);P.authInWin&&b(e,t)||(h.href=t)} function w(){var e=E(et[\"dialog-ask-for-auth\"]({})).el.find(\".ds-dialog\").css(\"width\",\"300px\");e.find(\"a.ds-service-link\").click(l)} function x(e,t,s,a){function i(){function e(e){if(s&&a){var t=s.options,i=M(s.postList.el,e.response[a],t);\"asc\"==t.order==(\"top\"==t.formPosition)&&S.scrollTo(i);var r=s.el.find(\".ds-comments-tab-\"+a+\" span.ds-highlight\");r.html(parseInt(r.html())+1)}} return a||l.find(\"[type=checkbox]:checked\")[0]?(R.post(\"posts/repost\",S.toJSON(l),e),o.close(),!1):(alert(\"还没有选发布到哪儿呢\"),!1)} function r(){var e=this.value;return this.checked&&!nt.data.social_uid[\"qqt\"==e?\"qq\":e]?void y(e):void 0} var o=E(et[\"dialog-reposts\"]({post:e.toJSON(),repostMessage:t,service:a})),l=o.el.find(\"form\");return l.submit(i),l.find(\".ds-actions [type=checkbox]\").change(r),f(l.find(\"textarea\")).keyup(n).keyup(d).focus(),!1} function T(e){var t={\"unread-comments\":{title:\"新留言及回复\",apiUrl:\"users/unreadComments\",tmpl:function(e){return e.thread?''+H.map(e.authors,et.userAnchor).join(\"、\")+' 在 '+_(e.thread.title||\"无标题\")+' 中回复了你 知道了':\"\"},read:function(e){var t=e.attr(\"data-thread-id\");R.post(\"threads/read\",{thread_id:t}),ot.data.comments--}},\"unread-notifications\":{title:\"系统消息\",apiUrl:\"users/unreadNotifications\",tmpl:function(e){return ''+e.content+' 知道了'},read:function(e){var t=e.attr(\"data-notification-id\");R.post(\"notifications/read\",{notification_id:t}),ot.data.notifications--}}}[e],s=E(\"\"+t.title+'');s.on(\"close\",S.resetNotify);var a=s.el.find(\".ds-unread-list\").delegate(\".ds-delete\",\"click\",function(){return H(this).parent().remove(),0===a.children().length&&s.close(),!1}).delegate(\".ds-read\",\"click\",function(){t.read(H(this).parent())});H(\"#ds-notify\").hide(),R.get(t.apiUrl,{},function(e){s.el.find(\".ds-unread-list\").html(H.map(e.response,t.tmpl).join(\"\\n\"))})} function N(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)} function I(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,X.detach()},400)} function M(e,t,s){return e.find(\".ds-post[data-post-id=\"+t.data.post_id+\"]\")[0]?void 0:(e.find(\".ds-post-placeholder\").remove(),H(et.post({post:t.toJSON(),options:s})).hide()[\"asc\"==s.order?\"appendTo\":\"prependTo\"](e).slideDown(function(){}))} function U(e,t){function s(){if(r())return w(),!1;var e=H(this).parent(),t=e.hasClass(\"ds-post-liked\"),s=H(this).html().match(/\\((\\d+)\\)/),a=(s?parseInt(s[1]):0)+(t?-1:1);return R.post(\"posts/vote\",{post_id:e.closest(\".ds-ctx-entry, .ds-post-self\").attr(\"data-post-id\"),vote:t?0:1}),H(this).html(H(this).html().replace(/\\(\\d+\\)/,\"\")+(a?\"(\"+a+\")\":\"\")),e[t?\"removeClass\":\"addClass\"](\"ds-post-liked\"),!1} function a(){var e=H(this).closest(\".ds-post-self\"),t=lt[e.attr(\"data-post-id\")];return x(t,\"\"),!1} function i(){if(!confirm(\"确定要删除这条评论吗？\"))return !1;var t=H(this).closest(\".ds-post-self\");return R.post(\"posts/remove\",{post_id:t.attr(\"data-post-id\")}),t.parent().fadeOut(200,function(){e.data.comments--,e.updateCounter(\"duoshuo\"),H(this).remove()}),!1} function n(){if(!confirm(\"确定要举报这条评论吗？\"))return !1;var e=H(this).closest(\".ds-post-self\");return R.post(\"posts/report\",{post_id:e.attr(\"data-post-id\")}),alert(\"感谢您的反馈！\"),!1} function o(){var s=H(this),a=s.closest(\".ds-comment-actions\");if(a.hasClass(\"ds-reply-active\"))h.el.fadeOut(200,function(){H(this).detach()}),a.removeClass(\"ds-reply-active\");else{var i=s.closest(\".ds-ctx-entry, .ds-post-self\");h?h.actionsBar.removeClass(\"ds-reply-active\"):(h=new st.Replybox(e),h.render(!0).el.addClass(\"ds-inline-replybox\").detach()),h.el.find(\"[name=parent_id]\").val(i.attr(\"data-post-id\")),h.el.show().appendTo(s.closest(\".ds-ctx-body, .ds-comment-body\")).find(\"textarea\").focus(),h.actionsBar=a.addClass(\"ds-reply-active\"),t.max_depth35?35:n);try{if(a.hasClass(\"ds-comment-context\"))K.attr(\"id\",\"ds-ctx-bubble\").attr(\"data-post-id\",a.attr(\"data-post-id\")).html(''+et.ctxPost({post:lt[a.attr(\"data-parent-id\")].toJSON()})+'查看对话');else if(a.hasClass(\"ds-avatar\")||a.hasClass(\"ds-user-name\")){var l={},c=l.user_id=a.attr(\"data-user-id\");if(!c)throw\"no info\";K.attr(\"id\",\"ds-user-card\").attr(\"data-user-id\",c).empty(),ct[c]?K.html(et.userInfo(ct[c].data)):R.get(\"users/profile\",B(l),t)} X.css({bottom:o,left:d}).appendTo(e.innerEl)}catch(u){X.detach()}} var s=this;if(bubbleOutTimer&&X.owner==s)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);var a=H(s);tt=setTimeout(t,200)} function p(){tt?(clearTimeout(tt),tt=0):bubbleOutTimer||I()} var h;this.delegate(\"a.ds-post-likes\",\"click\",s).delegate(\"a.ds-post-repost\",\"click\",a).delegate(\"a.ds-post-delete\",\"click\",i).delegate(\"a.ds-post-report\",\"click\",n).delegate(\"a.ds-post-reply\",\"click\",o).delegate(\"a.ds-weibo-comments\",\"click\",d).delegate(\"a.ds-weibo-reposts\",\"click\",l).delegate(\"a.ds-expand\",\"click\",c),P.touch||this.delegate(\"a.ds-comment-context, .ds-avatar, .ds-user-name\",\"mouseenter\",u).delegate(\"a.ds-comment-context, .ds-avatar, .ds-user-name\",\"mouseleave\",p)} function B(e){var s={require:\"site,visitor,nonce,lang\"+(it++?\"\":\",unread,log,extraCss\"),site_ims:D.get(\"ds_site_\"+c.short_name+\":timestamp\"),lang_ims:D.get(\"ds_lang_\"+c.short_name+\":timestamp\"),referer:t.referrer};c.stylePatch&&(s.style_patch=c.stylePatch);for(var a in s)s[a]&&(!P.ie6||encodeURIComponent(s[a]).lengthV.scrollTop()+V.height())&&H(\"html, body\").animate({scrollTop:t-40},200,\"swing\")},S.toJSON=function(e){var t=/\\r?\\n/g,s=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,a=/^(?:select|textarea)/i,i=e.map(function(){return this.elements?H.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||a.test(this.nodeName)||s.test(this.type))}).map(function(e,s){var a=H(this).val();return null==a?null:H.isArray(a)?H.map(a,function(e){return{name:s.name,value:e.replace(t,\"\\r\\n\")}}):{name:s.name,value:a.replace(t,\"\\r\\n\")}}).toArray(),r={};return H.each(i,function(){r[this.name]=this.value}),r},S.resetNotify=function(){var e=H(\"#ds-notify\"),s=ot.data;e[0]||(e=H('').css({hidden:{display:\"none\"},\"top-right\":{top:\"24px\",right:\"24px\"},\"bottom-right\":{bottom:\"24px\",right:\"24px\"}}[rt.data.notify_position]).delegate(\".ds-notify-unread a\",\"click\",function(){return T(H(this).data(\"type\")),!1}).appendTo(t.body)),e.html(et.notify(s))[!s.comments&&!s.notifications||\"hidden\"===rt.data.notify_position||H(\".ds-dialog\")[0]?\"hide\":\"show\"]()},ot.on(\"reset\",S.resetNotify),st.Replybox=function(e){this.embedThread=e},st.Replybox.prototype={render:function(e){function s(e){e.data(\"submitting\",!0),e.find(\".ds-post-button\").addClass(\"ds-waiting\").html(z.posting)[0].disabled=!0} function a(e){e.data(\"submitting\",!1),e.find(\".ds-post-button\").removeClass(\"ds-waiting\").html(z.post)[0].disabled=!1} var i=this,o=i.embedThread,c=o.options,p=function(){S.require(\"smilies\",function(){})},h={thread:o,options:c,inline:e,params:{thread_id:o.threadId,parent_id:\"\",nonce:S.nonce},repostArray:[],checked:0};for(var v in nt.data.repostOptions)nt.data.repostOptions[v]&&(h.repostArray.push(v),h.checked=1);var g=i.el=H(et.replybox(h)).click(p),b=g.find(\"form\"),y=b.find(\"input[type=checkbox]\")[0],_=b.find(\"a.ds-service-icon, a.ds-service-icon-grey\"),k=f(b.find(\"textarea\")).focus(p).keyup(n).keyup(d).bind(\"focus mousedown mouseup keyup\",u),w=g.find(\".ds-add-emote\").click(function(e){var s=S.smiliesTooltip;return w.toggleClass(\"ds-expanded\").hasClass(\"ds-expanded\")?(s||(s=S.smiliesTooltip=new st.SmiliesTooltip,s.render(),S.require(\"smilies\",function(){s.reset(\"微博-默认\")})),s.replybox=i,s.el.appendTo(t.body).css({top:i.el.offset().top+i.el.outerHeight()+4+\"px\",left:i.el.find(\".ds-textarea-wrapper\").offset().left+\"px\"}),H(t.body).click(x)):x(e),!1}),x=(g.find(\".ds-add-image\").click(function(e){var s=k[0],a=s.value,i=\"请输入图片地址\",r='';if(t.selection){s.value=a.substring(0,k.data(\"ds-range-start\"))+r+a.substring(k.data(\"ds-range-end\"),a.length),s.value=s.value.replace(\"说点什么吧 ...\",\"\"),s.focus();var n=t.selection.createRange();n.collapse(),n.findText(i),n.select()}else{s.value=a.substring(0,s.selectionStart)+r+a.substring(s.selectionEnd);var o=s.value.search(i);s.setSelectionRange(o,o+i.length),s.focus()} e.preventDefault()}),i.hideSmilies=function(){w.removeClass(\"ds-expanded\"),S.smiliesTooltip.el.detach(),H(t.body).unbind(\"click\",x)}),T=function(e,t){var s=E(et[\"dialog-anonymous\"]({services:[\"weixin\",\"weibo\",\"qq\",\"renren\",\"kaixin\",\"douban\"],options:c})),a=s.el.find(\".ds-dialog\").css(\"width\",\"320px\");if(a.find(\".ds-icons-32 a\").click(l),!c.deny_anonymous){var i=s.el.find(\"form\");i.submit(function(){var e=i.find(\"input[name=author_email]\").val();return !e&&!c.require_guest_email||e.match(/^(([^()[\\]\\\\.,;:\\s@\\\"]+(\\.[^()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/)?(t(S.toJSON(i)),s.close(),!1):(alert(\"请输入一个有效的email地址.\"),!1)}),i.find(\"input[name=author_name]\")[0].focus()}};c.deny_anonymous&&k.focus(function(){if(r()){T(b,q);var e=function(t){t.stopPropagation(),k.unbind(\"click\",e)};k.click(e)} return !1});var q=function(e){s(b),R.post(\"posts/create\",H.extend(S.toJSON(b),e),function(e){var t=lt[e.response.post_id]=new F(e.response),s=M(i.postList,t,c);if(\"asc\"==c.order==(\"top\"==c.formPosition)&&S.scrollTo(s),o.data.comments++,o.updateCounter(\"duoshuo\"),k.val(\"\").trigger(\"keyup\"),a(b),g.hasClass(\"ds-inline-replybox\")&&(g.detach(),i.actionsBar.removeClass(\"ds-reply-active\")),m)try{m.removeItem(\"ds_draft_\"+o.threadId)}catch(r){}},function(e){a(b),alert(e.errorMessage)})};b.submit(function(){if(b.data(\"submitting\"))return !1;var e=H.trim(b[0].message.value);return \"\"==e||!P.placeholder&&e==k.attr(\"placeholder\")?(alert(\"您还没写内容呢\"),!1):(r()?T(b,q):q(),!1)});var C=function(e){return H(e).hasClass(\"ds-service-icon-grey\")?null:H(e).attr(\"data-service\")};if(_.click(function(){return H(this).toggleClass(\"ds-service-icon-grey\").toggleClass(\"ds-service-icon\"),y.value=H.map(_,C).join(\",\"),y.checked=\"\"!=y.value,!1}),H(y).change(function(){var e=this.checked;_[e?\"removeClass\":\"addClass\"](\"ds-service-icon-grey\")[e?\"addClass\":\"removeClass\"](\"ds-service-icon\"),this.value=H.map(_,C).join(\",\")}),!e&&m){var j=\"ds_draft_\"+o.threadId;k.bind(\"focus blur keyup\",function(e){var t=H(e.currentTarget).val();try{m[j]=t}catch(e){}}),m[j]&&k.val(m[j])} return this}},st.Dialog=J.extend({init:function(e,t){(this.el=H(\"#ds-wrapper\"))[0]||(this.el=p(H(''))),this.options=H.extend({width:600},t),e!==s&&H(e).attr(\"id\",\"ds-reset\").appendTo(this.el)},open:function(){function e(e){return 27==e.which?(a.close(),!1):void 0} function s(){return a.close(),!1} var a=this;return a.el.hide().appendTo(t.body).fadeIn(200),P.ie6&&a.el.css(\"top\",V.scrollTop()+100),a.el.show().find(\".ds-dialog\").delegate(\"a.ds-dialog-close\",\"click\",function(){return a.close(),!1}).click(i),Y.keydown(e),H(t.body).click(s),a.close=function(){Y.unbind(\"keydown\",e),H(t.body).unbind(\"click\",s),a.el.fadeOut(200,function(){H(this).remove()}),a.trigger(\"close\")},a}}),et.likePanel=function(e){return e.likes?''+e.likes+\" 人喜欢\":\"\"},st.Meta=function(e){this.embedThread=e},st.Meta.prototype={render:function(){function a(a){function r(e){o.set(e),n.resetLikePanel()} function c(){n.tooltip.detach(),H(t.body).unbind(\"click\",c)} function u(t){switch(this.className){case\"ds-like-tooltip-close\":c(t);break;default:if(!e.open(this.href,\"_blank\",\"height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no\"))return} return !1} var p=l.hasClass(\"ds-thread-liked\");if(R.post(\"threads/vote\",{thread_id:n.embedThread.threadId,vote:p?0:1},r),l.toggleClass(\"ds-thread-liked\"),l.find(\".ds-thread-like-text\").text(p?\"喜欢\":\"已喜欢\"),p)return n.tooltip&&c(a),!1;if(n.tooltip===s){var h=et.likeTooltip({services:{qzone:\"QQ空间\",weibo:\"新浪微博\",qqt:\"腾讯微博\",renren:\"人人网\",kaixin:\"开心网\",douban:\"豆瓣网\",baidu:\"百度搜藏\"},thread_id:o.data.thread_id});n.tooltip=H(h).click(i).delegate(\"a\",\"click\",u)} var f={};return f.left=0,f.top=d.position().top+d.outerHeight()-4+\"px\",n.tooltip.appendTo(n.embedThread.innerEl).css(f),H(t.body).click(c),!1} var n=this,o=n.embedThread.model,d=n.el=H(et.meta(o.toJSON())),l=d.find(\".ds-like-thread-button\");return l.click(a),n.resetLikePanel(),r()&&d.hide(),n},resetLikePanel:function(){this.el.find(\".ds-like-panel\").html(et.likePanel(this.embedThread.model.toJSON()))}},st.PostListHead=function(e){this.embedThread=e},st.PostListHead.prototype={render:function(){function e(e){r.find(\"a.ds-current\").removeClass(\"ds-current\"),a.params.page=1;var t=e.currentTarget;switch(t.className){case\"ds-comments-tab-duoshuo\":a.params.source=\"duoshuo\",s.replybox.el.show();break;case\"ds-comments-tab-repost\":a.params.source=\"repost\",s.replybox.el.hide();break;case\"ds-comments-tab-weibo\":a.params.source=\"weibo\",s.replybox.el.hide();break;case\"ds-comments-tab-qqt\":a.params.source=\"qqt\",s.replybox.el.hide()} return H(t).addClass(\"ds-current\"),a.refetch(),!1} function t(){return n.find(\"a.ds-current\").removeClass(\"ds-current\"),a.params.order=s.options.order=this.className.replace(\"ds-order-\",\"\"),a.params.page=1,a.refetch(),H(this).addClass(\"ds-current\"),!1} var s=this.embedThread,a=s.postList,i=this.el=H(et.postListHead({thread:s.model.toJSON(),options:s.options})),r=i.find(\"ul.ds-comments-tabs\");r.delegate(\".ds-tab a\",\"click\",e);var n=i.find(\".ds-sort\");return n.delegate(\"a\",\"click\",t),n.find(\".ds-order-\"+a.params.order).addClass(\"ds-current\"),this}},st.Paginator=function(e){function t(){return i.params.page=parseInt(this.innerHTML),i.refetch(),a.find(\".ds-current\").removeClass(\"ds-current\"),H(this).addClass(\"ds-current\"),!1} e=e||{};var s=this,a=s.el=e.el||H(''),i=s.collection=e.collection;a.delegate(\"a\",\"click\",t)},st.Paginator.prototype={reset:function(e){function t(e){i.push(''+e+\"\")} var s,a=this.collection.params.page||1,i=[];if(a>1)for(t(1),s=a>4?a-2:2,s>2&&i.push('...');a>s;s++)t(s);if(i.push(''+a+\"\"),a=s&&s1?\"show\":\"hide\"]()}},S.addSmilies=function(e,t){var s=S.smiliesTooltip;s&&s.el.find(\"ul.ds-smilies-tabs\").append(\"\"+e+\"\"),S.smilies[e]=t},st.SmiliesTooltip=function(){},st.SmiliesTooltip.prototype={render:function(){function e(){var e=s.replybox,a=e.el.find(\"textarea\"),i=a[0],r=i.value;if(t.selection){i.value=r.substring(0,a.data(\"ds-range-start\"))+this.title+r.substring(a.data(\"ds-range-end\"),r.length),i.value=i.value.replace(z.leave_a_message,\"\"),i.focus();var n=t.selection.createRange();n.moveStart(\"character\",a.data(\"ds-range-start\")+this.title.length),n.collapse(),n.select()}else{var o=i.selectionStart+this.title.length;i.value=r.substring(0,i.selectionStart)+this.title+r.substring(i.selectionEnd),i.setSelectionRange(o,o)} e.hideSmilies(),i.focus()} var s=this,a=s.el=H(et.smiliesTooltip(L));return a.click(i).find(\"ul.ds-smilies-tabs\").delegate(\"a\",\"click\",function(){s.reset(this.innerHTML)}),a.find(\".ds-smilies-container\").delegate(\"img\",\"click\",e),this},reset:function(e){function t(t,s){var i=0===e.indexOf(\"微博\")?\"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/\"+s.replace(\"_org\",\"_thumb\"):S.STATIC_URL+\"/images/smilies/\"+s;\"WordPress\"===e&&(t=\" \"+t+\" \"),a+=''} var s=this.el.find(\"ul.ds-smilies-tabs\");s.find(\"a.ds-current\").removeClass(\"ds-current\"),s.find(\"a\").filter(function(){return this.innerHTML==e}).addClass(\"ds-current\");var a=\"\";return H.each(L[e],t),a+=\"\",this.el.find(\".ds-smilies-container\").html(a),this}},et.postPlaceholder=function(){return['',z.no_comments_yet,\"\"].join(\"\")};var X=H(''),K=X.find(\".ds-bubble-content\").delegate(\"a.ds-ctx-open\",\"click\",function(){function e(e){function t(e,t){return et.ctxPost({post:e,index:t})} C.log(H.map(e.response,t).join(\"\\n\"));s.el.find(\"ol\");s.el.find(\"ol\").html(H.map(e.response,t).join(\"\\n\"))} var t={};t.post_id=K.attr(\"data-post-id\"),R.get(\"posts/conversation\",t,e);var s=E('查看对话');return s.el.find(\".ds-dialog\").css(\"width\",\"600px\"),s.el.find(\".ds-dialog-body\").css({\"max-height\":\"350px\",_height:\"350px\",\"overflow-y\":\"auto\",\"padding-top\":\"10px\"}),!1}),tt=bubbleOutTimer=0;X.mouseenter(N).mouseleave(I),st.PostList=function(e){e&&(e.params&&(this.params=e.params),e.embedThread&&(this.embedThread=e.embedThread)),this.el=H('')},st.PostList.prototype={url:\"threads/listPosts\",render:function(){return U.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(e){var t=this.embedThread.options;this.el.html(e[0]?H.map(lt.getJSON(e),function(e){return et.post({post:e,options:t})}).join(\"\"):et.postPlaceholder())},refetch:function(){function e(e){lt.set(e.parentPosts||e.relatedPosts),ct.set(e.users),s.reset(e.response),s.embedThread.paginator.reset(e.cursor),s.el.fadeTo(200,1),S.scrollTo(s.el),a.remove()} var s=this,a=H(et.indicator()).appendTo(t.body).fadeIn(200);s.el.fadeTo(200,.5),R.get(s.url,s.params,e)}},st.RelatedRead=function(){this._init()},st.RelatedRead.prototype={_init:function(){this.el=H('')},load:function(s){e.__duoshuo_id__=s,e.readsByToutiao=[],e.readsByToutiao.push({id:\"ds-related-reads\",num:3});var a=\"//s0.pstatp.com/site/reads-sdk/5bf3702b38076207bee1.js\",i=t.createElement(\"script\");i.src=a,i.charset=\"utf-8\",i.crossOrigin=\"anonymous\",t.head.appendChild(i)},mount:function(e){this.el.insertBefore(e)}},st.EmbedThread=Q.extend({uri:\"threads/listPosts\",params:\"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url\"+(v.match(/MSIE 6\\.0/)?\"\":\" title image thumbnail\"),render:function(){var e=this.el;if(\"请将此处替换成文章在你的站点中的ID\"===e.data(\"thread-key\"))return alert(\"请设置正确的 data-thread-key 属性\"),!1;e.attr(\"id\",\"ds-thread\").append(et.waitingImg());var t=e.width(),s=e.data(\"url\")||!e.attr(\"data-thread-id\")&&H(\"link[rel=canonical]\").attr(\"href\");s?e.data(\"url\",k(s)):e.data(\"container-url\",h.href),t&&400>=t&&e.addClass(\"ds-narrow\").data(\"max-depth\",1)},updateCounter:function(e){function t(e){return e.substr(e.indexOf(\"}\")+1)} var s={duoshuo:[\"comments\",t(z.comments_multiple)||\"评论\"],repost:[\"reposts\",t(z.reposts_multiple)||\"转载\"],weibo:[\"weibo_reposts\",t(z.weibo_reposts_multiple)||\"新浪微博\"],qqt:[\"qqt_reposts\",t(z.qqt_reposts_multiple)||\"腾讯微博\"]};for(var a in s)if(!e||e==a){var i=this.data[s[a][0]];this.el.find(\".ds-comments-tab-\"+a).html(this.el.hasClass(\"ds-narrow\")?''+i:(i?''+i+\"\":\"0\")+s[a][1])}},onError:function(e){this.el.html(\"评论框出错啦(\"+e.code+\"): \"+e.errorMessage)},onload:function(t){var a=this,i=a.threadId=t.thread.thread_id,n=t.cursor,o=a.options=t.options,d=a.innerEl=p(H('').appendTo(a.el));a.model=new G(a.data=t.thread),lt.set(t.parentPosts||t.relatedPosts),ct.set(t.users),a.el.find(\"#ds-waiting\").remove(),t.options&&t.options.show_recommend&&(a.relatedRead=new st.RelatedRead,a.relatedRead.load(t.thread.site_id),a.relatedRead.mount(d)),o.like_thread_enabled&&(a.meta=new st.Meta(a),d.append(a.meta.render().el)),o.hot_posts&&t.hotPosts&&t.hotPosts.length&&(a.hotPosts=new st.HotPosts(H(''),{max_depth:1,show_context:o.show_context}),a.hotPosts.thread=a,d.append(a.hotPosts.el),a.hotPosts.onload({list:lt.getJSON(t.hotPosts)})),a.postListHead=new st.PostListHead(a),a.postList=new st.PostList({embedThread:a,params:{source:\"duoshuo\",thread_id:i,max_depth:o.max_depth,order:o.order,limit:o.limit}}),a.postList.render().reset(t.response),a.paginator=new st.Paginator({collection:a.postList}),a.paginator.reset(n);var c=a.replybox=new st.Replybox(a);c.postList=a.postList.el,r()?a.loginButtons=H(et.loginButtons()).delegate(\"a.ds-more-services\",\"click\",function(){return a.loginButtons.find(\".ds-additional-services\").toggle(),!1}).delegate(\"a.ds-service-link\",\"click\",l):a.toolbar=H(et.toolbar()).delegate(\".ds-account-control\",\"mouseenter\",function(){H(this).addClass(\"ds-active\")}).delegate(\".ds-account-control\",\"mouseleave\",function(){H(this).removeClass(\"ds-active\")}).delegate(\"a.ds-bind-more\",\"click\",function(){var e=E(et[\"dialog-bind-more\"]()).el.find(\".ds-dialog\").addClass(\"ds-dialog-bind-more\").css(\"width\",\"300px\");return e.find(\"a.ds-service-link\").click(l),!1}).delegate(\"a.ds-unread-comments-count\",\"click\",function(){return T(\"unread-comments\"),!1});var u=['',a.toolbar||a.loginButtons,c.render().el];\"top\"==o.formPosition&&H.fn.append.apply(d,u),d.append(a.postListHead.render().el,a.postList.el,a.paginator.el),\"bottom\"==o.formPosition&&H.fn.append.apply(d,u),d.append(et.poweredBy(o.poweredby_text)),a.updateCounter(),t.alerts&&H.each(t.alerts,function(e,t){H(''+t+\"\").insertBefore(a.toolbar||loginButtons)}),o.message&&c.el.find(\"textarea\").val(o.message).focus(),ot.on(\"reset\",function(){var e=ot.data.comments||0;d.find(\"a.ds-unread-comments-count\").html(e).attr(\"title\",e?\"你有\"+e+\"条新回复\":\"你没有新回复\").css(\"display\",e?\"inline\":\"none\")}),o.mzadx_id&&(S.require(\"mzadxN\",function(){}),H('').appendTo(d),__mz_rpq=e.__mz_rpq||[],__mz_rpq.push({l:[o.mzadx_id],r:\"1\",_srv:\"MZADX\",_callback:function(){}})),S.thread=a,ot.data!==s&&ot.trigger(\"reset\"),r()||A.send({visit_thread_id:a.threadId})},onMessage:function(e){M(this.postList.el,new F(e),this.options)}}),st.HotPosts=Q.extend({tmpl:\"hotPosts\",params:\"show-quote\",render:function(){return this.el.attr(\"id\",\"ds-hot-posts\"),this},onload:function(e){e.options=H.extend(this.options,e.options),Q.prototype.onload.call(this,e),U.call(this.el.find(\"ul\"),this.thread,this.options)}}),st.RecentComments=Q.extend({tmpl:\"commentList\",uri:\"sites/listRecentPosts\",params:\"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key\",render:function(){this.el.attr(\"id\",\"ds-recent-comments\")},prepare:function(e){return{list:H.map(e.response,function(e){return new F(e).toJSON()})}}}),st.RecentVisitors=Q.extend({tmpl:\"recentVisitors\",uri:\"sites/listVisitors\",params:\"show-time avatar-size num-items channel-key\",render:function(){this.el.children().detach(),this.el.attr(\"id\",\"ds-recent-visitors\").append(this.waitingEl=H(et.waitingImg()))}}),st.TopThreads=Q.extend({tmpl:\"topThreads\",uri:\"sites/listTopThreads\",params:\"range num-items channel-key\",render:function(){this.el.children().detach(),this.el.attr(\"id\",\"ds-top-threads\").append(this.waitingEl=H(et.waitingImg()))}}),st.LoginWidget=Q.extend({tmpl:\"loginWidget\",render:function(){var e=this.el;e.attr(\"id\",\"ds-login\").html(et.loginWidget([\"weixin\",\"weibo\",\"qq\",\"renren\",\"kaixin\",\"douban\"])),e.find(\"a\").click(l),e.find(\"a.ds-logout\").attr(\"href\",Z.logoutUrl())}}),st.ThreadCount=Q.extend({onload:function(e){var t=this.el,s=t.data(\"count-type\")||\"comments\",a=e.data[s];t[t.data(\"replace\")?\"replaceWith\":\"html\"](z[s+\"_\"+(a?a>1?\"multiple\":\"one\":\"zero\")].replace(\"{num}\",a))}}),st.ShareWidget=Q.extend({tmpl:\"shareWidget\",render:function(){var e={copyright:\"多说分享插件\",services:[\"weibo\",\"qzone\",\"sohu\",\"renren\",\"netease\",\"qqt\",\"kaixin\",\"douban\",\"qq\",\"meilishuo\",\"mogujie\",\"baidu\",\"taobao\",\"google\",\"wechat\",\"diandian\",\"huaban\",\"duitang\",\"youdao\",\"pengyou\",\"facebook\",\"twitter\",\"linkedin\",\"msn\"]};this.el.attr(\"id\",\"ds-share\"),this.el.children().attr(\"id\",\"ds-reset\"),this.el.find(\".ds-share-aside-inner\").html(et.shareWidget(e)),this.el.find(\".ds-share-icons-more\").html(et.shareWidget(e)),this.el.find(\".ds-share-icons-more\").hide(),this.el.hasClass(\"flat\")&&this.el.find(\"a\").each(function(){H(this).addClass(\"flat\")}),p(this.el),this.delegateEvents()},delegateEvents:function(){var s=this,i=s.el;if(i.children().hasClass(\"ds-share-inline\")){var r=\".ds-share-icons-more\",n=i.find(r),d=\"[data-toggle=ds-share-icons-more]\";i.delegate(d,\"mouseover\",function(){n.show()}),i.delegate(d,\"mouseout\",function(){n.hide()}),i.delegate(r,\"mouseover\",function(){n.show()}),i.delegate(r,\"mouseout\",function(){n.hide()})}else{var l=i.children().hasClass(\"ds-share-aside-left\")?\"slide-to-right\":\"slide-to-left\",c=i.children();if(!o.cssProperty(\"transition\")){var u=i.children().hasClass(\"ds-share-aside-left\")?\"left\":\"right\";i.delegate(\".ds-share-aside-toggle\",\"mouseover\",function(){var e={},s=P.ie6&&\"right\"===u;s?e.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:e[u]=0,c.animate(e,200)}),i.delegate(\".ds-share-aside-inner\",\"mouseleave\",function(){var e={},s=P.ie6&&\"right\"===u;s?e.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:e[u]=-229,c.animate(e,200)})} i.delegate(\".ds-share-aside-toggle,.ds-share-aside-inner\",\"mouseover\",function(){c.addClass(l)}),i.delegate(\".ds-share-aside-toggle,.ds-share-aside-inner\",\"mouseleave\",function(){c.removeClass(l)})} i.delegate(\"a\",\"click\",function(t){var s=H(this).data(\"service\");if(!i.data(\"url\"))return void alert(\"请设置data-url\");if(\"wechat\"===s){var r=a()+\"/api/qrcode/getImage.png\",n=\"?size=240&text=\"+i.data(\"url\"),d=E(et[\"dialog-qrcode\"]({qrcode_url:r+n,url:i.data(\"url\")}));d.el.find(\".ds-dialog\").css(\"width\",\"320px\")}else{var l=a()+\"/share-proxy/?\"+o.param({service:H(this).data(\"service\"),thread_key:i.data(\"threadKey\"),title:i.data(\"title\"),images:i.data(\"images\"),content:i.data(\"content\"),url:i.data(\"url\")});e.open(l,\"_blank\")} t.preventDefault(),t.stopPropagation()})}});var it=0;S.initSelector=function(e,t){function s(e){W(e),o.extend(z,e.options),dt.set(e.response)} var a=[];!q()||!H.isReady&&j||H(e).each(function(e,s){var i=H(s);if(!i.data(\"initialized\")){i.data(\"initialized\",!0);var r=new st[t.type](i,t);if(at.push(r),\"ThreadCount\"===t.type){var n=i.attr(\"data-thread-key\");i.attr(\"data-channel-key\")&&(n=i.attr(\"data-channel-key\")+\":\"+n),a.push(n),dt[n]||(dt[n]=new G({})),dt[n].on(\"reset\",function(){r.onload(this)})}else if(r.uri){var o={};H.each(r.params.split(\" \"),function(e,t){o[t.replace(/-/g,\"_\")]=i.attr(\"data-\"+t)||i.data(t)}),R.get(r.uri,B(o),function(e){r.load(e)})}}}),a.length&&R.get(\"threads/counts\",B({threads:a.join(\",\")}),s)},(S.initView=function(){H.each(O,S.initSelector)})(),H(function(){if(!c){if(!q())return C.error(\"缺少 duoshuoQuery 的定义\");C.warn(\"请在加载多说 embed.js 之前定义 duoshuoQuery\")} setInterval(function(){H(\".ds-time\").each(function(){var e=H(this).attr(\"datetime\");e&&(this.innerHTML=S.elapsedTime(e))})},2e4),c.ondomready&&c.ondomready(),S.initView(),!it&&c.short_name&&R.get(\"analytics/ping\",B({}),W)})})}}(window,document)"},{"title":"","date":"2017-10-25T03:09:10.856Z","updated":"2017-10-25T03:09:10.856Z","comments":true,"path":"lib/simple-affix.js","permalink":"http://www.clarencep.com/lib/simple-affix.js","excerpt":"","text":"$(function () { var $main = $('#site-main'); var $headings = $main.find('.document').find('h2,h3,h4'); var $content = $(''); var $contentList = $content.find('ul'); var indexes = { h2: 0, h3: 0, h4: 0 }; $headings.each(function () { var $h = $(this); var tagName = this.tagName.toLowerCase(); var hIndex = ++indexes[tagName]; if (tagName == 'h2'){ indexes.h3 = 0; indexes.h4 = 0; } else if (tagName == 'h3') { indexes.h4 = 0; hIndex = indexes.h2 + '-' + indexes.h3; } else if (tagName == 'h4') { hIndex = indexes.h2 + '-' + indexes.h3 + '-' + indexes.h4; } if (!$h.attr('id')) { $h.attr('id', \"h-\" + hIndex); } var $li = $('').addClass(tagName); $li.find('a').text($h.text()).attr('title', $h.text()).attr('href', '#' + $h.attr('id')); $li.appendTo($contentList); }); $content.prependTo('#site-main .content-container'); var on_scroll_update_collapsing = function(){ var $h2, $h3; var $activeContentItem = $content.find('li.active'); $content.find('.h3, .h4').hide(); if ($activeContentItem.is('.h2')) { $h2 = $activeContentItem; $h2.nextUntil('.h2').filter('.h3').show(); } else if ($activeContentItem.is('.h3')){ $h3 = $activeContentItem; $h2 = first_prev($h3, '.h2'); $h2.nextUntil('.h2').filter('.h3').show(); $h3.nextUntil('.h3').filter('.h4').show(); } else if ($activeContentItem.is('.h4')){ $h3 = first_prev($activeContentItem, '.h3'); $h2 = first_prev($h3, '.h2'); $h2.nextUntil('.h2').filter('.h3').show(); $h3.nextUntil('.h3').filter('.h4').show(); } function first_prev($el, selector){ var $prev = $el.prev(); while (!$prev.is(selector) && $prev.size() > 0){ $prev = $prev.prev(); } return $prev; } }; $(window).scrollspy({target: '#content'}).on('activate.bs.scrollspy', on_scroll_update_collapsing); on_scroll_update_collapsing(); // adjust content $(window).on('scroll', function () { var InitialTopPos = $('#site-header').height() + $('#tab').height() + 21; var winTop = window.scrollY; $content.css('top', Math.max(0, InitialTopPos - Math.min(InitialTopPos, window.scrollY))); // 90: the original offset to the top }).trigger('scroll'); });"},{"title":"","date":"2017-10-25T03:09:10.884Z","updated":"2017-10-25T03:09:10.884Z","comments":false,"path":"tags/index.html","permalink":"http://www.clarencep.com/tags/index.html","excerpt":"","text":""},{"title":"","date":"2017-10-25T03:09:10.884Z","updated":"2017-10-25T03:09:10.884Z","comments":true,"path":"test/geo.html","permalink":"http://www.clarencep.com/test/geo.html","excerpt":"","text":"html{ /* font-size: large; */ } #location{ white-space: pre; } Test Geolocation -- HTML5 if (!window.jQuery){ document.write(''); } Please refresh Refresh High Accuracy Timeout(ms): Age(ms): var $location = $('#location'); var $refresh = $('#refresh'); $refresh.on('click', function(){ updateLocation(\"updating...\"); navigator.geolocation.getCurrentPosition(function(loc){ loc = loc || {}; loc.coords = loc.coords || {}; var pos = { latitude: loc.coords.latitude, longitude: loc.coords.longitude, accuracy: loc.coords.accuracy }; updateLocation(\"Success: \\n\" + JSON.stringify(pos, '', ' ')); }, function(error){ updateLocation(\"Failed: \\n\" + JSON.stringify(error, '', ' ')); }, { enableHighAccuracy: $('#highAccuracy').is(':checked'), timeout: Number($(\"#timeout\").val()), maximumAge: Number($('#age').val()) }); }); function updateLocation(text){ $location.text(text); }"},{"title":"","date":"2017-10-25T03:09:10.884Z","updated":"2017-10-25T03:09:10.884Z","comments":true,"path":"test/test-local-image-preview.html","permalink":"http://www.clarencep.com/test/test-local-image-preview.html","excerpt":"","text":"function preImg(sourceId, targetId) { if (typeof FileReader === 'undefined') { alert('Your browser does not support FileReader...'); return; } var reader = new FileReader(); reader.onload = function(e) { var img = document.getElementById(targetId); img.src = this.result; } reader.readAsDataURL(document.getElementById(sourceId).files[0]); }"},{"title":"","date":"2017-10-25T03:09:10.884Z","updated":"2017-10-25T03:09:10.884Z","comments":true,"path":"test/test-tap-vs-click.html","permalink":"http://www.clarencep.com/test/test-tap-vs-click.html","excerpt":"","text":"html{ /* font-size: large; */ } define = window.define || function(initialize){ var require = function(){}; var exports = {}; var module = {}; initialize(require, exports, module); return exports; }; Test test function log(s){ $(\"#result\").append($(\"\").text(s)); } $(function(){ var tapTime; var clickTime; $(\"button\").on('click',function(){ clickTime = new Date(); log(\"click: \" + (+clickTime)); log(\"delta: \" + (clickTime - tapTime) + \" ms\"); }).on('tap', function(){ tapTime = new Date(); log(\"--tap: \" + (+tapTime)); }); });"},{"title":"","date":"2017-10-25T03:09:10.852Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"lib/duoshuo-embed.js","permalink":"http://www.clarencep.com/lib/duoshuo-embed.js","excerpt":"","text":"!function (e, t, s) { function a() { return c.short_name ? g + \"//\" + c.short_name + \".\" + S.DOMAIN : S.REMOTE } function i() { function t() { for (var t; t = y.shift();) { var a = t.url, i = new s(t.title, {dir: \"auto\", icon: t.iconUrl, body: t.body}); try { i.onclick = function () { e.focus(), h.href = a, i.close() } } catch (r) { } setTimeout(function () { i.close && i.close() }, 8e3) } } var s = e.Notification; \"Notification\" in e && \"denied\" !== s.permission && (\"granted\" === s.permission && t(), s.requestPermission(function (e) { \"granted\" === e && t() })) } function r() { return 0 == nt.data.user_id } function n(e) { S.theme = e, \"none\" != e && o.injectStylesheet(S.STATIC_URL + \"/styles/embed\" + (e ? \".\" + e + \".css?\" + M[e] : \".\" + short_name) + \".css\") } var o = {}, d = t.getElementsByTagName(\"head\")[0] || t.getElementsByTagName(\"body\")[0]; if (o.extend = function (e, t) { for (var s in t)e[s] = t[s]; return e }, o.injectScript = function (a, i) { var r = t.createElement(\"script\"), n = t.head || t.getElementsByTagName(\"head\")[0] || t.documentElement; r.type = \"text/javascript\", r.src = a, r.async = \"async\", r.charset = \"utf-8\", i && (r.onload = r.onreadystatechange = function (t, a) { var o = a || !r.readyState || /loaded|complete/.test(r.readyState); o && (r.onload = r.onreadystatechange = null, n && r.parentNode && n.removeChild(r), r = s, a || i.call(e)) }), n.insertBefore(r, n.firstChild) }, o.injectStylesheet = function (e) { var s = t.createElement(\"link\"); s.type = \"text/css\", s.rel = \"stylesheet\", s.href = e, d.appendChild(s) }, o.injectStyle = function (e) { var s = t.createElement(\"style\"); return s.type = \"text/css\", d.appendChild(s), e = e.replace(/\\}/g, \"}\\n\"), s.styleSheet ? s.styleSheet.cssText = e : s.appendChild(t.createTextNode(e)), s }, o.getCookie = function (e) { for (var a, i, r, n = \" \" + e + \"=\", o = t.cookie.split(\";\"), d = 0; d < o.length; d++)if (a = \" \" + o[d], i = a.indexOf(n), i >= 0 && i + n.length == (r = a.indexOf(\"=\") + 1))return decodeURIComponent(a.substring(r, a.length).replace(/\\+/g, \"\")); return s }, o.param = function (e) { var t = []; for (var a in e)e[a] != s && t.push(a + \"=\" + encodeURIComponent(e[a])); return t.join(\"&\") }, o.cssProperty = function (e, s) { var a = (t.body || t.documentElement).style; if (\"undefined\" == typeof a)return !1; if (\"string\" == typeof a[e])return s ? e : !0; for (var i = [\"Moz\", \"Webkit\", \"ms\"], e = e.charAt(0).toUpperCase() + e.substr(1), r = 0; r < i.length; r++)if (\"string\" == typeof a[i[r] + e])return s ? i[r] + e : !0 }, !e.DUOSHUO) { for (var l in Object.prototype)return alert(\"Object.prototype 不为空，请不要给 Object.prototype 设置方法\"); var c, u, p = e.JSON, h = e.location, f = e.XMLHttpRequest, m = p && p.stringify && e.localStorage, v = e.navigator.userAgent, g = \"https:\" == t.location.protocol ? \"https:\" : \"http:\", b = 0, y = [], _ = u = function () { function e(e) { return t[e] || \"&amp;\" } var t = { \"\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#x27;\", \"`\": \"&#x60;\" }, s = /&(?!\\w+;)|[\"'`]/g, a = /[&\"'`]/; return function (t) { return null == t || t === !1 ? \"\" : a.test(t) ? t.replace(s, e) : t } }(), k = function (e) { if (e.match(/^(http|https):/))return e; var s = t.createElement(\"a\"); return s.href = e, P.hrefNormalized ? s.href : s.getAttribute(\"href\", 4) }, w = function (e) { return function () { return e } }, x = function () { for (var e = {}, t = 0; t < arguments.length; t++)arguments[t] && o.extend(e, arguments[t]); var s = o.param(e); return s ? \"?\" + s : \"\" }, T = function () { var e = o.getCookie(\"duoshuo_token\"); return e ? {jwt: e} : c.remote_auth ? {short_name: c.short_name, remote_auth: c.remote_auth} : s }, q = function () { if (!c && (c = e.duoshuoQuery)) { if (!c.short_name || \"your_duoshuo_short_name\" === c.short_name)return c = s, void alert(\"你还没有设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/\"); it.trigger(\"queryDefined\") } return c }, C = function (e) { return e && e.error && e.warn ? e : { error: function () { }, log: function () { }, warn: function () { } } }(e.console), S = e.DUOSHUO = { sourceName: { weibo: \"新浪微博\", qq: \"QQ\", qzone: \"QQ空间\", qqt: \"腾讯微博\", renren: \"人人网\", douban: \"豆瓣网\", kaixin: \"开心网\", sohu: \"搜狐微博\", baidu: \"百度\", google: \"谷歌\", wechat: \"微信\", weixin: \"微信\", facebook: \"Facebook\", twitter: \"Twitter\", linkedin: \"Linkedin\" }, serviceNames: { weibo: \"微博\", qq: \"QQ\", douban: \"豆瓣\", renren: \"人人\", kaixin: \"开心\", baidu: \"百度\", google: \"谷歌\", wechat: \"微信\", weixin: \"微信\", facebook: \"Facebook\", twitter: \"Twitter\", linkedin: \"Linkedin\" }, parseDate: function (e) { return e.parse(\"2011-10-28T00:00:00+08:00\") && function (t) { return new e(t) } || e.parse(\"2011/10/28T00:00:00+0800\") && function (t) { return new e(t.replace(/-/g, \"/\").replace(/:(\\d\\d)$/, \"$1\")) } || e.parse(\"2011/10/28 00:00:00+0800\") && function (t) { return new e(t.replace(/-/g, \"/\").replace(/:(\\d\\d)$/, \"$1\").replace(\"T\", \" \")) } || function (t) { return new e(t) } }(Date), fullTime: function (e) { var t = S.parseDate(e); return t.getFullYear() + \"年\" + (t.getMonth() + 1) + \"月\" + t.getDate() + \"日 \" + t.toLocaleTimeString() }, elapsedTime: function (e) { var t = S.parseDate(e), s = new Date, a = (s - b - t) / 1e3; return 10 > a ? \"刚刚\" : 60 > a ? Math.round(a) + \"秒前\" : 3600 > a ? Math.round(a / 60) + \"分钟前\" : 86400 > a ? Math.round(a / 3600) + \"小时前\" : (s.getFullYear() == t.getFullYear() ? \"\" : t.getFullYear() + \"年\") + (t.getMonth() + 1) + \"月\" + t.getDate() + \"日\" }, compileStyle: function (e) { var t = \"\", s = {}; if (s.textbox = \"#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper\", !e)return t; for (var a in e)t += s[a] + \"{\" + e[a] + \"}\\n\"; return t }, init: function (e, t) { e && !O[e] && (O[e] = t || {type: \"EmbedThread\"}), S.initView && S.initView() } }, j = t.all, P = S.support = function () { var s = t.createElement(\"div\"); s.innerHTML = 'a'; var a = s.getElementsByTagName(\"a\")[0], i = s.getElementsByTagName(\"input\")[0], r = { placeholder: \"placeholder\" in i, touch: \"ontouchstart\" in e || \"onmsgesturechange\" in e, opacity: /^0.55$/.test(a.style.opacity), hrefNormalized: \"/a\" === a.getAttribute(\"href\"), iOS: v.match(/ \\((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /), android: v.match(/ \\(Linux; U; Android /) }; return r.ie6 = !f && \"undefined\" == typeof s.style.maxHeight, r.authInWin = e.postMessage && e.screen.width > 800 && !r.iOS && !r.android && h.origin, r }(), O = S.selectors = { \".ds-thread\": {type: \"EmbedThread\"}, \".ds-recent-comments\": {type: \"RecentComments\"}, \".ds-recent-visitors\": {type: \"RecentVisitors\"}, \".ds-top-users\": {type: \"TopUsers\"}, \".ds-top-threads\": {type: \"TopThreads\"}, \".ds-login\": {type: \"LoginWidget\"}, \".ds-thread-count\": {type: \"ThreadCount\"}, \".ds-share\": {type: \"ShareWidget\"} }, E = S.openDialog = function (e) { return S.dialog !== s && S.dialog.el.remove(), S.dialog = new st.Dialog(et.dialog(e)).open() }, L = S.smilies = {}; S.require = function () { function t(e) { var t = U[e] ? \"?\" + U[e] + \".js\" : \"\"; return S.STATIC_URL + \"/libs/\" + e + \".js\" + t } var s = {mzadxN: \"undefined\" != typeof mzadxN}; return \"undefined\" != typeof jQuery && jQuery.fn.jquery >= \"1.5\" && (s[\"embed.compat\"] = !0, S.jQuery = e.jQuery), function (e, a) { if (\"string\" == typeof e)s[e] ? a() : o.injectScript(t(e), function () { s[e] = !0, a() }); else if (\"object\" == typeof e) { var i, r = !0; for (i = 0; i < e.length; i++)(function (n) { s[e[i]] || (r = !1, o.injectScript(t(n), function () { s[n] = !0; for (var t = 0; t < e.length; t++)if (!s[e[t]])return; a() })) })(e[i]); r && a() } } }(); for (var N = 0, I = [\"EmbedThread\", \"RecentComments\", \"RecentVisitors\", \"TopUsers\", \"TopThreads\", \"LoginWidget\", \"ThreadCount\"]; N < I.length; N++)S[I[N]] = function (e) { return function (t, s) { s = s || {}, s.type = e, t && !O[t] && (O[t] = s), S.initSelector && S.initSelector(t, s) } }(I[N]), S[\"create\" + I[N]] = function (e) { return function (s, a) { var i = t.createElement(s); for (var r in a)i.setAttribute(\"data-\" + r, a[r]); return S[e](i), i } }(I[N]); S.RecentCommentsWidget = S.RecentComments; var R = S.API = { ajax: function (e, t, i, r, n) { function d(e) { var t = e.getResponseHeader(\"Date\"); t && (b = new Date - new Date(t)) } function l(e, t, s) { var a, i, o, l = t; if (e >= 200 && 300 > e || 304 === e)if (304 === e)l = \"notmodified\", o = !0; else try { a = p.parse(s), l = \"success\", o = !0 } catch (c) { l = \"parsererror\", i = c } else { i = l, (!l || e) && (l = \"error\", 0 > e && (e = 0)); try { a = p.parse(s) } catch (c) { l = \"parsererror\", i = c } } o ? r && r(a) : \"parseerror\" === l ? C.error(\"解析错误: \" + s) : (C.error(\"出错啦(\" + a.code + \"): \" + a.errorMessage), n && n(a), a.errorTrace && C.error(a.errorTrace)), d(m) } var u = o.getCookie(\"duoshuo_token\"); i = i || {}, i.v = S.version, u ? i.jwt = u : c.remote_auth && (i.remote_auth = c.remote_auth); var h = f && p && p.parse; if (h) { var m = new f, v = !!m && \"withCredentials\" in m; if (v) { var g; return m.open(e, a() + \"/api/\" + t + \".json\" + (\"GET\" == e ? \"?\" + o.param(i) : \"\"), !0), m.withCredentials = !0, m.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded; charset=UTF-8\"), m.send(\"GET\" == e ? null : o.param(i)), g = function (e, t) { var a, i, r, n; try { if (g && (t || 4 === m.readyState))if (g = s, t)4 !== m.readyState && m.abort(); else { a = m.status, r = m.getAllResponseHeaders(); try { n = m.responseText } catch (e) { } try { i = m.statusText } catch (o) { i = \"\" } } } catch (d) { t || l(-1, d) } n && l(a, i, n, r) }, void(4 === m.readyState ? g() : m.onreadystatechange = g) } } \"GET\" != e && (i._method = \"POST\"); var y = \"cb_\" + Math.round(1e6 * Math.random()); R[y] = function (e) { switch (e.code) { case 0: r && r(e); break; default: n && n(e), C.error(\"出错啦(\" + e.code + \"): \" + e.errorMessage), e.errorTrace && C.error(e.errorTrace) } }, i.callback = \"DUOSHUO.API['\" + y + \"']\", o.injectScript(a() + \"/api/\" + t + \".jsonp?\" + o.param(i)) }, get: function (e, t, s, a) { return this.ajax(\"GET\", e, t, s, a) }, post: function (e, t, s, a) { return this.ajax(\"POST\", e, t, s, a) } }, A = S.ws = { messages: [], send: function (s) { if (!(\"WebSocket\" in e && p))return !1; var a = this; if (a.messages.push(p.stringify(s)), !a.webSocket) { var r = \"https:\" === t.location.protocol ? \"wss://ws.duoshuo.com:8202/\" : \"ws://ws.duoshuo.com:8201/\", n = a.webSocket = new WebSocket(r); n.onopen = function () { var e, t = 1 === n.readyState; if (t)for (; e = a.messages.shift();)n.send(e) }, n.onmessage = function (e) { try { var t = p.parse(e.data) } catch (s) { return } switch (t.type) { case\"post\": for (var a, r = 0; r < S.pagelets.length; r++)a = S.pagelets[r], a.threadId == t.thread_id && a.onMessage(t); break; case\"notification\": y.push(t), i() } }, e.addEventListener(\"beforeunload\", function () { n.close() }) } a.webSocket.onopen() } }; S.DOMAIN = \"duoshuo.com\", S.STATIC_URL = g + \"//static.duoshuo.com\", S.REMOTE = g + \"//duoshuo.com\", S.version = \"16.6.16\"; var M = { \"default\": \"9b2a46a0\", dark: \"33f3a5ac\", bluebox: \"39a75d50\", newhua: \"706ba4eb\", justflat: \"9d72ec5a\" }, U = {\"embed.compat\": \"24f8ca3f\", smilies: \"921e8eda\"}, z = { post: \"发布\", posting: \"正在发布\", settings: \"设置\", reply: \"回复\", like: \"顶\", repost: \"转发\", report: \"举报\", \"delete\": \"删除\", reply_to: \"回复 \", reposts: \"转发\", comments: \"评论\", floor: \"楼\", latest: \"最新\", earliest: \"最早\", hottest: \"最热\", share_to: \"分享到:\", leave_a_message: \"说点什么吧…\", no_comments_yet: \"还没有评论，沙发等你来抢\", repost_reason: \"请输入转发理由\", hot_posts_title: \"被顶起来的评论\", comments_zero: \"暂无评论\", comments_one: \"1条评论\", comments_multiple: \"{num}条评论\", reposts_zero: \"暂无转发\", reposts_one: \"1条转发\", reposts_multiple: \"{num}条转发\", weibo_reposts_zero: \"暂无新浪微博\", weibo_reposts_one: \"1条新浪微博\", weibo_reposts_multiple: \"{num}条新浪微博\", qqt_reposts_zero: \"暂无腾讯微博\", qqt_reposts_one: \"1条腾讯微博\", qqt_reposts_multiple: \"{num}条腾讯微博\" }, D = { get: function (e) { return m ? m[e] : void 0 }, save: function (e, t) { if (m)try { m.removeItem(e), m[e] = p.stringify(t), m.removeItem(e + \":timestamp\"), m[e + \":timestamp\"] = Math.floor((new Date - b) / 1e3) } catch (s) { } } }, W = S.loadRequire = function (t) { if (t.visitor && (!nt.data && t.visitor.user_id && e.Notification && A.send({logged_user_id: t.visitor.user_id}), nt.reset(t.visitor)), t.site && (rt.reset(t.site), D.save(\"ds_site_\" + c.short_name, t.site)), !S.theme && rt.data.theme && n(rt.data.theme), t.lang && (o.extend(z, t.lang), D.save(\"ds_lang_\" + c.short_name, t.lang)), t.stylesheets)for (var s = 0; s < t.stylesheets.length; s++)o.injectStylesheet(t.stylesheets[s]); if (t.nonce && (S.nonce = t.nonce), t.style && o.injectStyle((t.style || \"\") + S.compileStyle(c.component_style)), t.unread && ot.reset(t.unread), t.warnings)for (var s = 0; s < t.warnings.length; s++)C.warn(t.warnings[s]) }, B = 0, H = S.Class = function () { }; H.extend = function (e) { function t() { !B && this.init && this.init.apply(this, arguments) } B = 1; var s = new this; B = 0; for (var a in e)s[a] = e[a]; return t.prototype = s, t.prototype.constructor = t, t.extend = arguments.callee, t }; var J = S.Event = H.extend({ on: function (e, t) { var a = this.handlers || (this.handlers = {}); return a[e] === s && (a[e] = []), a[e].push(t), this }, trigger: function (e, t) { var s = (this.handlers || (this.handlers = {}))[e]; if (s)for (var a = 0; a < s.length && s[a].call(this, t) !== !1; a++); return this } }), Q = S.Widget = J.extend({ init: function (e, t) { this.el = e, this.options = t || {}, this.render() }, render: function () { }, reset: function () { }, load: function (e) { switch (e.code) { case 0: W(e); var t = this.prepare(e); t.options = o.extend(this.options, e.options), this.onload(t); break; default: this.onError(e) } }, onload: function (e) { this.el.html(et[this.tmpl](e)) }, prepare: function (e) { return e }, onMessage: function () { }, onError: function (e) { C.error(\"出错啦(\" + e.code + \"): \" + e.errorMessage), e.errorTrace && C.error(e.errorTrace) } }), V = S.Model = J.extend({ init: function (e) { this.data = e }, reset: function (e) { this.data = e, this.trigger(\"reset\") }, remove: function (e) { this.data.splice(e, 1), this.trigger(\"reset\") }, set: function (e, t) { if (t === s)for (var a in e)this.data[a] = e[a]; else this.data[e] = t; return this.trigger(\"reset\"), this }, toJSON: function () { return o.extend({}, this.data) } }), $ = V.extend({ toJSON: function () { return o.extend({}, this.data) } }), F = V.extend({ toJSON: function () { var e = o.extend({}, this.data); return e.theAuthor = ct[this.data.author_id] && ct[this.data.author_id].data || this.data.author, e.parents = this.data.parents || [], e } }), G = V.extend({ toJSON: function () { return o.extend({}, this.data) } }), Y = function (e) { this.model = e }; Y.prototype.set = function (e) { for (var t in e)e[t] && (this[t] ? this[t].set(e[t]) : this[t] = new this.model(e[t])) }, Y.prototype.get = function (e) { for (var t = 0, s = []; t < e.length; t++)s[t] = this[e[t]]; return s }, Y.prototype.getJSON = function (e) { for (var t = 0, s = []; t < e.length; t++)this[e[t]] && s.push(this[e[t]].toJSON()); return s }; var Z = { userUrl: function (e) { return e.url }, avatarUrl: function (e) { return ((e.avatar_url || rt.data.default_avatar_url) + '').replace(/^http:/, location.protocol); }, loginUrl: function (e, t) { return t || (t = {}), c.sso && c.sso.login && (t.sso = 1, t.redirect_uri = c.sso.login), a() + \"/login/\" + e + \"/\" + x(t) }, bindUrl: function (e) { return a() + \"/bind/\" + e + \"/\" + x(c.sso && c.sso.login ? { sso: 1, redirect_uri: c.sso.login } : null, T()) }, logoutUrl: function () { return a() + \"/logout/\" + x(c.sso && c.sso.logout ? {sso: 1, redirect_uri: c.sso.logout} : null) } }, X = [\"weixin\", \"weibo\", \"qq\", \"renren\"], K = [\"douban\", \"kaixin\", \"baidu\", \"google\"], et = S.templates = { userAnchor: function (e) { return e.url ? '' + _(e.name) + \"\" : _(e.name) }, avatarImg: function (e, t) { return '' + et.avatar(e.post.theAuthor || e.post.author) + '' + et.userAnchor(e.post.theAuthor || e.post.author) + et.timeAnchor(e.post.created_at, e.post.url), e.index >= 0 && (t += '' + (e.index + 1) + z.floor + \"\"), t += '' + e.post.message, e.index >= 0 && (t += ' i;)a = s[i += 1], t += '' + S.sourceName[a] + \"\"; return t += \"\", e.options.deny_anonymous || (t += '作为游客留言名字(必填)', e.options.require_guest_email && (t += '邮箱(必填)'), e.options.require_guest_url && (t += '网址(可选)'), t += '发布'), t }, et[\"dialog-ask-for-auth\"] = function () { var e = '社交帐号登录' + et.serviceList(X) + '' + et.serviceList(K) + \"\"; return e }, et[\"dialog-bind-more\"] = function () { var e = '绑定更多帐号' + et.serviceBindList(X) + '' + et.serviceBindList(K) + ''; return e }, et[\"dialog-qrcode\"] = function (e) { var t = '微信扫一扫，分享到朋友圈'; return t }, et[\"dialog-reposts\"] = function (e) { var t = '转发到微博@' + u(e.post.theAuthor.name) + \": \" + e.post.message + \"\" + tt({post_id: e.post.post_id}) + '' + u(e.repostMessage) + ''; return t += '', e.service ? t += tt({\"service[]\": e.service}) : (t += '\" }, et.post = function (e) { var t = \"\", s = e.post, i = e.options, r = s.author; if (t += '' + e.comments + \"条评论\", e.description && (t += '' + u(e.description) + \"\"), t }; var st = S.Views = {}, at = (S.Callbacks = {}, S.pagelets = []), it = S.events = new J, rt = S.site = new V, nt = S.visitor = new $, ot = S.unread = new V, dt = S.threadPool = new Y(G), lt = S.postPool = new Y(F), ct = S.userPool = new Y($); it.on(\"queryDefined\", function () { var e = c.short_name; if (c.theme && n(c.theme), m) { var t = m[\"ds_site_\" + e], s = m[\"ds_lang_\" + e]; t && rt.reset(p.parse(t)), s && o.extend(z, p.parse(s)) } }), q(), S.require(\"embed.compat\", function () { function i(e) { e.stopPropagation() } function n(e) { (e.ctrlKey && 13 == e.which || 10 == e.which) && H(this.form).trigger(\"submit\") } function d() { var e = H(this); e.height(Math.max(54, e.next(\".ds-hidden-text\").text(this.value).height() + 27)) } function l() { if (P.authInWin) { var e = this.href.match(/\\/(login|bind)\\/(\\w+)\\//i); if (e && S.serviceNames[e[2]])return !b(e[2], this.href) } } function u() { var e, s, a, i, r, n = this, o = 0, d = 0; t.selection && (s = t.selection.createRange(), s && s.parentElement() == n && (i = n.value.length, e = n.value.replace(/\\r\\n/g, \"\\n\"), a = n.createTextRange(), a.moveToBookmark(s.getBookmark()), r = n.createTextRange(), r.collapse(!1), a.compareEndPoints(\"StartToEnd\", r) > -1 ? o = d = i : (o = -a.moveStart(\"character\", -i), o += e.slice(0, o).split(\"\\n\").length - 1, a.compareEndPoints(\"EndToEnd\", r) > -1 ? d = i : (d = -a.moveEnd(\"character\", -i), d += e.slice(0, d).split(\"\\n\").length - 1)))), H(n).data(\"ds-range-start\", o).data(\"ds-range-end\", d) } function p(e) { return P.touch && e.addClass(\"ds-touch\"), o.cssProperty(\"transition\") || e.addClass(\"ds-no-transition\"), P.ie6 && e.addClass(\"ds-ie6\"), P.opacity || e.addClass(\"ds-no-opacity\"), e } function f(e) { if (!P.placeholder) { var t = e.attr(\"placeholder\"); e.val(t).focus(function () { this.value === t && (this.value = \"\") }).blur(function () { \"\" === this.value && (this.value = t) }) } return e } function g(e) { if (\"http://duoshuo.com\" === e.origin)switch (e.data.type) { case\"login\": h.href = e.data.redirectUrl } } function b(t, s) { var a = { weibo: [760, 600], renren: [420, 322], qq: [504, 445], weixin: [450, 550], google: [600, 440] }[t] || [550, 400]; return e.open(s + (-1 == s.indexOf(\"?\") ? \"?\" : \"&\") + o.param({origin: h.origin || \"http://\" + h.host}), \"_blank\", \"width=\" + a[0] + \",height=\" + a[1] + \",toolbar=no,menubar=no,location=yes\") } function y(e) { var t = Z[r() ? \"loginUrl\" : \"bindUrl\"](e); P.authInWin && b(e, t) || (h.href = t) } function w() { var e = E(et[\"dialog-ask-for-auth\"]({})).el.find(\".ds-dialog\").css(\"width\", \"300px\"); e.find(\"a.ds-service-link\").click(l) } function x(e, t, s, a) { function i() { function e(e) { if (s && a) { var t = s.options, i = M(s.postList.el, e.response[a], t); \"asc\" == t.order == (\"top\" == t.formPosition) && S.scrollTo(i); var r = s.el.find(\".ds-comments-tab-\" + a + \" span.ds-highlight\"); r.html(parseInt(r.html()) + 1) } } return a || l.find(\"[type=checkbox]:checked\")[0] ? (R.post(\"posts/repost\", S.toJSON(l), e), o.close(), !1) : (alert(\"还没有选发布到哪儿呢\"), !1) } function r() { var e = this.value; return this.checked && !nt.data.social_uid[\"qqt\" == e ? \"qq\" : e] ? void y(e) : void 0 } var o = E(et[\"dialog-reposts\"]({ post: e.toJSON(), repostMessage: t, service: a })), l = o.el.find(\"form\"); return l.submit(i), l.find(\".ds-actions [type=checkbox]\").change(r), f(l.find(\"textarea\")).keyup(n).keyup(d).focus(), !1 } function T(e) { var t = { \"unread-comments\": { title: \"新留言及回复\", apiUrl: \"users/unreadComments\", tmpl: function (e) { return e.thread ? '' + H.map(e.authors, et.userAnchor).join(\"、\") + ' 在 ' + _(e.thread.title || \"无标题\") + ' 中回复了你 知道了' : \"\" }, read: function (e) { var t = e.attr(\"data-thread-id\"); R.post(\"threads/read\", {thread_id: t}), ot.data.comments-- } }, \"unread-notifications\": { title: \"系统消息\", apiUrl: \"users/unreadNotifications\", tmpl: function (e) { return '' + e.content + ' 知道了' }, read: function (e) { var t = e.attr(\"data-notification-id\"); R.post(\"notifications/read\", {notification_id: t}), ot.data.notifications-- } } }[e], s = E(\"\" + t.title + ''); s.on(\"close\", S.resetNotify); var a = s.el.find(\".ds-unread-list\").delegate(\".ds-delete\", \"click\", function () { return H(this).parent().remove(), 0 === a.children().length && s.close(), !1 }).delegate(\".ds-read\", \"click\", function () { t.read(H(this).parent()) }); H(\"#ds-notify\").hide(), R.get(t.apiUrl, {}, function (e) { s.el.find(\".ds-unread-list\").html(H.map(e.response, t.tmpl).join(\"\\n\")) }) } function N() { bubbleOutTimer && (clearTimeout(bubbleOutTimer), bubbleOutTimer = 0) } function I() { bubbleOutTimer = setTimeout(function () { bubbleOutTimer = 0, X.detach() }, 400) } function M(e, t, s) { return e.find(\".ds-post[data-post-id=\" + t.data.post_id + \"]\")[0] ? void 0 : (e.find(\".ds-post-placeholder\").remove(), H(et.post({ post: t.toJSON(), options: s })).hide()[\"asc\" == s.order ? \"appendTo\" : \"prependTo\"](e).slideDown(function () { })) } function U(e, t) { function s() { if (r())return w(), !1; var e = H(this).parent(), t = e.hasClass(\"ds-post-liked\"), s = H(this).html().match(/\\((\\d+)\\)/), a = (s ? parseInt(s[1]) : 0) + (t ? -1 : 1); return R.post(\"posts/vote\", { post_id: e.closest(\".ds-ctx-entry, .ds-post-self\").attr(\"data-post-id\"), vote: t ? 0 : 1 }), H(this).html(H(this).html().replace(/\\(\\d+\\)/, \"\") + (a ? \"(\" + a + \")\" : \"\")), e[t ? \"removeClass\" : \"addClass\"](\"ds-post-liked\"), !1 } function a() { var e = H(this).closest(\".ds-post-self\"), t = lt[e.attr(\"data-post-id\")]; return x(t, \"\"), !1 } function i() { if (!confirm(\"确定要删除这条评论吗？\"))return !1; var t = H(this).closest(\".ds-post-self\"); return R.post(\"posts/remove\", {post_id: t.attr(\"data-post-id\")}), t.parent().fadeOut(200, function () { e.data.comments--, e.updateCounter(\"duoshuo\"), H(this).remove() }), !1 } function n() { if (!confirm(\"确定要举报这条评论吗？\"))return !1; var e = H(this).closest(\".ds-post-self\"); return R.post(\"posts/report\", {post_id: e.attr(\"data-post-id\")}), alert(\"感谢您的反馈！\"), !1 } function o() { var s = H(this), a = s.closest(\".ds-comment-actions\"); if (a.hasClass(\"ds-reply-active\"))h.el.fadeOut(200, function () { H(this).detach() }), a.removeClass(\"ds-reply-active\"); else { var i = s.closest(\".ds-ctx-entry, .ds-post-self\"); h ? h.actionsBar.removeClass(\"ds-reply-active\") : (h = new st.Replybox(e), h.render(!0).el.addClass(\"ds-inline-replybox\").detach()), h.el.find(\"[name=parent_id]\").val(i.attr(\"data-post-id\")), h.el.show().appendTo(s.closest(\".ds-ctx-body, .ds-comment-body\")).find(\"textarea\").focus(), h.actionsBar = a.addClass(\"ds-reply-active\"), t.max_depth ').insertAfter(i))) } return !1 } function d() { function e(e) { W(e), i.append(H.map(e.response, function (e) { return et.post({post: e, options: t}) }).join(\"\")) } { var s = H(this).closest(\".ds-post-self\"), a = s.attr(\"data-post-id\"); s.data(\"source\") } if (0 != s.attr(\"data-root-id\"))return !1; var i = s.siblings(\".ds-children\"); return i[0] ? (i.remove(), !1) : (i = H('').insertAfter(s), R.get(\"posts/listComments\", B({post_id: a}), e), !1) } function l() { var t = H(this).closest(\".ds-post-self\"), s = lt[t.attr(\"data-post-id\")], a = s.data.source; if (!nt.data.social_uid[\"qqt\" == a ? \"qq\" : a])return void y(a); var i = s.data.root_id, r = \"0\" != i ? lt[i] : s, n = \"\"; if (\"0\" != i) { var o = prepatePost(s.data).theAuthor; n = (\"weibo\" == a ? \"//@\" + o.name : \"|| @\" + o.qqt_account) + \":\" + s.data.message } return x(r, n, e, a), !1 } function c() { var e = H(this).parent(); return e.siblings().show(), e.remove(), !1 } function u() { function t() { function t(e) { var t = e.response; ct[c] ? ct[c].set(t) : ct[c] = new $(t), X.owner == s && K.html(et.userInfo(t)) } tt = 0, X.owner = s, N(); var i = a.offset(), r = e.el.offset(), n = a.innerWidth() / 2, o = e.el.innerHeight() - (i.top - r.top) + 6, d = i.left - r.left - 35 + (n > 35 ? 35 : n); try { if (a.hasClass(\"ds-comment-context\"))K.attr(\"id\", \"ds-ctx-bubble\").attr(\"data-post-id\", a.attr(\"data-post-id\")).html('' + et.ctxPost({post: lt[a.attr(\"data-parent-id\")].toJSON()}) + '查看对话'); else if (a.hasClass(\"ds-avatar\") || a.hasClass(\"ds-user-name\")) { var l = {}, c = l.user_id = a.attr(\"data-user-id\"); if (!c)throw\"no info\"; K.attr(\"id\", \"ds-user-card\").attr(\"data-user-id\", c).empty(), ct[c] ? K.html(et.userInfo(ct[c].data)) : R.get(\"users/profile\", B(l), t) } X.css({bottom: o, left: d}).appendTo(e.innerEl) } catch (u) { X.detach() } } var s = this; if (bubbleOutTimer && X.owner == s)return clearTimeout(bubbleOutTimer), void(bubbleOutTimer = 0); var a = H(s); tt = setTimeout(t, 200) } function p() { tt ? (clearTimeout(tt), tt = 0) : bubbleOutTimer || I() } var h; this.delegate(\"a.ds-post-likes\", \"click\", s).delegate(\"a.ds-post-repost\", \"click\", a).delegate(\"a.ds-post-delete\", \"click\", i).delegate(\"a.ds-post-report\", \"click\", n).delegate(\"a.ds-post-reply\", \"click\", o).delegate(\"a.ds-weibo-comments\", \"click\", d).delegate(\"a.ds-weibo-reposts\", \"click\", l).delegate(\"a.ds-expand\", \"click\", c), P.touch || this.delegate(\"a.ds-comment-context, .ds-avatar, .ds-user-name\", \"mouseenter\", u).delegate(\"a.ds-comment-context, .ds-avatar, .ds-user-name\", \"mouseleave\", p) } function B(e) { var s = { require: \"site,visitor,nonce,lang\" + (it++ ? \"\" : \",unread,log,extraCss\"), site_ims: D.get(\"ds_site_\" + c.short_name + \":timestamp\"), lang_ims: D.get(\"ds_lang_\" + c.short_name + \":timestamp\"), referer: t.referrer }; c.stylePatch && (s.style_patch = c.stylePatch); for (var a in s)s[a] && (!P.ie6 || encodeURIComponent(s[a]).length < 200) && (e[a] = s[a]); return e } var H = S.jQuery, V = H(e), Y = H(t); e.postMessage && (e.addEventListener ? e.addEventListener(\"message\", g, !1) : e.attachEvent && e.attachEvent(\"onmessage\", g)), S.scrollTo = function (e) { var t = e.offset().top; (t < V.scrollTop() || t > V.scrollTop() + V.height()) && H(\"html, body\").animate({scrollTop: t - 40}, 200, \"swing\") }, S.toJSON = function (e) { var t = /\\r?\\n/g, s = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i, a = /^(?:select|textarea)/i, i = e.map(function () { return this.elements ? H.makeArray(this.elements) : this }).filter(function () { return this.name && !this.disabled && (this.checked || a.test(this.nodeName) || s.test(this.type)) }).map(function (e, s) { var a = H(this).val(); return null == a ? null : H.isArray(a) ? H.map(a, function (e) { return {name: s.name, value: e.replace(t, \"\\r\\n\")} }) : {name: s.name, value: a.replace(t, \"\\r\\n\")} }).toArray(), r = {}; return H.each(i, function () { r[this.name] = this.value }), r }, S.resetNotify = function () { var e = H(\"#ds-notify\"), s = ot.data; e[0] || (e = H('').css({ hidden: {display: \"none\"}, \"top-right\": {top: \"24px\", right: \"24px\"}, \"bottom-right\": {bottom: \"24px\", right: \"24px\"} }[rt.data.notify_position]).delegate(\".ds-notify-unread a\", \"click\", function () { return T(H(this).data(\"type\")), !1 }).appendTo(t.body)), e.html(et.notify(s))[!s.comments && !s.notifications || \"hidden\" === rt.data.notify_position || H(\".ds-dialog\")[0] ? \"hide\" : \"show\"]() }, ot.on(\"reset\", S.resetNotify), st.Replybox = function (e) { this.embedThread = e }, st.Replybox.prototype = { render: function (e) { function s(e) { e.data(\"submitting\", !0), e.find(\".ds-post-button\").addClass(\"ds-waiting\").html(z.posting)[0].disabled = !0 } function a(e) { e.data(\"submitting\", !1), e.find(\".ds-post-button\").removeClass(\"ds-waiting\").html(z.post)[0].disabled = !1 } var i = this, o = i.embedThread, c = o.options, p = function () { S.require(\"smilies\", function () { }) }, h = { thread: o, options: c, inline: e, params: {thread_id: o.threadId, parent_id: \"\", nonce: S.nonce}, repostArray: [], checked: 0 }; for (var v in nt.data.repostOptions)nt.data.repostOptions[v] && (h.repostArray.push(v), h.checked = 1); var g = i.el = H(et.replybox(h)).click(p), b = g.find(\"form\"), y = b.find(\"input[type=checkbox]\")[0], _ = b.find(\"a.ds-service-icon, a.ds-service-icon-grey\"), k = f(b.find(\"textarea\")).focus(p).keyup(n).keyup(d).bind(\"focus mousedown mouseup keyup\", u), w = g.find(\".ds-add-emote\").click(function (e) { var s = S.smiliesTooltip; return w.toggleClass(\"ds-expanded\").hasClass(\"ds-expanded\") ? (s || (s = S.smiliesTooltip = new st.SmiliesTooltip, s.render(), S.require(\"smilies\", function () { s.reset(\"微博-默认\") })), s.replybox = i, s.el.appendTo(t.body).css({ top: i.el.offset().top + i.el.outerHeight() + 4 + \"px\", left: i.el.find(\".ds-textarea-wrapper\").offset().left + \"px\" }), H(t.body).click(x)) : x(e), !1 }), x = (g.find(\".ds-add-image\").click(function (e) { var s = k[0], a = s.value, i = \"请输入图片地址\", r = ''; if (t.selection) { s.value = a.substring(0, k.data(\"ds-range-start\")) + r + a.substring(k.data(\"ds-range-end\"), a.length), s.value = s.value.replace(\"说点什么吧 ...\", \"\"), s.focus(); var n = t.selection.createRange(); n.collapse(), n.findText(i), n.select() } else { s.value = a.substring(0, s.selectionStart) + r + a.substring(s.selectionEnd); var o = s.value.search(i); s.setSelectionRange(o, o + i.length), s.focus() } e.preventDefault() }), i.hideSmilies = function () { w.removeClass(\"ds-expanded\"), S.smiliesTooltip.el.detach(), H(t.body).unbind(\"click\", x) }), T = function (e, t) { var s = E(et[\"dialog-anonymous\"]({ services: [\"weixin\", \"weibo\", \"qq\", \"renren\", \"kaixin\", \"douban\"], options: c })), a = s.el.find(\".ds-dialog\").css(\"width\", \"320px\"); if (a.find(\".ds-icons-32 a\").click(l), !c.deny_anonymous) { var i = s.el.find(\"form\"); i.submit(function () { var e = i.find(\"input[name=author_email]\").val(); return !e && !c.require_guest_email || e.match(/^(([^()[\\]\\\\.,;:\\s@\\\"]+(\\.[^()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/) ? (t(S.toJSON(i)), s.close(), !1) : (alert(\"请输入一个有效的email地址.\"), !1) }), i.find(\"input[name=author_name]\")[0].focus() } }; c.deny_anonymous && k.focus(function () { if (r()) { T(b, q); var e = function (t) { t.stopPropagation(), k.unbind(\"click\", e) }; k.click(e) } return !1 }); var q = function (e) { s(b), R.post(\"posts/create\", H.extend(S.toJSON(b), e), function (e) { var t = lt[e.response.post_id] = new F(e.response), s = M(i.postList, t, c); if (\"asc\" == c.order == (\"top\" == c.formPosition) && S.scrollTo(s), o.data.comments++, o.updateCounter(\"duoshuo\"), k.val(\"\").trigger(\"keyup\"), a(b), g.hasClass(\"ds-inline-replybox\") && (g.detach(), i.actionsBar.removeClass(\"ds-reply-active\")), m)try { m.removeItem(\"ds_draft_\" + o.threadId) } catch (r) { } }, function (e) { a(b), alert(e.errorMessage) }) }; b.submit(function () { if (b.data(\"submitting\"))return !1; var e = H.trim(b[0].message.value); return \"\" == e || !P.placeholder && e == k.attr(\"placeholder\") ? (alert(\"您还没写内容呢\"), !1) : (r() ? T(b, q) : q(), !1) }); var C = function (e) { return H(e).hasClass(\"ds-service-icon-grey\") ? null : H(e).attr(\"data-service\") }; if (_.click(function () { return H(this).toggleClass(\"ds-service-icon-grey\").toggleClass(\"ds-service-icon\"), y.value = H.map(_, C).join(\",\"), y.checked = \"\" != y.value, !1 }), H(y).change(function () { var e = this.checked; _[e ? \"removeClass\" : \"addClass\"](\"ds-service-icon-grey\")[e ? \"addClass\" : \"removeClass\"](\"ds-service-icon\"), this.value = H.map(_, C).join(\",\") }), !e && m) { var j = \"ds_draft_\" + o.threadId; k.bind(\"focus blur keyup\", function (e) { var t = H(e.currentTarget).val(); try { m[j] = t } catch (e) { } }), m[j] && k.val(m[j]) } return this } }, st.Dialog = J.extend({ init: function (e, t) { (this.el = H(\"#ds-wrapper\"))[0] || (this.el = p(H(''))), this.options = H.extend({width: 600}, t), e !== s && H(e).attr(\"id\", \"ds-reset\").appendTo(this.el) }, open: function () { function e(e) { return 27 == e.which ? (a.close(), !1) : void 0 } function s() { return a.close(), !1 } var a = this; return a.el.hide().appendTo(t.body).fadeIn(200), P.ie6 && a.el.css(\"top\", V.scrollTop() + 100), a.el.show().find(\".ds-dialog\").delegate(\"a.ds-dialog-close\", \"click\", function () { return a.close(), !1 }).click(i), Y.keydown(e), H(t.body).click(s), a.close = function () { Y.unbind(\"keydown\", e), H(t.body).unbind(\"click\", s), a.el.fadeOut(200, function () { H(this).remove() }), a.trigger(\"close\") }, a } }), et.likePanel = function (e) { return e.likes ? '' + e.likes + \" 人喜欢\" : \"\" }, st.Meta = function (e) { this.embedThread = e }, st.Meta.prototype = { render: function () { function a(a) { function r(e) { o.set(e), n.resetLikePanel() } function c() { n.tooltip.detach(), H(t.body).unbind(\"click\", c) } function u(t) { switch (this.className) { case\"ds-like-tooltip-close\": c(t); break; default: if (!e.open(this.href, \"_blank\", \"height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no\"))return } return !1 } var p = l.hasClass(\"ds-thread-liked\"); if (R.post(\"threads/vote\", { thread_id: n.embedThread.threadId, vote: p ? 0 : 1 }, r), l.toggleClass(\"ds-thread-liked\"), l.find(\".ds-thread-like-text\").text(p ? \"喜欢\" : \"已喜欢\"), p)return n.tooltip && c(a), !1; if (n.tooltip === s) { var h = et.likeTooltip({ services: { qzone: \"QQ空间\", weibo: \"新浪微博\", qqt: \"腾讯微博\", renren: \"人人网\", kaixin: \"开心网\", douban: \"豆瓣网\", baidu: \"百度搜藏\" }, thread_id: o.data.thread_id }); n.tooltip = H(h).click(i).delegate(\"a\", \"click\", u) } var f = {}; return f.left = 0, f.top = d.position().top + d.outerHeight() - 4 + \"px\", n.tooltip.appendTo(n.embedThread.innerEl).css(f), H(t.body).click(c), !1 } var n = this, o = n.embedThread.model, d = n.el = H(et.meta(o.toJSON())), l = d.find(\".ds-like-thread-button\"); return l.click(a), n.resetLikePanel(), r() && d.hide(), n }, resetLikePanel: function () { this.el.find(\".ds-like-panel\").html(et.likePanel(this.embedThread.model.toJSON())) } }, st.PostListHead = function (e) { this.embedThread = e }, st.PostListHead.prototype = { render: function () { function e(e) { r.find(\"a.ds-current\").removeClass(\"ds-current\"), a.params.page = 1; var t = e.currentTarget; switch (t.className) { case\"ds-comments-tab-duoshuo\": a.params.source = \"duoshuo\", s.replybox.el.show(); break; case\"ds-comments-tab-repost\": a.params.source = \"repost\", s.replybox.el.hide(); break; case\"ds-comments-tab-weibo\": a.params.source = \"weibo\", s.replybox.el.hide(); break; case\"ds-comments-tab-qqt\": a.params.source = \"qqt\", s.replybox.el.hide() } return H(t).addClass(\"ds-current\"), a.refetch(), !1 } function t() { return n.find(\"a.ds-current\").removeClass(\"ds-current\"), a.params.order = s.options.order = this.className.replace(\"ds-order-\", \"\"), a.params.page = 1, a.refetch(), H(this).addClass(\"ds-current\"), !1 } var s = this.embedThread, a = s.postList, i = this.el = H(et.postListHead({ thread: s.model.toJSON(), options: s.options })), r = i.find(\"ul.ds-comments-tabs\"); r.delegate(\".ds-tab a\", \"click\", e); var n = i.find(\".ds-sort\"); return n.delegate(\"a\", \"click\", t), n.find(\".ds-order-\" + a.params.order).addClass(\"ds-current\"), this } }, st.Paginator = function (e) { function t() { return i.params.page = parseInt(this.innerHTML), i.refetch(), a.find(\".ds-current\").removeClass(\"ds-current\"), H(this).addClass(\"ds-current\"), !1 } e = e || {}; var s = this, a = s.el = e.el || H(''), i = s.collection = e.collection; a.delegate(\"a\", \"click\", t) }, st.Paginator.prototype = { reset: function (e) { function t(e) { i.push('' + e + \"\") } var s, a = this.collection.params.page || 1, i = []; if (a > 1)for (t(1), s = a > 4 ? a - 2 : 2, s > 2 && i.push('...'); a > s; s++)t(s); if (i.push('' + a + \"\"), a < e.pages) { for (s = a + 1; a + 4 >= s && s < e.pages; s++)t(s); s < e.pages && i.push('...'), t(e.pages) } this.el.html('' + i.join(\" \"))[e.pages > 1 ? \"show\" : \"hide\"]() } }, S.addSmilies = function (e, t) { var s = S.smiliesTooltip; s && s.el.find(\"ul.ds-smilies-tabs\").append(\"\" + e + \"\"), S.smilies[e] = t }, st.SmiliesTooltip = function () { }, st.SmiliesTooltip.prototype = { render: function () { function e() { var e = s.replybox, a = e.el.find(\"textarea\"), i = a[0], r = i.value; if (t.selection) { i.value = r.substring(0, a.data(\"ds-range-start\")) + this.title + r.substring(a.data(\"ds-range-end\"), r.length), i.value = i.value.replace(z.leave_a_message, \"\"), i.focus(); var n = t.selection.createRange(); n.moveStart(\"character\", a.data(\"ds-range-start\") + this.title.length), n.collapse(), n.select() } else { var o = i.selectionStart + this.title.length; i.value = r.substring(0, i.selectionStart) + this.title + r.substring(i.selectionEnd), i.setSelectionRange(o, o) } e.hideSmilies(), i.focus() } var s = this, a = s.el = H(et.smiliesTooltip(L)); return a.click(i).find(\"ul.ds-smilies-tabs\").delegate(\"a\", \"click\", function () { s.reset(this.innerHTML) }), a.find(\".ds-smilies-container\").delegate(\"img\", \"click\", e), this }, reset: function (e) { function t(t, s) { var i = 0 === e.indexOf(\"微博\") ? \"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/\" + s.replace(\"_org\", \"_thumb\") : S.STATIC_URL + \"/images/smilies/\" + s; \"WordPress\" === e && (t = \" \" + t + \" \"), a += '' } var s = this.el.find(\"ul.ds-smilies-tabs\"); s.find(\"a.ds-current\").removeClass(\"ds-current\"), s.find(\"a\").filter(function () { return this.innerHTML == e }).addClass(\"ds-current\"); var a = \"\"; return H.each(L[e], t), a += \"\", this.el.find(\".ds-smilies-container\").html(a), this } }, et.postPlaceholder = function () { return ['', z.no_comments_yet, \"\"].join(\"\") }; var X = H(''), K = X.find(\".ds-bubble-content\").delegate(\"a.ds-ctx-open\", \"click\", function () { function e(e) { function t(e, t) { return et.ctxPost({post: e, index: t}) } C.log(H.map(e.response, t).join(\"\\n\")); s.el.find(\"ol\"); s.el.find(\"ol\").html(H.map(e.response, t).join(\"\\n\")) } var t = {}; t.post_id = K.attr(\"data-post-id\"), R.get(\"posts/conversation\", t, e); var s = E('查看对话'); return s.el.find(\".ds-dialog\").css(\"width\", \"600px\"), s.el.find(\".ds-dialog-body\").css({ \"max-height\": \"350px\", _height: \"350px\", \"overflow-y\": \"auto\", \"padding-top\": \"10px\" }), !1 }), tt = bubbleOutTimer = 0; X.mouseenter(N).mouseleave(I), st.PostList = function (e) { e && (e.params && (this.params = e.params), e.embedThread && (this.embedThread = e.embedThread)), this.el = H('') }, st.PostList.prototype = { url: \"threads/listPosts\", render: function () { return U.call(this.el, this.embedThread, this.embedThread.options), this }, reset: function (e) { var t = this.embedThread.options; this.el.html(e[0] ? H.map(lt.getJSON(e), function (e) { return et.post({post: e, options: t}) }).join(\"\") : et.postPlaceholder()) }, refetch: function () { function e(e) { lt.set(e.parentPosts || e.relatedPosts), ct.set(e.users), s.reset(e.response), s.embedThread.paginator.reset(e.cursor), s.el.fadeTo(200, 1), S.scrollTo(s.el), a.remove() } var s = this, a = H(et.indicator()).appendTo(t.body).fadeIn(200); s.el.fadeTo(200, .5), R.get(s.url, s.params, e) } }, st.RelatedRead = function () { this._init() }, st.RelatedRead.prototype = { _init: function () { this.el = H('') }, load: function (s) { e.__duoshuo_id__ = s, e.readsByToutiao = [], e.readsByToutiao.push({ id: \"ds-related-reads\", num: 3 }); var a = \"//s0.pstatp.com/site/reads-sdk/5bf3702b38076207bee1.js\", i = t.createElement(\"script\"); i.src = a, i.charset = \"utf-8\", i.crossOrigin = \"anonymous\", t.head.appendChild(i) }, mount: function (e) { this.el.insertBefore(e) } }, st.EmbedThread = Q.extend({ uri: \"threads/listPosts\", params: \"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url\" + (v.match(/MSIE 6\\.0/) ? \"\" : \" title image thumbnail\"), render: function () { var e = this.el; if (\"请将此处替换成文章在你的站点中的ID\" === e.data(\"thread-key\"))return alert(\"请设置正确的 data-thread-key 属性\"), !1; e.attr(\"id\", \"ds-thread\").append(et.waitingImg()); var t = e.width(), s = e.data(\"url\") || !e.attr(\"data-thread-id\") && H(\"link[rel=canonical]\").attr(\"href\"); s ? e.data(\"url\", k(s)) : e.data(\"container-url\", h.href), t && 400 >= t && e.addClass(\"ds-narrow\").data(\"max-depth\", 1) }, updateCounter: function (e) { function t(e) { return e.substr(e.indexOf(\"}\") + 1) } var s = { duoshuo: [\"comments\", t(z.comments_multiple) || \"评论\"], repost: [\"reposts\", t(z.reposts_multiple) || \"转载\"], weibo: [\"weibo_reposts\", t(z.weibo_reposts_multiple) || \"新浪微博\"], qqt: [\"qqt_reposts\", t(z.qqt_reposts_multiple) || \"腾讯微博\"] }; for (var a in s)if (!e || e == a) { var i = this.data[s[a][0]]; this.el.find(\".ds-comments-tab-\" + a).html(this.el.hasClass(\"ds-narrow\") ? '' + i : (i ? '' + i + \"\" : \"0\") + s[a][1]) } }, onError: function (e) { this.el.html(\"评论框出错啦(\" + e.code + \"): \" + e.errorMessage) }, onload: function (t) { var a = this, i = a.threadId = t.thread.thread_id, n = t.cursor, o = a.options = t.options, d = a.innerEl = p(H('').appendTo(a.el)); a.model = new G(a.data = t.thread), lt.set(t.parentPosts || t.relatedPosts), ct.set(t.users), a.el.find(\"#ds-waiting\").remove(), t.options && t.options.show_recommend && (a.relatedRead = new st.RelatedRead, a.relatedRead.load(t.thread.site_id), a.relatedRead.mount(d)), o.like_thread_enabled && (a.meta = new st.Meta(a), d.append(a.meta.render().el)), o.hot_posts && t.hotPosts && t.hotPosts.length && (a.hotPosts = new st.HotPosts(H(''), { max_depth: 1, show_context: o.show_context }), a.hotPosts.thread = a, d.append(a.hotPosts.el), a.hotPosts.onload({list: lt.getJSON(t.hotPosts)})), a.postListHead = new st.PostListHead(a), a.postList = new st.PostList({ embedThread: a, params: { source: \"duoshuo\", thread_id: i, max_depth: o.max_depth, order: o.order, limit: o.limit } }), a.postList.render().reset(t.response), a.paginator = new st.Paginator({collection: a.postList}), a.paginator.reset(n); var c = a.replybox = new st.Replybox(a); c.postList = a.postList.el, r() ? a.loginButtons = H(et.loginButtons()).delegate(\"a.ds-more-services\", \"click\", function () { return a.loginButtons.find(\".ds-additional-services\").toggle(), !1 }).delegate(\"a.ds-service-link\", \"click\", l) : a.toolbar = H(et.toolbar()).delegate(\".ds-account-control\", \"mouseenter\", function () { H(this).addClass(\"ds-active\") }).delegate(\".ds-account-control\", \"mouseleave\", function () { H(this).removeClass(\"ds-active\") }).delegate(\"a.ds-bind-more\", \"click\", function () { var e = E(et[\"dialog-bind-more\"]()).el.find(\".ds-dialog\").addClass(\"ds-dialog-bind-more\").css(\"width\", \"300px\"); return e.find(\"a.ds-service-link\").click(l), !1 }).delegate(\"a.ds-unread-comments-count\", \"click\", function () { return T(\"unread-comments\"), !1 }); var u = ['', a.toolbar || a.loginButtons, c.render().el]; \"top\" == o.formPosition && H.fn.append.apply(d, u), d.append(a.postListHead.render().el, a.postList.el, a.paginator.el), \"bottom\" == o.formPosition && H.fn.append.apply(d, u), d.append(et.poweredBy(o.poweredby_text)), a.updateCounter(), t.alerts && H.each(t.alerts, function (e, t) { H('' + t + \"\").insertBefore(a.toolbar || loginButtons) }), o.message && c.el.find(\"textarea\").val(o.message).focus(), ot.on(\"reset\", function () { var e = ot.data.comments || 0; d.find(\"a.ds-unread-comments-count\").html(e).attr(\"title\", e ? \"你有\" + e + \"条新回复\" : \"你没有新回复\").css(\"display\", e ? \"inline\" : \"none\") }), o.mzadx_id && (S.require(\"mzadxN\", function () { }), H('').appendTo(d), __mz_rpq = e.__mz_rpq || [], __mz_rpq.push({ l: [o.mzadx_id], r: \"1\", _srv: \"MZADX\", _callback: function () { } })), S.thread = a, ot.data !== s && ot.trigger(\"reset\"), r() || A.send({visit_thread_id: a.threadId}) }, onMessage: function (e) { M(this.postList.el, new F(e), this.options) } }), st.HotPosts = Q.extend({ tmpl: \"hotPosts\", params: \"show-quote\", render: function () { return this.el.attr(\"id\", \"ds-hot-posts\"), this }, onload: function (e) { e.options = H.extend(this.options, e.options), Q.prototype.onload.call(this, e), U.call(this.el.find(\"ul\"), this.thread, this.options) } }), st.RecentComments = Q.extend({ tmpl: \"commentList\", uri: \"sites/listRecentPosts\", params: \"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key\", render: function () { this.el.attr(\"id\", \"ds-recent-comments\") }, prepare: function (e) { return { list: H.map(e.response, function (e) { return new F(e).toJSON() }) } } }), st.RecentVisitors = Q.extend({ tmpl: \"recentVisitors\", uri: \"sites/listVisitors\", params: \"show-time avatar-size num-items channel-key\", render: function () { this.el.children().detach(), this.el.attr(\"id\", \"ds-recent-visitors\").append(this.waitingEl = H(et.waitingImg())) } }), st.TopThreads = Q.extend({ tmpl: \"topThreads\", uri: \"sites/listTopThreads\", params: \"range num-items channel-key\", render: function () { this.el.children().detach(), this.el.attr(\"id\", \"ds-top-threads\").append(this.waitingEl = H(et.waitingImg())) } }), st.LoginWidget = Q.extend({ tmpl: \"loginWidget\", render: function () { var e = this.el; e.attr(\"id\", \"ds-login\").html(et.loginWidget([\"weixin\", \"weibo\", \"qq\", \"renren\", \"kaixin\", \"douban\"])), e.find(\"a\").click(l), e.find(\"a.ds-logout\").attr(\"href\", Z.logoutUrl()) } }), st.ThreadCount = Q.extend({ onload: function (e) { var t = this.el, s = t.data(\"count-type\") || \"comments\", a = e.data[s]; t[t.data(\"replace\") ? \"replaceWith\" : \"html\"](z[s + \"_\" + (a ? a > 1 ? \"multiple\" : \"one\" : \"zero\")].replace(\"{num}\", a)) } }), st.ShareWidget = Q.extend({ tmpl: \"shareWidget\", render: function () { var e = { copyright: \"多说分享插件\", services: [\"weibo\", \"qzone\", \"sohu\", \"renren\", \"netease\", \"qqt\", \"kaixin\", \"douban\", \"qq\", \"meilishuo\", \"mogujie\", \"baidu\", \"taobao\", \"google\", \"wechat\", \"diandian\", \"huaban\", \"duitang\", \"youdao\", \"pengyou\", \"facebook\", \"twitter\", \"linkedin\", \"msn\"] }; this.el.attr(\"id\", \"ds-share\"), this.el.children().attr(\"id\", \"ds-reset\"), this.el.find(\".ds-share-aside-inner\").html(et.shareWidget(e)), this.el.find(\".ds-share-icons-more\").html(et.shareWidget(e)), this.el.find(\".ds-share-icons-more\").hide(), this.el.hasClass(\"flat\") && this.el.find(\"a\").each(function () { H(this).addClass(\"flat\") }), p(this.el), this.delegateEvents() }, delegateEvents: function () { var s = this, i = s.el; if (i.children().hasClass(\"ds-share-inline\")) { var r = \".ds-share-icons-more\", n = i.find(r), d = \"[data-toggle=ds-share-icons-more]\"; i.delegate(d, \"mouseover\", function () { n.show() }), i.delegate(d, \"mouseout\", function () { n.hide() }), i.delegate(r, \"mouseover\", function () { n.show() }), i.delegate(r, \"mouseout\", function () { n.hide() }) } else { var l = i.children().hasClass(\"ds-share-aside-left\") ? \"slide-to-right\" : \"slide-to-left\", c = i.children(); if (!o.cssProperty(\"transition\")) { var u = i.children().hasClass(\"ds-share-aside-left\") ? \"left\" : \"right\"; i.delegate(\".ds-share-aside-toggle\", \"mouseover\", function () { var e = {}, s = P.ie6 && \"right\" === u; s ? e.left = (t.documentElement.scrollLeft + t.documentElement.clientWidth - this.offsetWidth - (parseInt(this.currentStyle.marginLeft, 10) || 0) - parseInt(this.currentStyle.marginRight, 10) || 0) - 195 : e[u] = 0, c.animate(e, 200) }), i.delegate(\".ds-share-aside-inner\", \"mouseleave\", function () { var e = {}, s = P.ie6 && \"right\" === u; s ? e.left = (t.documentElement.scrollLeft + t.documentElement.clientWidth - this.offsetWidth - (parseInt(this.currentStyle.marginLeft, 10) || 0) - parseInt(this.currentStyle.marginRight, 10) || 0) + 230 : e[u] = -229, c.animate(e, 200) }) } i.delegate(\".ds-share-aside-toggle,.ds-share-aside-inner\", \"mouseover\", function () { c.addClass(l) }), i.delegate(\".ds-share-aside-toggle,.ds-share-aside-inner\", \"mouseleave\", function () { c.removeClass(l) }) } i.delegate(\"a\", \"click\", function (t) { var s = H(this).data(\"service\"); if (!i.data(\"url\"))return void alert(\"请设置data-url\"); if (\"wechat\" === s) { var r = a() + \"/api/qrcode/getImage.png\", n = \"?size=240&text=\" + i.data(\"url\"), d = E(et[\"dialog-qrcode\"]({ qrcode_url: r + n, url: i.data(\"url\") })); d.el.find(\".ds-dialog\").css(\"width\", \"320px\") } else { var l = a() + \"/share-proxy/?\" + o.param({ service: H(this).data(\"service\"), thread_key: i.data(\"threadKey\"), title: i.data(\"title\"), images: i.data(\"images\"), content: i.data(\"content\"), url: i.data(\"url\") }); e.open(l, \"_blank\") } t.preventDefault(), t.stopPropagation() }) } }); var it = 0; S.initSelector = function (e, t) { function s(e) { W(e), o.extend(z, e.options), dt.set(e.response) } var a = []; !q() || !H.isReady && j || H(e).each(function (e, s) { var i = H(s); if (!i.data(\"initialized\")) { i.data(\"initialized\", !0); var r = new st[t.type](i, t); if (at.push(r), \"ThreadCount\" === t.type) { var n = i.attr(\"data-thread-key\"); i.attr(\"data-channel-key\") && (n = i.attr(\"data-channel-key\") + \":\" + n), a.push(n), dt[n] || (dt[n] = new G({})), dt[n].on(\"reset\", function () { r.onload(this) }) } else if (r.uri) { var o = {}; H.each(r.params.split(\" \"), function (e, t) { o[t.replace(/-/g, \"_\")] = i.attr(\"data-\" + t) || i.data(t) }), R.get(r.uri, B(o), function (e) { r.load(e) }) } } }), a.length && R.get(\"threads/counts\", B({threads: a.join(\",\")}), s) }, (S.initView = function () { H.each(O, S.initSelector) })(), H(function () { if (!c) { if (!q())return C.error(\"缺少 duoshuoQuery 的定义\"); C.warn(\"请在加载多说 embed.js 之前定义 duoshuoQuery\") } setInterval(function () { H(\".ds-time\").each(function () { var e = H(this).attr(\"datetime\"); e && (this.innerHTML = S.elapsedTime(e)) }) }, 2e4), c.ondomready && c.ondomready(), S.initView(), !it && c.short_name && R.get(\"analytics/ping\", B({}), W) }) }) } }(window, document);"},{"title":"","date":"2017-10-25T03:09:10.856Z","updated":"2017-10-25T03:09:10.856Z","comments":true,"path":"lib/jquery.min.js","permalink":"http://www.clarencep.com/lib/jquery.min.js","excerpt":"","text":"/*! jQuery v2.1.4 | (c) 2005, 2015 jQuery Foundation, Inc. | jquery.org/license */ !function(a,b){\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error(\"jQuery requires a window with a document\");return b(a)}:b(a)}(\"undefined\"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m=\"2.1.4\",n=function(a,b){return new n.fn.init(a,b)},o=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,p=/^-ms-/,q=/-([\\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:\"\",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for(\"boolean\"==typeof g&&(j=g,g=arguments[h]||{},h++),\"object\"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:\"jQuery\"+(m+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return\"function\"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return\"object\"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,\"isPrototypeOf\")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+\"\":\"object\"==typeof a||\"function\"==typeof a?h[i.call(a)]||\"object\":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf(\"use strict\")?(b=l.createElement(\"script\"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,\"ms-\").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?\"\":(a+\"\").replace(o,\"\")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,\"string\"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return\"string\"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each(\"Boolean Number String Function Array Date RegExp Object Error\".split(\" \"),function(a,b){h[\"[object \"+b+\"]\"]=b.toLowerCase()});function s(a){var b=\"length\"in a&&a.length,c=n.type(a);return\"function\"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:\"array\"===c||0===b||\"number\"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=\"sizzle\"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C=1"},{"title":"","date":"2017-10-25T03:09:10.856Z","updated":"2017-10-25T03:09:10.856Z","comments":true,"path":"lib/zepto.js","permalink":"http://www.clarencep.com/lib/zepto.js","excerpt":"","text":"/* Zepto v1.1.3-4-g7e7e10b - zepto event ajax form detect fx fx_methods selector touch gesture - zeptojs.com/license */ define(function(require, exports, module){ var Zepto = (function() { var undefined, key, $, classList, emptyArray = [], slice = emptyArray.slice, filter = emptyArray.filter, document = window.document, elementDisplay = {}, classCache = {}, cssNumber = { 'column-count': 1, 'columns': 1, 'font-weight': 1, 'line-height': 1,'opacity': 1, 'z-index': 1, 'zoom': 1 }, fragmentRE = /^\\s*]*>/, singleTagRE = /^(?:|)$/, tagExpanderRE = /]*)\\/>/ig, rootNodeRE = /^(?:body|html)$/i, capitalRE = /([A-Z])/g, // special attributes that should be get/set via method calls methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset'], adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ], table = document.createElement('table'), tableRow = document.createElement('tr'), containers = { 'tr': document.createElement('tbody'), 'tbody': table, 'thead': table, 'tfoot': table, 'td': tableRow, 'th': tableRow, '*': document.createElement('div') }, readyRE = /complete|loaded|interactive/, simpleSelectorRE = /^[\\w-]*$/, class2type = {}, toString = class2type.toString, zepto = {}, camelize, uniq, tempParent = document.createElement('div'), propMap = { 'tabindex': 'tabIndex', 'readonly': 'readOnly', 'for': 'htmlFor', 'class': 'className', 'maxlength': 'maxLength', 'cellspacing': 'cellSpacing', 'cellpadding': 'cellPadding', 'rowspan': 'rowSpan', 'colspan': 'colSpan', 'usemap': 'useMap', 'frameborder': 'frameBorder', 'contenteditable': 'contentEditable' }, isArray = Array.isArray || function(object){ return object instanceof Array } zepto.matches = function(element, selector) { if (!selector || !element || element.nodeType !== 1) return false var matchesSelector = element.webkitMatchesSelector || element.mozMatchesSelector || element.oMatchesSelector || element.matchesSelector if (matchesSelector) return matchesSelector.call(element, selector) // fall back to performing a selector: var match, parent = element.parentNode, temp = !parent if (temp) (parent = tempParent).appendChild(element) match = ~zepto.qsa(parent, selector).indexOf(element) temp && tempParent.removeChild(element) return match } function type(obj) { return obj == null ? String(obj) : class2type[toString.call(obj)] || \"object\" } function isFunction(value) { return type(value) == \"function\" } function isWindow(obj) { return obj != null && obj == obj.window } function isDocument(obj) { return obj != null && obj.nodeType == obj.DOCUMENT_NODE } function isObject(obj) { return type(obj) == \"object\" } function isPlainObject(obj) { return isObject(obj) && !isWindow(obj) && Object.getPrototypeOf(obj) == Object.prototype } function likeArray(obj) { return typeof obj.length == 'number' } function compact(array) { return filter.call(array, function(item){ return item != null }) } function flatten(array) { return array.length > 0 ? $.fn.concat.apply([], array) : array } camelize = function(str){ return str.replace(/-+(.)?/g, function(match, chr){ return chr ? chr.toUpperCase() : '' }) } function dasherize(str) { return str.replace(/::/g, '/') .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2') .replace(/([a-z\\d])([A-Z])/g, '$1_$2') .replace(/_/g, '-') .toLowerCase() } uniq = function(array){ return filter.call(array, function(item, idx){ return array.indexOf(item) == idx }) } function classRE(name) { return name in classCache ? classCache[name] : (classCache[name] = new RegExp('(^|\\\\s)' + name + '(\\\\s|$)')) } function maybeAddPx(name, value) { return (typeof value == \"number\" && !cssNumber[dasherize(name)]) ? value + \"px\" : value } function defaultDisplay(nodeName) { var element, display if (!elementDisplay[nodeName]) { element = document.createElement(nodeName) document.body.appendChild(element) display = getComputedStyle(element, '').getPropertyValue(\"display\") element.parentNode.removeChild(element) display == \"none\" && (display = \"block\") elementDisplay[nodeName] = display } return elementDisplay[nodeName] } function children(element) { return 'children' in element ? slice.call(element.children) : $.map(element.childNodes, function(node){ if (node.nodeType == 1) return node }) } // `$.zepto.fragment` takes a html string and an optional tag name // to generate DOM nodes nodes from the given html string. // The generated DOM nodes are returned as an array. // This function can be overriden in plugins for example to make // it compatible with browsers that don't support the DOM fully. zepto.fragment = function(html, name, properties) { var dom, nodes, container // A special case optimization for a single tag if (singleTagRE.test(html)) dom = $(document.createElement(RegExp.$1)) if (!dom) { if (html.replace) html = html.replace(tagExpanderRE, \"\") if (name === undefined) name = fragmentRE.test(html) && RegExp.$1 if (!(name in containers)) name = '*' container = containers[name] container.innerHTML = '' + html dom = $.each(slice.call(container.childNodes), function(){ container.removeChild(this) }) } if (isPlainObject(properties)) { nodes = $(dom) $.each(properties, function(key, value) { if (methodAttributes.indexOf(key) > -1) nodes[key](value) else nodes.attr(key, value) }) } return dom } // `$.zepto.Z` swaps out the prototype of the given `dom` array // of nodes with `$.fn` and thus supplying all the Zepto functions // to the array. Note that `__proto__` is not supported on Internet // Explorer. This method can be overriden in plugins. zepto.Z = function(dom, selector) { dom = dom || [] dom.__proto__ = $.fn dom.selector = selector || '' return dom } // `$.zepto.isZ` should return `true` if the given object is a Zepto // collection. This method can be overriden in plugins. zepto.isZ = function(object) { return object instanceof zepto.Z } // `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and // takes a CSS selector and an optional context (and handles various // special cases). // This method can be overriden in plugins. zepto.init = function(selector, context) { var dom // If nothing given, return an empty Zepto collection if (!selector) return zepto.Z() // Optimize for string selectors else if (typeof selector == 'string') { selector = selector.trim() // If it's a html fragment, create nodes from it // Note: In both Chrome 21 and Firefox 15, DOM error 12 // is thrown if the fragment doesn't begin with = 0 ? idx : idx + this.length] }, toArray: function(){ return this.get() }, size: function(){ return this.length }, remove: function(){ return this.each(function(){ if (this.parentNode != null) this.parentNode.removeChild(this) }) }, each: function(callback){ emptyArray.every.call(this, function(el, idx){ return callback.call(el, idx, el) !== false }) return this }, filter: function(selector){ if (isFunction(selector)) return this.not(this.not(selector)) return $(filter.call(this, function(element){ return zepto.matches(element, selector) })) }, add: function(selector,context){ return $(uniq(this.concat($(selector,context)))) }, is: function(selector){ return this.length > 0 && zepto.matches(this[0], selector) }, not: function(selector){ var nodes=[] if (isFunction(selector) && selector.call !== undefined) this.each(function(idx){ if (!selector.call(this,idx)) nodes.push(this) }) else { var excludes = typeof selector == 'string' ? this.filter(selector) : (likeArray(selector) && isFunction(selector.item)) ? slice.call(selector) : $(selector) this.forEach(function(el){ if (excludes.indexOf(el) < 0) nodes.push(el) }) } return $(nodes) }, has: function(selector){ return this.filter(function(){ return isObject(selector) ? $.contains(this, selector) : $(this).find(selector).size() }) }, eq: function(idx){ return idx === -1 ? this.slice(idx) : this.slice(idx, + idx + 1) }, first: function(){ var el = this[0] return el && !isObject(el) ? el : $(el) }, last: function(){ var el = this[this.length - 1] return el && !isObject(el) ? el : $(el) }, find: function(selector){ var result, $this = this if (typeof selector == 'object') result = $(selector).filter(function(){ var node = this return emptyArray.some.call($this, function(parent){ return $.contains(parent, node) }) }) else if (this.length == 1) result = $(zepto.qsa(this[0], selector)) else result = this.map(function(){ return zepto.qsa(this, selector) }) return result }, closest: function(selector, context){ var node = this[0], collection = false if (typeof selector == 'object') collection = $(selector) while (node && !(collection ? collection.indexOf(node) >= 0 : zepto.matches(node, selector))) node = node !== context && !isDocument(node) && node.parentNode return $(node) }, parents: function(selector){ var ancestors = [], nodes = this while (nodes.length > 0) nodes = $.map(nodes, function(node){ if ((node = node.parentNode) && !isDocument(node) && ancestors.indexOf(node) < 0) { ancestors.push(node) return node } }) return filtered(ancestors, selector) }, parent: function(selector){ return filtered(uniq(this.pluck('parentNode')), selector) }, children: function(selector){ return filtered(this.map(function(){ return children(this) }), selector) }, contents: function() { return this.map(function() { return slice.call(this.childNodes) }) }, siblings: function(selector){ return filtered(this.map(function(i, el){ return filter.call(children(el.parentNode), function(child){ return child!==el }) }), selector) }, empty: function(){ return this.each(function(){ this.innerHTML = '' }) }, // `pluck` is borrowed from Prototype.js pluck: function(property){ return $.map(this, function(el){ return el[property] }) }, show: function(){ return this.each(function(){ this.style.display == \"none\" && (this.style.display = '') if (getComputedStyle(this, '').getPropertyValue(\"display\") == \"none\") this.style.display = defaultDisplay(this.nodeName) }) }, replaceWith: function(newContent){ return this.before(newContent).remove() }, wrap: function(structure){ var func = isFunction(structure) if (this[0] && !func) var dom = $(structure).get(0), clone = dom.parentNode || this.length > 1 return this.each(function(index){ $(this).wrapAll( func ? structure.call(this, index) : clone ? dom.cloneNode(true) : dom ) }) }, wrapAll: function(structure){ if (this[0]) { $(this[0]).before(structure = $(structure)) var children // drill down to the inmost element while ((children = structure.children()).length) structure = children.first() $(structure).append(this) } return this }, wrapInner: function(structure){ var func = isFunction(structure) return this.each(function(index){ var self = $(this), contents = self.contents(), dom = func ? structure.call(this, index) : structure contents.length ? contents.wrapAll(dom) : self.append(dom) }) }, unwrap: function(){ this.parent().each(function(){ $(this).replaceWith($(this).children()) }) return this }, clone: function(){ return this.map(function(){ return this.cloneNode(true) }) }, hide: function(){ return this.css(\"display\", \"none\") }, toggle: function(setting){ return this.each(function(){ var el = $(this) ;(setting === undefined ? el.css(\"display\") == \"none\" : setting) ? el.show() : el.hide() }) }, prev: function(selector){ return $(this.pluck('previousElementSibling')).filter(selector || '*') }, next: function(selector){ return $(this.pluck('nextElementSibling')).filter(selector || '*') }, html: function(html){ return arguments.length === 0 ? (this.length > 0 ? this[0].innerHTML : null) : this.each(function(idx){ var originHtml = this.innerHTML $(this).empty().append( funcArg(this, html, idx, originHtml) ) }) }, text: function(text){ return arguments.length === 0 ? (this.length > 0 ? this[0].textContent : null) : this.each(function(){ this.textContent = (text === undefined) ? '' : ''+text }) }, attr: function(name, value){ var result return (typeof name == 'string' && value === undefined) ? (this.length == 0 || this[0].nodeType !== 1 ? undefined : (name == 'value' && this[0].nodeName == 'INPUT') ? this.val() : (!(result = this[0].getAttribute(name)) && name in this[0]) ? this[0][name] : result ) : this.each(function(idx){ if (this.nodeType !== 1) return if (isObject(name)) for (key in name) setAttribute(this, key, name[key]) else setAttribute(this, name, funcArg(this, value, idx, this.getAttribute(name))) }) }, removeAttr: function(name){ return this.each(function(){ this.nodeType === 1 && setAttribute(this, name) }) }, prop: function(name, value){ name = propMap[name] || name return (value === undefined) ? (this[0] && this[0][name]) : this.each(function(idx){ this[name] = funcArg(this, value, idx, this[name]) }) }, data: function(name, value){ var data = this.attr('data-' + name.replace(capitalRE, '-$1').toLowerCase(), value) return data !== null ? deserializeValue(data) : undefined }, val: function(value){ return arguments.length === 0 ? (this[0] && (this[0].multiple ? $(this[0]).find('option').filter(function(){ return this.selected }).pluck('value') : this[0].value) ) : this.each(function(idx){ this.value = funcArg(this, value, idx, this.value) }) }, offset: function(coordinates){ if (coordinates) return this.each(function(index){ var $this = $(this), coords = funcArg(this, coordinates, index, $this.offset()), parentOffset = $this.offsetParent().offset(), props = { top: coords.top - parentOffset.top, left: coords.left - parentOffset.left } if ($this.css('position') == 'static') props['position'] = 'relative' $this.css(props) }) if (this.length==0) return null var obj = this[0].getBoundingClientRect() return { left: obj.left + window.pageXOffset, top: obj.top + window.pageYOffset, width: Math.round(obj.width), height: Math.round(obj.height) } }, css: function(property, value){ if (arguments.length < 2) { var computedStyle, element = this[0] if(!element) return computedStyle = getComputedStyle(element, '') if (typeof property == 'string') return element.style[camelize(property)] || computedStyle.getPropertyValue(property) else if (isArray(property)) { var props = {} $.each(isArray(property) ? property: [property], function(_, prop){ props[prop] = (element.style[camelize(prop)] || computedStyle.getPropertyValue(prop)) }) return props } } var css = '' if (type(property) == 'string') { if (!value && value !== 0) this.each(function(){ this.style.removeProperty(dasherize(property)) }) else css = dasherize(property) + \":\" + maybeAddPx(property, value) } else { for (key in property) if (!property[key] && property[key] !== 0) this.each(function(){ this.style.removeProperty(dasherize(key)) }) else css += dasherize(key) + ':' + maybeAddPx(key, property[key]) + ';' } return this.each(function(){ this.style.cssText += ';' + css }) }, index: function(element){ return element ? this.indexOf($(element)[0]) : this.parent().children().indexOf(this[0]) }, hasClass: function(name){ if (!name) return false return emptyArray.some.call(this, function(el){ return this.test(className(el)) }, classRE(name)) }, addClass: function(name){ if (!name) return this return this.each(function(idx){ classList = [] var cls = className(this), newName = funcArg(this, name, idx, cls) newName.split(/\\s+/g).forEach(function(klass){ if (!$(this).hasClass(klass)) classList.push(klass) }, this) classList.length && className(this, cls + (cls ? \" \" : \"\") + classList.join(\" \")) }) }, removeClass: function(name){ return this.each(function(idx){ if (name === undefined) return className(this, '') classList = className(this) funcArg(this, name, idx, classList).split(/\\s+/g).forEach(function(klass){ classList = classList.replace(classRE(klass), \" \") }) className(this, classList.trim()) }) }, toggleClass: function(name, when){ if (!name) return this return this.each(function(idx){ var $this = $(this), names = funcArg(this, name, idx, className(this)) names.split(/\\s+/g).forEach(function(klass){ (when === undefined ? !$this.hasClass(klass) : when) ? $this.addClass(klass) : $this.removeClass(klass) }) }) }, scrollTop: function(value){ if (!this.length) return var hasScrollTop = 'scrollTop' in this[0] if (value === undefined) return hasScrollTop ? this[0].scrollTop : this[0].pageYOffset return this.each(hasScrollTop ? function(){ this.scrollTop = value } : function(){ this.scrollTo(this.scrollX, value) }) }, scrollLeft: function(value){ if (!this.length) return var hasScrollLeft = 'scrollLeft' in this[0] if (value === undefined) return hasScrollLeft ? this[0].scrollLeft : this[0].pageXOffset return this.each(hasScrollLeft ? function(){ this.scrollLeft = value } : function(){ this.scrollTo(value, this.scrollY) }) }, position: function() { if (!this.length) return var elem = this[0], // Get *real* offsetParent offsetParent = this.offsetParent(), // Get correct offsets offset = this.offset(), parentOffset = rootNodeRE.test(offsetParent[0].nodeName) ? { top: 0, left: 0 } : offsetParent.offset() // Subtract element margins // note: when an element has margin: auto the offsetLeft and marginLeft // are the same in Safari causing offset.left to incorrectly be 0 offset.top -= parseFloat( $(elem).css('margin-top') ) || 0 offset.left -= parseFloat( $(elem).css('margin-left') ) || 0 // Add offsetParent borders parentOffset.top += parseFloat( $(offsetParent[0]).css('border-top-width') ) || 0 parentOffset.left += parseFloat( $(offsetParent[0]).css('border-left-width') ) || 0 // Subtract the two offsets return { top: offset.top - parentOffset.top, left: offset.left - parentOffset.left } }, offsetParent: function() { return this.map(function(){ var parent = this.offsetParent || document.body while (parent && !rootNodeRE.test(parent.nodeName) && $(parent).css(\"position\") == \"static\") parent = parent.offsetParent return parent }) } } // for now $.fn.detach = $.fn.remove // Generate the `width` and `height` functions ;['width', 'height'].forEach(function(dimension){ var dimensionProperty = dimension.replace(/./, function(m){ return m[0].toUpperCase() }) $.fn[dimension] = function(value){ var offset, el = this[0] if (value === undefined) return isWindow(el) ? el['inner' + dimensionProperty] : isDocument(el) ? el.documentElement['scroll' + dimensionProperty] : (offset = this.offset()) && offset[dimension] else return this.each(function(idx){ el = $(this) el.css(dimension, funcArg(this, value, idx, el[dimension]())) }) } }) function traverseNode(node, fun) { fun(node) for (var key in node.childNodes) traverseNode(node.childNodes[key], fun) } // Generate the `after`, `prepend`, `before`, `append`, // `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods. adjacencyOperators.forEach(function(operator, operatorIndex) { var inside = operatorIndex % 2 //=> prepend, append $.fn[operator] = function(){ // arguments can be nodes, arrays of nodes, Zepto objects and HTML strings var argType, nodes = $.map(arguments, function(arg) { argType = type(arg) return argType == \"object\" || argType == \"array\" || arg == null ? arg : zepto.fragment(arg) }), parent, copyByClone = this.length > 1 if (nodes.length < 1) return this return this.each(function(_, target){ parent = inside ? target : target.parentNode // convert all methods to a \"before\" operation target = operatorIndex == 0 ? target.nextSibling : operatorIndex == 1 ? target.firstChild : operatorIndex == 2 ? target : null nodes.forEach(function(node){ if (copyByClone) node = node.cloneNode(true) else if (!parent) return $(node).remove() traverseNode(parent.insertBefore(node, target), function(el){ if (el.nodeName != null && el.nodeName.toUpperCase() === 'SCRIPT' && (!el.type || el.type === 'text/javascript') && !el.src) window['eval'].call(window, el.innerHTML) }) }) }) } // after => insertAfter // prepend => prependTo // before => insertBefore // append => appendTo $.fn[inside ? operator+'To' : 'insert'+(operatorIndex ? 'Before' : 'After')] = function(html){ $(html)[operator](this) return this } }) zepto.Z.prototype = $.fn // Export internal API functions in the `$.zepto` namespace zepto.uniq = uniq zepto.deserializeValue = deserializeValue $.zepto = zepto return $ })() window.Zepto = Zepto window.$ === undefined && (window.$ = Zepto) ;(function($){ var _zid = 1, undefined, slice = Array.prototype.slice, isFunction = $.isFunction, isString = function(obj){ return typeof obj == 'string' }, handlers = {}, specialEvents={}, focusinSupported = 'onfocusin' in window, focus = { focus: 'focusin', blur: 'focusout' }, hover = { mouseenter: 'mouseover', mouseleave: 'mouseout' } specialEvents.click = specialEvents.mousedown = specialEvents.mouseup = specialEvents.mousemove = 'MouseEvents' function zid(element) { return element._zid || (element._zid = _zid++) } function findHandlers(element, event, fn, selector) { event = parse(event) if (event.ns) var matcher = matcherFor(event.ns) return (handlers[zid(element)] || []).filter(function(handler) { return handler && (!event.e || handler.e == event.e) && (!event.ns || matcher.test(handler.ns)) && (!fn || zid(handler.fn) === zid(fn)) && (!selector || handler.sel == selector) }) } function parse(event) { var parts = ('' + event).split('.') return {e: parts[0], ns: parts.slice(1).sort().join(' ')} } function matcherFor(ns) { return new RegExp('(?:^| )' + ns.replace(' ', ' .* ?') + '(?: |$)') } function eventCapture(handler, captureSetting) { return handler.del && (!focusinSupported && (handler.e in focus)) || !!captureSetting } function realEvent(type) { return hover[type] || (focusinSupported && focus[type]) || type } function add(element, events, fn, data, selector, delegator, capture){ var id = zid(element), set = (handlers[id] || (handlers[id] = [])) events.split(/\\s/).forEach(function(event){ if (event == 'ready') return $(document).ready(fn) var handler = parse(event) handler.fn = fn handler.sel = selector // emulate mouseenter, mouseleave if (handler.e in hover) fn = function(e){ var related = e.relatedTarget if (!related || (related !== this && !$.contains(this, related))) return handler.fn.apply(this, arguments) } handler.del = delegator var callback = delegator || fn handler.proxy = function(e){ e = compatible(e) if (e.isImmediatePropagationStopped()) return e.data = data var result = callback.apply(element, e._args == undefined ? [e] : [e].concat(e._args)) if (result === false) e.preventDefault(), e.stopPropagation() return result } handler.i = set.length set.push(handler) if ('addEventListener' in element) element.addEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture)) }) } function remove(element, events, fn, selector, capture){ var id = zid(element) ;(events || '').split(/\\s/).forEach(function(event){ findHandlers(element, event, fn, selector).forEach(function(handler){ delete handlers[id][handler.i] if ('removeEventListener' in element) element.removeEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture)) }) }) } $.event = { add: add, remove: remove } $.proxy = function(fn, context) { if (isFunction(fn)) { var proxyFn = function(){ return fn.apply(context, arguments) } proxyFn._zid = zid(fn) return proxyFn } else if (isString(context)) { return $.proxy(fn[context], fn) } else { throw new TypeError(\"expected function\") } } $.fn.bind = function(event, data, callback){ return this.on(event, data, callback) } $.fn.unbind = function(event, callback){ return this.off(event, callback) } $.fn.one = function(event, selector, data, callback){ return this.on(event, selector, data, callback, 1) } var returnTrue = function(){return true}, returnFalse = function(){return false}, ignoreProperties = /^([A-Z]|returnValue$|layer[XY]$)/, eventMethods = { preventDefault: 'isDefaultPrevented', stopImmediatePropagation: 'isImmediatePropagationStopped', stopPropagation: 'isPropagationStopped' } function compatible(event, source) { if (source || !event.isDefaultPrevented) { source || (source = event) $.each(eventMethods, function(name, predicate) { var sourceMethod = source[name] event[name] = function(){ this[predicate] = returnTrue return sourceMethod && sourceMethod.apply(source, arguments) } event[predicate] = returnFalse }) if (source.defaultPrevented !== undefined ? source.defaultPrevented : 'returnValue' in source ? source.returnValue === false : source.getPreventDefault && source.getPreventDefault()) event.isDefaultPrevented = returnTrue } return event } function createProxy(event) { var key, proxy = { originalEvent: event } for (key in event) if (!ignoreProperties.test(key) && event[key] !== undefined) proxy[key] = event[key] return compatible(proxy, event) } $.fn.delegate = function(selector, event, callback){ return this.on(event, selector, callback) } $.fn.undelegate = function(selector, event, callback){ return this.off(event, selector, callback) } $.fn.live = function(event, callback){ $(document.body).delegate(this.selector, event, callback) return this } $.fn.die = function(event, callback){ $(document.body).undelegate(this.selector, event, callback) return this } $.fn.on = function(event, selector, data, callback, one){ var autoRemove, delegator, $this = this if (event && !isString(event)) { $.each(event, function(type, fn){ $this.on(type, selector, data, fn, one) }) return $this } if (!isString(selector) && !isFunction(callback) && callback !== false) callback = data, data = selector, selector = undefined if (isFunction(data) || data === false) callback = data, data = undefined if (callback === false) callback = returnFalse return $this.each(function(_, element){ if (one) autoRemove = function(e){ remove(element, e.type, callback) return callback.apply(this, arguments) } if (selector) delegator = function(e){ var evt, match = $(e.target).closest(selector, element).get(0) if (match && match !== element) { evt = $.extend(createProxy(e), {currentTarget: match, liveFired: element}) return (autoRemove || callback).apply(match, [evt].concat(slice.call(arguments, 1))) } } add(element, event, callback, data, selector, delegator || autoRemove) }) } $.fn.off = function(event, selector, callback){ var $this = this if (event && !isString(event)) { $.each(event, function(type, fn){ $this.off(type, selector, fn) }) return $this } if (!isString(selector) && !isFunction(callback) && callback !== false) callback = selector, selector = undefined if (callback === false) callback = returnFalse return $this.each(function(){ remove(this, event, callback, selector) }) } $.fn.trigger = function(event, args){ event = (isString(event) || $.isPlainObject(event)) ? $.Event(event) : compatible(event) event._args = args return this.each(function(){ // items in the collection might not be DOM elements if('dispatchEvent' in this) this.dispatchEvent(event) else $(this).triggerHandler(event, args) }) } // triggers event handlers on current element just as if an event occurred, // doesn't trigger an actual event, doesn't bubble $.fn.triggerHandler = function(event, args){ var e, result this.each(function(i, element){ e = createProxy(isString(event) ? $.Event(event) : event) e._args = args e.target = element $.each(findHandlers(element, event.type || event), function(i, handler){ result = handler.proxy(e) if (e.isImmediatePropagationStopped()) return false }) }) return result } // shortcut methods for `.bind(event, fn)` for each event type ;('focusin focusout load resize scroll unload click dblclick '+ 'mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave '+ 'change select keydown keypress keyup error').split(' ').forEach(function(event) { $.fn[event] = function(callback) { return callback ? this.bind(event, callback) : this.trigger(event) } }) ;['focus', 'blur'].forEach(function(name) { $.fn[name] = function(callback) { if (callback) this.bind(name, callback) else this.each(function(){ try { this[name]() } catch(e) {} }) return this } }) $.Event = function(type, props) { if (!isString(type)) props = type, type = props.type var event = document.createEvent(specialEvents[type] || 'Events'), bubbles = true if (props) for (var name in props) (name == 'bubbles') ? (bubbles = !!props[name]) : (event[name] = props[name]) event.initEvent(type, bubbles, true) return compatible(event) } })(Zepto) ;(function($){ var jsonpID = 0, document = window.document, key, name, rscript = / 0 && typeof properties === 'object') { cssValues[transitionProperty] = cssProperties.join(', ') cssValues[transitionDuration] = duration + 's' cssValues[transitionDelay] = delay + 's' cssValues[transitionTiming] = (ease || 'linear') } } wrappedCallback = function(event){ if (typeof event !== 'undefined') { if (event.target !== event.currentTarget) return // makes sure the event didn't bubble from \"below\" $(event.target).unbind(endEvent, wrappedCallback) } else $(this).unbind(endEvent, wrappedCallback) // triggered by setTimeout fired = true $(this).css(cssReset) callback && callback.call(this) } if (duration > 0){ this.bind(endEvent, wrappedCallback) // transitionEnd is not always firing on older Android phones // so make sure it gets fired setTimeout(function(){ if (fired) return wrappedCallback.call(that) }, (duration * 1000) + 25) } // trigger page reflow so new elements can animate this.size() && this.get(0).clientLeft this.css(cssValues) if (duration 0) this.css('opacity', 0) else target = 1 return origShow.call(this).fadeTo(speed, target, callback) } $.fn.fadeOut = function(speed, callback) { return hide(this, speed, null, callback) } $.fn.fadeToggle = function(speed, callback) { return this.each(function(){ var el = $(this) el[ (el.css('opacity') == 0 || el.css('display') == 'none') ? 'fadeIn' : 'fadeOut' ](speed, callback) }) } })(Zepto) ;(function($){ var zepto = $.zepto, oldQsa = zepto.qsa, oldMatches = zepto.matches function visible(elem){ elem = $(elem) return !!(elem.width() || elem.height()) && elem.css(\"display\") !== \"none\" } // Implements a subset from: // http://api.jquery.com/category/selectors/jquery-selector-extensions/ // // Each filter function receives the current index, all nodes in the // considered set, and a value if there were parentheses. The value // of `this` is the node currently being considered. The function returns the // resulting node(s), null, or undefined. // // Complex selectors are not supported: // li:has(label:contains(\"foo\")) + li:has(label:contains(\"bar\")) // ul.inner:first > li var filters = $.expr[':'] = { visible: function(){ if (visible(this)) return this }, hidden: function(){ if (!visible(this)) return this }, selected: function(){ if (this.selected) return this }, checked: function(){ if (this.checked) return this }, parent: function(){ return this.parentNode }, first: function(idx){ if (idx === 0) return this }, last: function(idx, nodes){ if (idx === nodes.length - 1) return this }, eq: function(idx, _, value){ if (idx === value) return this }, contains: function(idx, _, text){ if ($(this).text().indexOf(text) > -1) return this }, has: function(idx, _, sel){ if (zepto.qsa(this, sel).length) return this } } var filterRe = new RegExp('(.*):(\\\\w+)(?:\\\\(([^)]+)\\\\))?$\\\\s*'), childRe = /^\\s*>/, classTag = 'Zepto' + (+new Date()) function process(sel, fn) { // quote the hash in `a[href^=#]` expression sel = sel.replace(/=#\\]/g, '=\"#\"]') var filter, arg, match = filterRe.exec(sel) if (match && match[2] in filters) { filter = filters[match[2]], arg = match[3] sel = match[1] if (arg) { var num = Number(arg) if (isNaN(num)) arg = arg.replace(/^[\"']|[\"']$/g, '') else arg = num } } return fn(sel, filter, arg) } zepto.qsa = function(node, selector) { return process(selector, function(sel, filter, arg){ try { var taggedParent if (!sel && filter) sel = '*' else if (childRe.test(sel)) // support \"> *\" child queries by tagging the parent node with a // unique class and prepending that classname onto the selector taggedParent = $(node).addClass(classTag), sel = '.'+classTag+' '+sel var nodes = oldQsa(node, sel) } catch(e) { console.error('error performing selector: %o', selector) throw e } finally { if (taggedParent) taggedParent.removeClass(classTag) } return !filter ? nodes : zepto.uniq($.map(nodes, function(n, i){ return filter.call(n, i, nodes, arg) })) }) } zepto.matches = function(node, selector){ return process(selector, function(sel, filter, arg){ return (!sel || oldMatches(node, sel)) && (!filter || filter.call(node, null, arg) === node) }) } })(Zepto) ;(function($){ var touch = {}, touchTimeout, tapTimeout, swipeTimeout, longTapTimeout, longTapDelay = 750, gesture function swipeDirection(x1, x2, y1, y2) { return Math.abs(x1 - x2) >= Math.abs(y1 - y2) ? (x1 - x2 > 0 ? 'Left' : 'Right') : (y1 - y2 > 0 ? 'Up' : 'Down') } function longTap() { longTapTimeout = null if (touch.last) { touch.el.trigger('longTap') touch = {} } } function cancelLongTap() { if (longTapTimeout) clearTimeout(longTapTimeout) longTapTimeout = null } function cancelAll() { if (touchTimeout) clearTimeout(touchTimeout) if (tapTimeout) clearTimeout(tapTimeout) if (swipeTimeout) clearTimeout(swipeTimeout) if (longTapTimeout) clearTimeout(longTapTimeout) touchTimeout = tapTimeout = swipeTimeout = longTapTimeout = null touch = {} } function isPrimaryTouch(event){ return (event.pointerType == 'touch' || event.pointerType == event.MSPOINTER_TYPE_TOUCH) && event.isPrimary } function isPointerEventType(e, type){ return (e.type == 'pointer'+type || e.type.toLowerCase() == 'mspointer'+type) } $(document).ready(function(){ var now, delta, deltaX = 0, deltaY = 0, firstTouch, _isPointerType if ('MSGesture' in window) { gesture = new MSGesture() gesture.target = document.body } $(document) .bind('MSGestureEnd', function(e){ var swipeDirectionFromVelocity = e.velocityX > 1 ? 'Right' : e.velocityX < -1 ? 'Left' : e.velocityY > 1 ? 'Down' : e.velocityY < -1 ? 'Up' : null; if (swipeDirectionFromVelocity) { touch.el.trigger('swipe') touch.el.trigger('swipe'+ swipeDirectionFromVelocity) } }) .on('touchstart MSPointerDown pointerdown', function(e){ if((_isPointerType = isPointerEventType(e, 'down')) && !isPrimaryTouch(e)) return firstTouch = _isPointerType ? e : e.touches[0] if (e.touches && e.touches.length === 1 && touch.x2) { // Clear out touch movement data if we have it sticking around // This can occur if touchcancel doesn't fire due to preventDefault, etc. touch.x2 = undefined touch.y2 = undefined } now = Date.now() delta = now - (touch.last || now) touch.el = $('tagName' in firstTouch.target ? firstTouch.target : firstTouch.target.parentNode) touchTimeout && clearTimeout(touchTimeout) touch.x1 = firstTouch.pageX touch.y1 = firstTouch.pageY if (delta > 0 && delta 10) e.preventDefault(); }) .on('touchend MSPointerUp pointerup', function(e){ if((_isPointerType = isPointerEventType(e, 'up')) && !isPrimaryTouch(e)) return cancelLongTap() // swipe if ((touch.x2 && Math.abs(touch.x1 - touch.x2) > 30) || (touch.y2 && Math.abs(touch.y1 - touch.y2) > 30)) swipeTimeout = setTimeout(function() { touch.el.trigger('swipe') touch.el.trigger('swipe' + (swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2))) touch = {} }, 0) // normal tap else if ('last' in touch) // don't fire tap when delta position changed by more than 30 pixels, // for instance when moving to a point and back to origin if (deltaX < 30 && deltaY < 30) { // delay by one tick so we can cancel the 'tap' event if 'scroll' fires // ('tap' fires before 'scroll') tapTimeout = setTimeout(function() { // trigger universal 'tap' with the option to cancelTouch() // (cancelTouch cancels processing of single vs double taps for faster 'tap' response) var event = $.Event('tap') event.cancelTouch = cancelAll touch.el.trigger(event) // trigger double tap immediately if (touch.isDoubleTap) { if (touch.el) touch.el.trigger('doubleTap') touch = {} } // trigger single tap after 250ms of inactivity else { touchTimeout = setTimeout(function(){ touchTimeout = null if (touch.el) touch.el.trigger('singleTap') touch = {} }, 250) } }, 0) } else { touch = {} } deltaX = deltaY = 0 }) // when the browser window loses focus, // for example when a modal dialog is shown, // cancel all ongoing events .on('touchcancel MSPointerCancel pointercancel', cancelAll) // scrolling the window indicates intention of the user // to scroll, not tap or swipe, so cancel all ongoing events $(window).on('scroll', cancelAll) }) ;['swipe', 'swipeLeft', 'swipeRight', 'swipeUp', 'swipeDown', 'doubleTap', 'tap', 'singleTap', 'longTap'].forEach(function(eventName){ $.fn[eventName] = function(callback){ return this.on(eventName, callback) } }) })(Zepto) ;(function($){ if ($.os.ios) { var gesture = {}, gestureTimeout function parentIfText(node){ return 'tagName' in node ? node : node.parentNode } $(document).bind('gesturestart', function(e){ var now = Date.now(), delta = now - (gesture.last || now) gesture.target = parentIfText(e.target) gestureTimeout && clearTimeout(gestureTimeout) gesture.e1 = e.scale gesture.last = now }).bind('gesturechange', function(e){ gesture.e2 = e.scale }).bind('gestureend', function(e){ if (gesture.e2 > 0) { Math.abs(gesture.e1 - gesture.e2) != 0 && $(gesture.target).trigger('pinch') && $(gesture.target).trigger('pinch' + (gesture.e1 - gesture.e2 > 0 ? 'In' : 'Out')) gesture.e1 = gesture.e2 = gesture.last = 0 } else if ('last' in gesture) { gesture = {} } }) ;['pinch', 'pinchIn', 'pinchOut'].forEach(function(m){ $.fn[m] = function(callback){ return this.bind(m, callback) } }) } })(Zepto) if ( typeof module === \"object\" && module && typeof module.exports === \"object\" ) { module.exports = Zepto; } else { window.Zepto = window.$ = Zepto; if ( typeof define === \"function\" && define.amd ) { define( \"zepto/zepto\", [], function () { return Zepto; } ); } } })"}],"posts":[{"title":"git报错bad signature和index file corrupt的处理方法","slug":"a-note-to-git-error-bad-signature-index-file-corrupt","date":"2017-10-23T00:00:00.000Z","updated":"2017-10-25T03:09:10.844Z","comments":true,"path":"2017/10/23/a-note-to-git-error-bad-signature-index-file-corrupt/","link":"","permalink":"http://www.clarencep.com/2017/10/23/a-note-to-git-error-bad-signature-index-file-corrupt/","excerpt":"今天打开工程，习惯性地git status下，却发现以下报错： λ git status error: bad signature fatal: index file corrupt 这该怎么办呢？","text":"今天打开工程，习惯性地git status下，却发现以下报错： λ git status error: bad signature fatal: index file corrupt 这该怎么办呢？ index file在 git 里面一般指的是 .git/index 这个文件。这个文件保存的是暂存区的信息（索引信息）。可以通过 git ls-files --stage 来查看暂存区的内容。这个文件很重要！但是现在报 index file corrupt，说明这个文件已经损坏了。还好，我们有办法重新来生成这个文件：git read-tree 或者直接 git reset. 解决办法： 进入到工程目录下: cd /path/to/dir 删除或重命名 .git/index 文件： rm -f .git/index 或 mv .git/index{,.bak} 重建 .git/index : git read-tree 或者直接 git reset 这样3步后再运行git status即可正常显示git状态了： λ git status On branch master Your branch is up-to-date with &#39;origin/master&#39;. nothing to commit, working directory clean","categories":[{"name":"git","slug":"git","permalink":"http://www.clarencep.com/categories/git/"}],"tags":[{"name":"git","slug":"git","permalink":"http://www.clarencep.com/tags/git/"},{"name":"error","slug":"error","permalink":"http://www.clarencep.com/tags/error/"}]},{"title":"HTML中嵌入SVG图片的N种方式","slug":"n-ways-to-show-svg-image-in-html","date":"2017-08-31T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2017/08/31/n-ways-to-show-svg-image-in-html/","link":"","permalink":"http://www.clarencep.com/2017/08/31/n-ways-to-show-svg-image-in-html/","excerpt":"最近用到了个SVG图片，里面还是带&lt;image&gt;标签的，想要把它嵌入到HTML中还是有些工作要做的。","text":"最近用到了个SVG图片，里面还是带&lt;image&gt;标签的，想要把它嵌入到HTML中还是有些工作要做的。 经历最初的图片是这样写的： &lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot;?&gt; &lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt; &lt;svg version=&quot;1.1&quot; preserveAspectRatio=&quot;xMinYMin meet&quot; width=&quot;660&quot; height=&quot;342&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&gt; &lt;image xlink:href=&quot;https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/img/logo/bd_logo1_31bdc765.png&quot; width=&quot;660&quot; height=&quot;342&quot;/&gt; &lt;rect x=&quot;2&quot; y=&quot;284&quot; width=&quot;656&quot; height=&quot;58&quot; fill=&quot;rgba(0,0,0,0.6)&quot; stroke-width=&quot;1&quot; &gt;&lt;/rect&gt; &lt;text text-anchor=&quot;start&quot; font-family=&quot;Microsoft Yahei, sans-serif&quot; font-size=&quot;28&quot; x=&quot;20&quot; y=&quot;322&quot; fill=&quot;#fff&quot;&gt;这是百度&lt;/text&gt; &lt;text text-anchor=&quot;end&quot; font-family=&quot;Microsoft Yahei, sans-serif&quot; font-size=&quot;28&quot; x=&quot;640&quot; y=&quot;322&quot; fill=&quot;#fff&quot;&gt;😄&lt;/text&gt; &lt;/svg&gt; p.s. 先拿百度的图片来凑个数 显示效果应该是： 但是通过&lt;img&gt;标签插入到HTML中后却变成了这样： W.T.F! 查了半天MDN，也没有什么收获。 最后在 StackOverflow 上找到了一个解决方案：即使用&lt;embed&gt;标签。 修改成&lt;embed src=&quot;./test.svg&quot; style=&quot;display:block;width:330px;height:240px&quot; /&gt;后却显示成了： 只显示了图片左上角那部分有木有！这张图片是按2倍图做的，应该要缩小一半，虽然给&lt;embed&gt;的元素加了宽高，但是却没能把svg内容给缩放！ 怎办？又找了半天解决方案，发现这种情况应该设置svg图片的viewBox -- 在&lt;svg&gt;元素上增加viewBox=&quot;0 0 660 342&quot;即可解决这个问题： viewBox属性允许指定一个给定的一组图形伸展以适应特定的容器元素。-- viewBox - MDN 完美！ 总结HTML中嵌入SVG图片的N种方式在解决这个问题的过程中，顺便查了下，发现除了&lt;img&gt;和&lt;embed&gt;外还有几种嵌入SVG图片的方法。在此总结下： 0. 使用svg标签 即直接把svg整个标签内容（除了开头的xml和doctype声明外的svg文件内容）都丢到 HTML 中即可。可惜不适合本例 -- 我们这次的svg是外部的，不好放入HTML中。 1. 使用img标签 &lt;img src=&quot;./test.svg&quot; style=&quot;display:block;width:330px;height:240px&quot; /&gt; 这个是最容易想到的 -- 因为svg图片也是图片嘛。需要注意的是，svg里面带的&lt;image&gt;标签将无法正常显示。&lt;img&gt;标签适合显示纯矢量+文本的SVG图片。 2. 使用iframe标签 &lt;iframe src=&quot;./test.svg&quot; style=&quot;display:block;width:330px;height:240px;border:none;&quot; &gt;&lt;/iframe&gt; 万能的iframe当然什么都能显示，但是无法控制内容大小 -- viewBox也搞不定，估计只能用百分比来定位了，太麻烦了，不建议使用。 3. 使用embed标签 &lt;embed src=&quot;./test.svg&quot; style=&quot;display:block;width:330px;height:240px&quot; /&gt; 注意使用viewBox，&lt;embed&gt;标签的兼容性也很不错的，是个不错的选择。 4. 使用object标签 &lt;object type=&quot;image/svg+xml&quot; data=&quot;./test.svg&quot; style=&quot;display:block;width:330px;height:240px&quot; &gt; &lt;param name=&quot;src&quot; value=&quot;./test.svg&quot; &gt; &lt;/object&gt; &lt;object&gt;与&lt;embed&gt;类似，也要注意配置viewBox. 5. 使用div的背景图片 &lt;div style=&quot;display:block;width:330px;height:240px;background: url(./test.svg) no-repeat;background-size: 100%;&quot; &gt;&lt;/div&gt; svg图片是可以作为背景图片的。不过和&lt;img&gt;标签一样，无法显示SVG内嵌的&lt;image&gt;. 6. 使用picture标签 &lt;picture &gt; &lt;source srcset=&quot;./test.svg&quot; type=&quot;image/svg+xml&quot;&gt; &lt;img src=&quot;./test.png&quot; style=&quot;display:block;width:330px;height:240px&quot;&gt; &lt;/picture&gt; &lt;picture&gt;标签是HTML5新增的一个专门显示图片的标签。 注意设置&lt;source&gt;标签的属性srcset而非src. 此外必需要添加一个&lt;img&gt;标签，不过可以在&lt;img&gt;标签中指定另外一张图片，以便在浏览器无法显示&lt;source&gt;指定的图片的时候显示&lt;img&gt;标签中的图片。 &lt;picture&gt;和&lt;img&gt;一样，无法显示SVG内嵌的&lt;image&gt;. 附完整带测试代码:效果展示：https://clarencep.github.io/fe-lab/svg-in-html/ 源代码：https://github.com/clarencep/fe-lab/tree/master/svg-in-html/dist","categories":[{"name":"SVG","slug":"SVG","permalink":"http://www.clarencep.com/categories/SVG/"}],"tags":[{"name":"HTML","slug":"HTML","permalink":"http://www.clarencep.com/tags/HTML/"},{"name":"SVG","slug":"SVG","permalink":"http://www.clarencep.com/tags/SVG/"}]},{"title":"【翻译】Monolog使用说明 - 即Monolog中文文档","slug":"monolog-usage-zh","date":"2017-07-05T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2017/07/05/monolog-usage-zh/","link":"","permalink":"http://www.clarencep.com/2017/07/05/monolog-usage-zh/","excerpt":"前言最近项目中使用的 Monolog 出了点小问题，去翻其文档，发现居然只有英文的。趁业余时间，翻译一下吧。以下是其使用说明的中文翻译。更多翻译内容见 clarence-pan/monolog-zh-doc. 使用 Monolog 安装 核心概念 日志级别 配置一个日志服务 为记录添加额外的数据 使用通道 自定义日志格式","text":"前言最近项目中使用的 Monolog 出了点小问题，去翻其文档，发现居然只有英文的。趁业余时间，翻译一下吧。以下是其使用说明的中文翻译。更多翻译内容见 clarence-pan/monolog-zh-doc. 使用 Monolog 安装 核心概念 日志级别 配置一个日志服务 为记录添加额外的数据 使用通道 自定义日志格式 安装Monolog 在 Packagist (monolog/monolog) 上可用，并且可以通过 Composer 安装: composer require monolog/monolog 如果你不使用 Composer, 那你可以从 GitHub 上获取代码，然后使用任何兼容 PSR-0 的自动加载器（比如Symfony2 ClassLoader 组件）来加载 Monolog 的类 核心概念每一个日志服务实例 (Logger) 都有一个通道（名称），并有一个处理器 (Handler)栈. 无论何时你添加一条 记录 到对应的日志服务实例，这个处理器栈将被遍历一遍：每个处理器都将依次决定是否要处理这条记录，而如果要处理，则遍历结束（译注：类似DOM事件冒泡）。 这样子可以创建非常灵活的日志配置。比如一个 StreamHandler 可以把所有日志都写入磁盘，而上面加个MailHandler 可以把错误日志作为邮件发送出去。处理器还有一个 $bubble 属性定义了是否屏蔽某条记录或者处理了某条记录。在这个示例中，配置 MailHandler 的 $bubble 参数为 false 则意味着 MailHandler 将不会把自己已处理过的记录继续冒泡给 StreamHandler. 你可以创建许多日志服务实例(Logger)，每一个则定义一个通道（比如数据库、请求、路由...）。而每一个日志服务实例都可以组合各种各样的处理器，可以共享处理器也可以不共享。这个通道将会在日志中反映出来，从而允许你可以很容易地查看或者筛选记录。 每一个处理还会有一个格式化器（Formatter）。如果你没有配置一个，则一个有意义的默认的格式化器将被创建。格式化器用来规范化并格式化输入的记录，以便处理器能输出一些有用的信息。 不支持自定义的严重性级别。只支持使用RFC 5424中定义的八个级别（调试/Debug、信息/Info、提示/Notice、警告/Warning、错误/Error、严重/Critical、警报/Alert、紧急/Emergency）来作为基本的筛选目的。不过，如果为了排序或者其他需要灵活性的使用场景，你可以添加加工程序（Processor）从而可以在（处理器）处理前添加额外的信息（标签、用户IP...）。 日志级别Monolog 支持一下 RFC 5424 中的日志级别： 调试/DEBUG (100): 详细的调试信息。 信息/INFO (200): 有意义的事件，比如用户登录、SQL日志。 提示/NOTICE (250): 正常但是值得注意的事件。 警告/WARNING (300): 异常事件，但是并不是错误。比如使用了废弃了的API，错误地使用了一个API，以及其他不希望发生但是并非必要的错误。 错误/ERROR (400): 运行时的错误，不需要立即注意到，但是需要被专门记录并监控到。 严重/CRITICAL (500): 边界条件/危笃场景。比如应用组件不可用了，未预料到的异常。 警报/ALERT (550): 必须立即采取行动。比如整个网站都挂了，数据库不可用了等。这种情况应该发送短信警报，并把你叫醒。 紧急/EMERGENCY (600): 紧急请求：系统不可用了。 配置一个日志服务这里有一个基本的配置，可以记录日志到文件，并在 DEBUG 级别下记录到 firephp 中: &lt;?php use Monolog\\Logger; use Monolog\\Handler\\StreamHandler; use Monolog\\Handler\\FirePHPHandler; // 创建日志服务 $logger = new Logger(&#39;my_logger&#39;); // 添加一些处理器 $logger-&gt;pushHandler(new StreamHandler(__DIR__.&#39;/my_app.log&#39;, Logger::DEBUG)); $logger-&gt;pushHandler(new FirePHPHandler()); // 现在你就可以用日志服务了 $logger-&gt;info(&#39;My logger is now ready&#39;); 解释一下。第一步是创建日志服务实例，这个实例后将在代码中用到。唯一的参数是通道的名称，它在你有多个日志服务实例的时候很有用。（更多详情参见下面） 这个日志服务实例自己是不是知道如何处理一条日志记录的。它把记录代理给了一些处理器。上面的代码中注册了两个处理器到栈中，以便允许使用两种不同的方式来处理日志记录。 注意，FirePHPHandler 是被先调用的，因而它被添加到了栈顶。这允许你临时添加一个禁止冒泡的处理器从而允许你覆盖其他配置的日志（处理器）。 如果你单独使用 Monolog, 并且在寻找一种简单的方式来配置许多处理器，那可以用theorchard/monolog-cascade 。它可以帮你使用PHP数组、YAML或者JSON来构建复杂的日志配置。 为记录添加额外的数据Monolog 提供了两种不同的方式来为简单的文本消息增加额外的信息 使用上下文(context)第一种方式是使用上下文（context），这允许你在传递记录的时候传递一个数组格式的数据： &lt;?php $logger-&gt;info(&#39;Adding a new user&#39;, array(&#39;username&#39; =&gt; &#39;Seldaek&#39;)); 简单的处理器（比如StreamHandler）将只是把数组转换成字符串。而复杂的处理器则可以利用上下文的优点（如 FirePHP 则将以一种优美的方式显示数组）。 使用加工程序(Processor)第二种方式是使用加工程序来为所有的记录添加额外数据。加工程序可以是任何可以调用的函数。加工程序接收日志记录作为参数，并且需要在修改了extra字段后再返回日志记录。让我们来写一个添加一些假数据的加工程序： &lt;?php $logger-&gt;pushProcessor(function ($record) { $record[&#39;extra&#39;][&#39;dummy&#39;] = &#39;Hello world!&#39;; return $record; }); Monolog提供了一些内置的加工程序，你可以在你的项目中使用它们。请参见对应的章节. 小技巧：加工程序可以被注册到一个特定的处理器上而不是直接在日志服务实例上，从而可以只在对应的处理器上生效。 使用通道通道是一种非常棒的方式来区分是应用的哪个部分的日志被记录下来的。这通常在大型项目中非常有用（而且被Symfony2的MonologBundle所使用）。 假设有两个日志服务实例共享了一个处理器，这个处理器将日志写入单个日志文件。通道则将允许你来区分是哪个日志服务实例记录了哪条日志。你可以很简单地通过通道来筛选日志。 &lt;?php use Monolog\\Logger; use Monolog\\Handler\\StreamHandler; use Monolog\\Handler\\FirePHPHandler; // 创建一些处理器 $stream = new StreamHandler(__DIR__.&#39;/my_app.log&#39;, Logger::DEBUG); $firephp = new FirePHPHandler(); // 创建应用的主要日志服务实例 $logger = new Logger(&#39;my_logger&#39;); $logger-&gt;pushHandler($stream); $logger-&gt;pushHandler($firephp); // 使用另外的通道来创建安全相关的日志服务示例 $securityLogger = new Logger(&#39;security&#39;); $securityLogger-&gt;pushHandler($stream); $securityLogger-&gt;pushHandler($firephp); // 或者克隆第一个，只是改变下通道 $securityLogger = $logger-&gt;withName(&#39;security&#39;); 自定义日志格式在Monolog中，可以很简单地来自定义日志的格式，无论是写入文件、套接字、邮件、数据库还是其他处理器。大多数处理器都是用 $record[&#39;formatted&#39;] 这个值来自动写入日志设备。这个值依赖格式化器的配置。你可以选择预定义的格式化器类，也可以自己写一个（比如一个可读的多行文本文件）。 想要配置一个预定义的格式化器类，可以直接把它设置为处理器的字段： // 默认的日期格式是 &quot;Y-m-d H:i:s&quot; $dateFormat = &quot;Y n j, g:i a&quot;; // 默认的输出格式是 &quot;[%datetime%] %channel%.%level_name%: %message% %context% %extra%\\n&quot; $output = &quot;%datetime% &gt; %level_name% &gt; %message% %context% %extra%\\n&quot;; // 最后创建一个格式化器 $formatter = new LineFormatter($output, $dateFormat); // 创建一个处理器 $stream = new StreamHandler(__DIR__.&#39;/my_app.log&#39;, Logger::DEBUG); $stream-&gt;setFormatter($formatter); // 将其绑定到日志服务对象上 $securityLogger = new Logger(&#39;security&#39;); $securityLogger-&gt;pushHandler($stream); // 你还可以在多个处理器之间复用同一个格式化器，并且在多个日志服务实例间共享这些处理器。 处理器、格式化器和加工程序 &rarr; 说明：本文首发地址：https://www.clarencep.com/2017/07/05/monolog-usage-zh/，转载请注明出处，如有翻译得不当之处欢迎指正。","categories":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/tags/PHP/"},{"name":"Monolog","slug":"Monolog","permalink":"http://www.clarencep.com/tags/Monolog/"},{"name":"Translations","slug":"Translations","permalink":"http://www.clarencep.com/tags/Translations/"},{"name":"翻译","slug":"翻译","permalink":"http://www.clarencep.com/tags/翻译/"},{"name":"中文文档","slug":"中文文档","permalink":"http://www.clarencep.com/tags/中文文档/"},{"name":"Monolog中文文档","slug":"Monolog中文文档","permalink":"http://www.clarencep.com/tags/Monolog中文文档/"}]},{"title":"密码存储中MD5的安全问题与替代方案","slug":"safe-way-to-store-password","date":"2017-05-31T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2017/05/31/safe-way-to-store-password/","link":"","permalink":"http://www.clarencep.com/2017/05/31/safe-way-to-store-password/","excerpt":"md5安全吗？有多么地不安全？如何才能安全地存储密码？...","text":"md5安全吗？有多么地不安全？如何才能安全地存储密码？... md5安全吗？经过各种安全事件后，很多系统在存放密码的时候不会直接存放明文密码了，大都改成了存放了 md5 加密（hash）后的密码，可是这样真的安全吗？ 这儿有个脚本来测试下MD5的速度, 测试结果: [root@f4d5945f1d7c tools]# php speed-of-md5.php Array ( [rounds] =&gt; 100 [times of a round] =&gt; 1000000 [avg] =&gt; 0.23415904045105 [max] =&gt; 0.28906106948853 [min] =&gt; 0.21188998222351 ) 有没有发现一个问题：MD5速度太快了，导致很容易进行暴力破解. 简单计算一下： &gt; Math.pow(10, 6) / 1000000 * 0.234 0.234 &gt; Math.pow(36, 6) / 1000000 * 0.234 / 60 8.489451110400001 &gt; Math.pow(62, 6) / 1000000 * 0.234 / 60 / 60 3.69201531296 使用6位纯数字密码，破解只要0.234秒！ 使用6位数字+小写字母密码，破解只要8.49分钟！ 使用6位数字+大小写混合字母密码，破解只要3.69个小时！ 当然，使用长一点的密码会显著提高破解难度： &gt; Math.pow(10, 8) / 1000000 * 0.234 23.400000000000002 &gt; Math.pow(36, 8) / 1000000 * 0.234 / 60 / 60 / 24 7.640505999359999 &gt; Math.pow(62, 8) / 1000000 * 0.234 / 60 / 60 / 24 / 365 1.6201035231755982 使用8位纯数字密码，破解要23.4秒！ 使用8位数字+小写字母密码，破解要7.64小时！ 使用8位数字+大小写混合字母密码，破解要1.62年！ 但是，别忘了，这个速度只是用PHP这个解释型语言在笔者的弱鸡个人电脑（i5-4460 CPU 3.20GHz）上跑出来的，还只是利用了一个线程一个CPU核心。若是放到最新的 Xeon E7 v4系列CPU的服务器上跑，充分利用其48个线程，并使用C语言来重写下测试代码，很容易就能提升个几百上千倍速度。那么即使用8位数字+大小写混合字母密码，破解也只要14小时！ 更何况，很多人的密码都是采用比较有规律的字母或数字，更能降低暴力破解的难度... 如果没有加盐或加固定的盐，那么彩虹表破解就更easy了... 那么如何提升密码存储的安全性呢？bcrypt!提升安全性就是提升密码的破解难度，至少让暴力破解难度提升到攻击者无法负担的地步。（当然用户密码的长度当然也很重要，建议至少8位，越长越安全） 这里不得不插播一句：PHP果然是世界上最好的语言 -- 标准库里面已经给出了解决方案。 PHP 5.5 的版本中加入了 password_xxx 系列函数, 而对之前的版本，也有兼容库可以用：password_compat.在这个名叫“密码散列算法”的核心扩展中提供了一系列简洁明了的对密码存储封装的函数。简单介绍下： password_hash 是对密码进行加密（hash），目前默认用（也只能用）bcrypt算法，相当于一个加强版的md5函数 password_verify 是一个验证密码的函数，内部采用的安全的字符串比较算法，可以预防基于时间的攻击, 相当于 $hashedPassword === md5($inputPassword) password_needs_rehash 是判断是否需要升级的一个函数，这个函数厉害了，下面再来详细讲 password_hash 需要传入一个算法，现在默认和可以使用的都只有bcrypt算法，这个算法是怎么样的一个算法呢？为什么PHP标准库里面会选择bcrypt呢? bcrypt是基于 Blowfish 算法的一种专门用于密码哈希的算法，由 Niels Provos 和 David Mazieres 设计的。这个算法的特别之处在于，别的算法都是追求快，这个算法中有一个至关重要的参数：cost. 正如其名，这个值越大，耗费的时间越长，而且是指数级增长 -- 其加密流程中有一部分是这样的： EksBlowfishSetup(cost, salt, key) state &lt;- InitState() state &lt;- ExpandKey(state, salt, key) repeat (2^cost) // &quot;^&quot;表示指数关系 state &lt;- ExpandKey(state, 0, key) state &lt;- ExpandKey(state, 0, salt) return state 比如下面是笔者的一次测试结果（个人弱机PC, i5-4460 CPU 3.20GHz） ： cost time 8 0.021307 9 0.037150 10 0.079283 11 0.175612 12 0.317375 13 0.663080 14 1.330451 15 2.245152 16 4.291169 17 8.318790 18 16.472902 19 35.146999 附：测试代码 这个速度与md5相比简直是蜗牛与猎豹的差别 -- 即使按照cost=8, 一个8位的大小写字母+数字的密码也要14万年才能暴力破解掉，更何况一般服务器都会至少设置为10或更大的值（那就需要54万年或更久了）。 显然，cost不是越大越好，越大的话会越占用服务器的CPU，反而容易引起DOS攻击。建议根据服务器的配置和业务的需求设置为10~12即可。最好同时对同一IP同一用户的登录尝试次数做限制，预防DOS攻击。 一个安全地存储密码的方案总上所述，一个安全地存储密码的方案应该是这样子的：（直接放代码吧） class User extends BaseModel { const PASSWORD_COST = 11; // 这里配置bcrypt算法的代价，根据需要来随时升级 const PASSWORD_ALGO = PASSWORD_BCRYPT; // 默认使用（现在也只能用）bcrypt /** * 验证密码是否正确 * * @param string $plainPassword 用户密码的明文 * @param bool $autoRehash 是否自动重新计算下密码的hash值（如果有必要的话） * @return bool */ public function verifyPassword($plainPassword, $autoRehash = true) { if (password_verify($plainPassword, $this-&gt;password)) { if ($autoRehash &amp;&amp; password_needs_rehash($this-&gt;password, self::PASSWORD_ALGO, [&#39;cost&#39; =&gt; self::PASSWORD_COST])) { $this-&gt;updatePassword($plainPassword); } return true; } return false; } /** * 更新密码 * * @param string $newPlainPassword */ public function updatePassword($newPlainPassword) { $this-&gt;password = password_hash($newPlainPassword, self::PASSWORD_ALGO, [&#39;cost&#39; =&gt; self::PASSWORD_COST]); $this-&gt;save(); } } 这样子，在用户注册或修改密码的时候就调用 $user-&gt;updatePassword() 来设置密码，而登录的时候就调用 $user-&gt;verifyPassword() 来验证下密码是否正确。当硬件性能提升到一定程度，而cost=11无法满足安全需求的时候，则修改下 PASSWORD_COST 的值即可无缝升级，让存放的密码更安全。","categories":[{"name":"Security","slug":"Security","permalink":"http://www.clarencep.com/categories/Security/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/tags/PHP/"},{"name":"Security","slug":"Security","permalink":"http://www.clarencep.com/tags/Security/"},{"name":"md5","slug":"md5","permalink":"http://www.clarencep.com/tags/md5/"},{"name":"password","slug":"password","permalink":"http://www.clarencep.com/tags/password/"}]},{"title":"无需安装 vsftpd , 直接使用 FTP 来管理 docker 容器中的文件","slug":"ftp-server-for-docker","date":"2017-04-15T10:46:59.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2017/04/15/ftp-server-for-docker/","link":"","permalink":"http://www.clarencep.com/2017/04/15/ftp-server-for-docker/","excerpt":"","text":"无图无真相，先放个效果图： 背景使用 docker 来跑一些服务很方便，但是有的时候想管理容器里面的文件却很麻烦 -- 一般常规做法有3种： 通过数据卷或数据卷容器的方式 启动容器的时候时候启动 vsftpd 或者 sshd 等服务，并开启端口映射，然后通过 ftp/sftp 连上去管理 进入容器的终端，通过命令行管理 但是这些做法都有一定的缺陷和不便： 1和2都是需要在启动容器的时候做一些配置，如果容器已经启动了就歇菜了。而且2需要额外的端口映射，占用主机的端口。3的做法比较 geek ，而容器中通常只有基础的 shell 工具，没有一个熟悉的工具套件环境，操作比较费时费力，不够直观。 解决方案： ftp-server-for-docker我所能想到比较好的解决方案是综合2和3的方案，构建一个不需要额外的启动配置的 FTP 服务器：ftp-server-for-docker 这是一个 docker 专用的 FTP 服务器 - 允许通过 FTP 协议来访问 docker 容器中的文件（即使 docker 容器已经启动了也可以的哟）。基于 linux shell sh 和 docker 的 docker cp. 如何安装推荐使用 npm 安装: npm install -g ftp-server-for-docker 如何运行示例1比如说在 localhost:21 上启动 FTP 服务器，并运行 test 用户通过密码 123456 来访问： $ ftp-server-for-docker -H localhost -p 21 --users test:123456 FtpServer start listening at localhost:21 示例2使用 ftp-server-for-docker 来浏览容器 wordpress 中的文件: 查看命令行帮助想要知道更多使用方法，可以查看命令行帮助： $ ftp-server-for-docker --help Usage: ftp-server-for-docker [options] Options: --port, -p Specify which port to listen on(default is 21) [number] --host, -H Specify which host to bind(default is 0.0.0.0) [string] --annoymous, -a Whether enable annoymous user [boolean] --users, -u Specify users (in form like username:password, can be multiple) [array] --config, -c Specify which configuration file to use --debug Whether enable debug mode [boolean] -h, --help Show help [boolean] -?, --help Show help [boolean] Examples: ftp-server-for-docker -h localhost -p 21 Start the FTP Server on -u test:123 localhost:21, allow user `test` to access. 实现原理这个 FTP 服务器网络方面采用了比较成熟的 ftpd ，而文件系统模块替换成了新写的 Docker FS. 文件系统的基本操作（stat/readdir/open/unlink...）都是通过 docker exec、docker cp 和临时文件来完成，比如： stat 是通过 docker exec &lt;container&gt; stat xxx 来查看文件状态 readdir 是通过 docker exec &lt;container&gt; ls -1 --color=none 来列出目录下的文件 open 是通过 docker cp &lt;container&gt;:&lt;path&gt; &lt;temp-path&gt; 把容器中的文件拷贝到临时文件中，然后再读取的 具体实现流程参见源代码 关于 TypeScript这个项目中的主要源代码都使用 TypeScript -- 都是在 src/*.ts 中，通过 tsc 编译后生成成 lib/*.js，最终npm打包的只有 lib/*.js 没有 src/*.ts. 这是我第一次使用 TypeScript. TypeScript 的强类型带来很多方便，也带来很多不便。综合而言，TypeScript 让我想起了曾经使用过的 C#，结合 Visual Studio Code 来用还是利大于弊。TypeScript 能在编辑和编译的时候就检查出很多类型问题，而且智能提示确实很棒。 常见问题 FileZilla 无法列出目录结构 -- 可以尝试配置传输模式为 主动模式，被动模式还有问题，正在解决ing... 中文目录显示乱码 -- 已知问题，正在解决ing... 如有其他问题，欢迎来提 issue , 当然更欢迎 fork 并解决后来提 PR.","categories":[{"name":"docker","slug":"docker","permalink":"http://www.clarencep.com/categories/docker/"}],"tags":[{"name":"node.js","slug":"node-js","permalink":"http://www.clarencep.com/tags/node-js/"},{"name":"ftp","slug":"ftp","permalink":"http://www.clarencep.com/tags/ftp/"},{"name":"docker","slug":"docker","permalink":"http://www.clarencep.com/tags/docker/"},{"name":"container","slug":"container","permalink":"http://www.clarencep.com/tags/container/"},{"name":"TypeScript","slug":"TypeScript","permalink":"http://www.clarencep.com/tags/TypeScript/"}]},{"title":"`express` 框架中的参数小记","slug":"a-note-to-express-params","date":"2017-04-01T00:00:00.000Z","updated":"2017-10-25T03:09:10.844Z","comments":true,"path":"2017/04/01/a-note-to-express-params/","link":"","permalink":"http://www.clarencep.com/2017/04/01/a-note-to-express-params/","excerpt":"注意：req.params 只有在参数化的路径中的参数。查询字符串中的参数要用 req.query. 比如:","text":"注意：req.params 只有在参数化的路径中的参数。查询字符串中的参数要用 req.query. 比如: // server.js: app.post(&#39;/user/:id&#39;, function(req, res){ console.log(&#39;req.params: &#39;, req.params) console.log(&#39;req.query: &#39;, req.query) console.log(&#39;req.body: &#39;, req.body) }) // HTTP request: POST /user/123?foo=1&amp;bar=2 Content-Type: application/x-www-form-urlencoded aaa=1&amp;bbb=2 这样的请求，应该是要用 req.query.foo 和 req.query.bar 来获取 foo 和 bar 的值，最终打印出如下: req.params: { id: &#39;123&#39; } req.query: { foo: &#39;1&#39;, bar: &#39;2&#39; } req.body: { aaa: &#39;1&#39;, bbb: &#39;2&#39; } 关于 req.body此外，express 框架本身是没有解析 req.body 的 -- 如果打印出来 req.body: undefined则说明没有安装解析 req.body 的插件： 为了解析 req.body 一般可以安装 body-parser 这个插件： // 假设 `app` 是 `express` 的实例： const bodyParser = require(&#39;body-parser&#39;) // 在所有路由前插入这个中间件： app.use(bodyParser.urlencoded()) 这样就可以了。 bodyParser.urlencoded()是HTML中默认的查询字符串形式的编码,即application/x-www-form-urlencoded. 如果需要解析其他格式的，则需要分别加入其他格式的中间件，比如： bodyParser.json() 支持JSON格式（application/json） bodyParser.raw() 将会把 req.body 置为一个 Buffer (Content-Type：application/octet-stream) bodyParser.text() 将会把 req.body 置为一个 string (Content-Type: text/plain) 然而上传文件用的 multipart/form-data 格式却没有被 bodyParser 所支持，需要使用 busboy 之类的其他中间件。","categories":[{"name":"express","slug":"express","permalink":"http://www.clarencep.com/categories/express/"}],"tags":[{"name":"node.js","slug":"node-js","permalink":"http://www.clarencep.com/tags/node-js/"},{"name":"express","slug":"express","permalink":"http://www.clarencep.com/tags/express/"}]},{"title":"如何优雅地使用 VSCode 来编辑 vue 文件？","slug":"edit-vue-file-via-vscode","date":"2017-03-18T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2017/03/18/edit-vue-file-via-vscode/","link":"","permalink":"http://www.clarencep.com/2017/03/18/edit-vue-file-via-vscode/","excerpt":"最近有个项目使用了 Vue.js ，本来一直使用的是 PHPStorm 来进行开发，可是遇到了很多问题。 后来，果断放弃收费的 PHPStorm ，改用 vscode (Visual Stdio Code).当然 vscode 对 vue 也不是原生支持的，今天来扒一扒如何配置 vscode 以便优雅地编辑 vue 文件","text":"最近有个项目使用了 Vue.js ，本来一直使用的是 PHPStorm 来进行开发，可是遇到了很多问题。 后来，果断放弃收费的 PHPStorm ，改用 vscode (Visual Stdio Code).当然 vscode 对 vue 也不是原生支持的，今天来扒一扒如何配置 vscode 以便优雅地编辑 vue 文件 先来扒一扒使用 PHPStorm 遇到的问题： vue文件虽然可以通过插件来解决高亮问题，但是 &lt;script&gt; 标签中的 ES6 代码的识别老是出问题，箭头函数有的时候能正确识别，有的时候会报错 无法正确识别 vue 文件中的 jsx 语法 无法正确识别和高亮 vue 文件 &lt;style&gt; 标签中使用的 less 语法 vue文件中 &lt;template&gt; 部分使用了大量的自定义标签（自定义组件）和自定义属性，会报一堆 warning 经常性卡死 webpack实时编译的错误不能直接展示在代码编辑器内，还得自己到控制台中查看 如何安装 vscode很简单，传送门：官网下载安装 第一步，要支持 vue 文件的基本语法高亮这里，我试过好3个插件： vue, VueHelper 和 vetur ，最终选择使用 vetur 。 安装插件： Ctrl + P 然后输入 ext install vetur 然后回车点安装即可。 p.s: vscode 的插件安装比 PHPStorm 的插件安装更快捷方便，安装完成后还不用重启整个程序，只要重新加载下工作区窗口就可以了。 安装完 vetur 后还需要加上这样一段配置下： &quot;emmet.syntaxProfiles&quot;: { &quot;vue-html&quot;: &quot;html&quot;, &quot;vue&quot;: &quot;html&quot; } 这时可以打开一个vue文件试试，注意下右下角状态栏是否正确识别为 vue 类型： 如果被识别为 text 或 html ，则记得要点击切换下。 第二步，要支持 vue 文件的 ESLint可能还有人会问为什么要 ESLint ？没有 lint 的代码虽然也可能可以正确运行，但是 lint 作为编译前的一道检测成本更小，而且更快。此外， ESLint 还有很多规范是帮助我们写出更加优雅而不容易出错的代码的。 jshint 本来也是个不错的选择，但是 ESLint 对 jsx 的支持让我还是选择了 ESLint. 安装插件： Ctrl + P 然后输入 ext install eslint 然后回车点安装即可。 ESLint 不是安装后就可以用的，还需要一些环境和配置： 首先，需要全局的 ESLint , 如果没有安装可以使用 npm install -g eslint 来安装。 其次，vue文件是类 HTML 的文件，为了支持对 vue 文件的 ESLint ，需要 eslint-plugin-html 这个插件。可以使用 npm install -g eslint-plugin-html 来安装 接着，安装了 HTML 插件后，还需要在 vscode 中配置下 ESLint： &quot;eslint.validate&quot;: [ &quot;javascript&quot;, &quot;javascriptreact&quot;, &quot;html&quot;, &quot;vue&quot; ], &quot;eslint.options&quot;: { &quot;plugins&quot;: [&quot;html&quot;] }, 最后，别忘了在项目根目录下创建 .eslintrc.json , 如果还没创建，还可以使用下面快捷命令来创建： 这样一来 vue 中写的 js 代码也能正确地被 lint 了。 要是不小心少个括号之类的都可以有对应的报错: 多余 import 也都能报错: 还是蛮智能的。 第三步，配置构建任务vue 项目的构建我选择用 webpack ，不过，并不是直接使用命令行下的 webpack 而是使用了 webpack 的 API 写的 node 脚本。 脚本主要有两个，一个是 build/bin/build.js 另一个是 build/bin/watch.js 分别是单次构建和实时构建。 于是乎，对应 vscode 中的 tasks 也是有两个： build 和 watch ，简单配置如下： { // See https://go.microsoft.com/fwlink/?LinkId=733558 // for the documentation about the tasks.json format // use `Ctrl+P` and type `task` + SPACE + &lt;taskName&gt; to run a task &quot;version&quot;: &quot;0.1.0&quot;, &quot;tasks&quot;: [ { &quot;taskName&quot;: &quot;build&quot;, &quot;echoCommand&quot;: true, &quot;command&quot;: &quot;node&quot;, &quot;args&quot;: [ &quot;build/bin/build.js&quot; ], &quot;suppressTaskName&quot;: true, &quot;isBuildCommand&quot;: true }, { &quot;taskName&quot;: &quot;watch&quot;, &quot;echoCommand&quot;: true, &quot;command&quot;: &quot;node&quot;, &quot;args&quot;: [ &quot;build/bin/watch.js&quot; ], &quot;suppressTaskName&quot;: true, &quot;isBackground&quot;: true } ] } 这样配置好后，按 Ctrl + Shift + B 即可开始单次构建。 不过单次构建比较慢（要10秒+），一般我都用实时构建：Ctrl + P 然后输入 task watch &lt;回车&gt; 即可开始实时构建。实时构建除了第一次比较慢，其他时候还是非常快的，一般1秒内就可以构建好。 最后，webpack 构建错误提示webpack 构建失败后一般都会有错误提示，会显示在输出窗口中： 为啥是彩色的？ 因为装了 Output Colorizer 这个插件。 当然，这样还是不够方便 -- 实时构建是后台运行的，“输出”窗口一般也都是在后台，每次保存完文件还得点开岂不麻烦。 要是能做到像 ESLint 一样直接把错误标到编辑器上面就好了。真的可以吗？翻了下 vscode 的文档，发现有神奇的 problemMatcher -- 可以对任务输出进行解析，解析出的问题会显示在“问题”窗口中，如果还有文件名行号和列号，则会在源代码编辑窗口中对应的位置标出来。 先放个最终效果： 在这个文件的第32行，import 了一个不存在的模块，这样的错误在 ESLint 中当然是检查不出来的，然而在 webpack 的实时构建中会报错： 这个事情的困难在于两点： 如何通过 problemMatcher 把这个错误给抓出来？ 如何找到错误对应的行号？（如果可能的话，还有列号） webpack的错误输出格式并不是完全统一的，而且有些还没有行号 -- 一方面可能是 webpack 的 bug ，另一方面 vue 文件在构建的时候会拆成 template, script 和 style 三个方面进行构建，报错的行号可能对不上。 最终我的解决方案是对 webpack 的错误重新格式化输出，然后匹配： 首先，重新格式化输出需要 format-webpack-stats-errors-warnings 这个包（偶新写的） npm install --save-dev format-webpack-stats-errors-warnings 然后，到 build/bin/build.js 和 build/bin/watch.js 中在 webpack 构建完成的回调函数中增加这个格式化后的输出： 更多使用介绍见 github 最后，在 .vscode/tasks.json 中，每个任务下添加 problemWatcher: // ... { &quot;taskName&quot;: &quot;build&quot;, // ... // build 任务的: &quot;problemMatcher&quot;: { &quot;owner&quot;: &quot;webpack&quot;, &quot;fileLocation&quot;: [ &quot;relative&quot;, &quot;${workspaceRoot}&quot; ], &quot;pattern&quot;: { &quot;regexp&quot;: &quot;^!&gt;(\\\\w+): (\\\\S+)?:(\\\\d+),(\\\\d+)(?:~(?:(\\\\d+),)?(\\\\d+))?: (.*)$&quot;, &quot;severity&quot;: 1, &quot;file&quot;: 2, &quot;line&quot;: 3, &quot;column&quot;: 4, &quot;endLine&quot;: 5, &quot;endColumn&quot;: 6, &quot;message&quot;: 7 } } } { &quot;taskName&quot;: &quot;watch&quot;, // ... // watch 任务的： &quot;problemMatcher&quot;: { &quot;owner&quot;: &quot;webpack&quot;, &quot;fileLocation&quot;: [ &quot;relative&quot;, &quot;${workspaceRoot}&quot; ], &quot;pattern&quot;: { &quot;regexp&quot;: &quot;^!&gt;(\\\\w+): (\\\\S+)?:(\\\\d+),(\\\\d+)(?:~(?:(\\\\d+),)?(\\\\d+))?: (.*)$&quot;, &quot;severity&quot;: 1, &quot;file&quot;: 2, &quot;line&quot;: 3, &quot;column&quot;: 4, &quot;endLine&quot;: 5, &quot;endColumn&quot;: 6, &quot;message&quot;: 7 }, &quot;watching&quot;: { &quot;activeOnStart&quot;: true, &quot;beginsPattern&quot;: &quot;^\\\\s*Webpack begin run&quot;, &quot;endsPattern&quot;: &quot;^\\\\s*Build complete at&quot; } } // ... } // ... 注：在 watch 任务中，为了匹配何时开始和何时结束，我在 webpack 构建的 run 和 watch 时增加了一个 console.log(&#39;Webpack begin run&#39;) 的打印，而在构建完成后增加了一个 console.log(&quot;Build complete at ..&quot;) 的打印。 OK，终于基本搞定了 vscode ，可以愉快地开发 vue 应用了。","categories":[{"name":"vscode","slug":"vscode","permalink":"http://www.clarencep.com/categories/vscode/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"http://www.clarencep.com/tags/vscode/"},{"name":"Visual Stdio Code","slug":"Visual-Stdio-Code","permalink":"http://www.clarencep.com/tags/Visual-Stdio-Code/"},{"name":"vue","slug":"vue","permalink":"http://www.clarencep.com/tags/vue/"},{"name":"Vue.js","slug":"Vue-js","permalink":"http://www.clarencep.com/tags/Vue-js/"},{"name":"js","slug":"js","permalink":"http://www.clarencep.com/tags/js/"}]},{"title":"微信小程序开发踩坑记","slug":"frustrations-in-developing-wechat-mini-application","date":"2017-02-15T19:09:50.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2017/02/15/frustrations-in-developing-wechat-mini-application/","link":"","permalink":"http://www.clarencep.com/2017/02/15/frustrations-in-developing-wechat-mini-application/","excerpt":"前言微信小程序自去年公测以来，我司也申请了一个帐号开发，春节前后开始开发，现在终于告一个段落了。谨以此文记录下踩过的坑。","text":"前言微信小程序自去年公测以来，我司也申请了一个帐号开发，春节前后开始开发，现在终于告一个段落了。谨以此文记录下踩过的坑。 坑1：scroll-view与onPullDownRefresh冲突由于有几个页面需要将导航tab栏自动置顶，所以使用了scroll-view。然而又想要下拉刷新，本来想直接使用onPullDownRefresh，结果却发现下拉的时候onPullDownRefresh根本没有！囧！ 研究了半天，最终监听touchXXX自己模拟了个下拉刷新。（具体实现方案改日再分享。）为了尽量接近微信原生的下拉刷新，还特意抄了半天微信原生的下拉刷新动画... &lt;div class=&quot;loading&quot;&gt;&lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;&lt;/div&gt; .loading{ display: block; width: 100%; height: 20px; padding: 20px 0; text-align: center; background: #eee; } .loading::before, .loading .dot, .loading::after { content: &#39;&#39;; display: inline-block; color: transparent; width: 14px; height: 14px; border-radius: 14px; background: #fff; overflow: hidden; margin: 0 8px; } .loading::before, .loading .dot, .loading::after{ -webkit-animation: pulldown-refresh-loader 1.4s infinite ease-in-out; animation: pulldown-refresh-loader 1.4s infinite ease-in-out; -webkit-animation-fill-mode: both; animation-fill-mode: both; } .loading::before{ -webkit-animation-delay: -0.32s; animation-delay: -0.32s; } .loading .dot{ -webkit-animation-delay: -0.16s; animation-delay: -0.16s; } @-webkit-keyframes pulldown-refresh-loader { 0%, 80%, 100% { background-color: #f0f0f0; } 40% { background-color: #fff; } } @keyframes pulldown-refresh-loader { 0%, 80%, 100% { background-color: #f0f0f0; } 40% { background-color: #fff; } } .loading{display:block;width:100%;height:20px;padding:20px 0;text-align:center;background:#eee}.loading .dot,.loading::after,.loading::before{content:&quot;&quot;;display:inline-block;color:transparent;width:14px;height:14px;border-radius:14px;background:#fff;overflow:hidden;margin:0 8px;-webkit-animation:pulldown-refresh-loader 1.4s infinite ease-in-out;animation:pulldown-refresh-loader 1.4s infinite ease-in-out;-webkit-animation-fill-mode:both;animation-fill-mode:both}.loading::before{-webkit-animation-delay:-.32s;animation-delay:-.32s}.loading .dot{-webkit-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes pulldown-refresh-loader{0%,100%,80%{background-color:#f0f0f0}40%{background-color:#fff}}@keyframes pulldown-refresh-loader{0%,100%,80%{background-color:#f0f0f0}40%{background-color:#fff}} 坑2：无法获取元素的高度本来有个页面是要做成监听滚动，然后自动切换顶部tab的，类似 bootstrap的滚动监听 的效果。 然而里面有大段的文本，而文本的高度根本算不来，囧。还是放弃这个效果吧。 坑3：无法在bindXXX的事件处理的时候阻止冒泡有人说，你可以使用catchXXX呀！然而，我在某些时候才需要阻止事件冒泡，另外一些时候是不需要阻止冒泡的，是需要默认行为... 最终采用了一个很挫的方案来“解决” -- 复制那个&lt;view&gt;根据是否组织冒泡分别渲染成bindXXX或catchXXX...： &lt;view class=&quot;{{preventDefault && 'hide'}}&quot; catchXXX=&quot;yyy&quot; &gt;zzz&lt;/view&gt; &lt;view class=&quot;{{!preventDefault && 'hide'}}&quot; bindXXX=&quot;yyy&quot; &gt;zzz&lt;/view&gt; 这个还不能简单地使用wx:if，否则切换的成本太高了点。 坑4： 预览前构建时间比较长貌似没有好办法，预览的构建貌似不是增量的，希望微信官方啥时候能改成增量的就好了。点击预览按钮后去倒杯水喝吧。 坑5： 组件复用好蛋疼小程序里面虽然提供了&lt;template&gt;可以复用一部分模版，但是我们要是想复用一个具有完整功能组件（比如一个对话框 ）就会非常蛋疼 -- 数据怎么传呢？业务逻辑代码写在哪里？样式如何加载？ 目前解决方法是将组件封装成 xxx.js， xxx.wxml 和 xxx.wxss，用的时候都要引用下... 好麻烦！很怀念React里面的组件。 回头考虑通过在微信小程序前面加一道构建，以便自动引用组件相关东东。 坑6：不支持webview直接嵌入html代码像后台通过富文本编辑器录入的文章页面没法直接显示了... 还好有wxParse。尽管样式调起来很蛋疼，起码能看了。 坑7：测试与发布微信开发者工具的预览版本只能谁登录谁来扫，其他人扫根本开不了 --- 同是一个小程序的开发者也不行，囧。为了让测试人员方便测试，还得教会测试人员如何登录微信开发者工具，如何更新代码，如何构建并预览小程序。。。 啥，你说有“预览版本”，预览版本更麻烦，上传的时候只能管理员才能上传，上传完还必须选择为预览版本，预览版本还不是每个人能看的，而是加到预览者里面的才能看（开发者居然默认没有加到预览者里面！） -- 每一个操作都是要管理员扫码... 后记微信小程序坑还有很多，未完待续...","categories":[{"name":"微信小程序","slug":"微信小程序","permalink":"http://www.clarencep.com/categories/微信小程序/"}],"tags":[{"name":"微信","slug":"微信","permalink":"http://www.clarencep.com/tags/微信/"},{"name":"小程序","slug":"小程序","permalink":"http://www.clarencep.com/tags/小程序/"},{"name":"微信小程序","slug":"微信小程序","permalink":"http://www.clarencep.com/tags/微信小程序/"},{"name":"开发","slug":"开发","permalink":"http://www.clarencep.com/tags/开发/"},{"name":"坑","slug":"坑","permalink":"http://www.clarencep.com/tags/坑/"}]},{"title":"HTTP2试用小记","slug":"upgrade-nginx-to-support-http2","date":"2016-11-17T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2016/11/17/upgrade-nginx-to-support-http2/","link":"","permalink":"http://www.clarencep.com/2016/11/17/upgrade-nginx-to-support-http2/","excerpt":"这两天把公司的网站升级到了全站https. 顺便瞄到了HTTP2的浏览器支持情况： 支持得还都蛮好的嘛。忍不住试用了一把HTTP2 -- 就直接拿本博客来做示例了。","text":"这两天把公司的网站升级到了全站https. 顺便瞄到了HTTP2的浏览器支持情况： 支持得还都蛮好的嘛。忍不住试用了一把HTTP2 -- 就直接拿本博客来做示例了。 升级nginx主流浏览器基本上都支持了HTTP2，但是nginx只有升级到1.10以上版本才行 -- 鄙站之前用的还是nginx 1.6的某个版本。 更新了下apt-get，发现仓库中没有1.10版本 -- 囧 -- 只好自己编译吧： 首先，下载nginx和openssl： cd /usr/local/src wget https://nginx.org/download/nginx-1.11.6.tar.gz tar xzf nginx-1.11.6.tar.gz wget https://www.openssl.org/source/openssl-1.1.0c.tar.gz tar xzvf openssl-1.1.0c.tar.gz 然后，编译nginx： cd nginx-1.11.6 ./configure --prefix=/usr/local/nginx \\ --conf-path=/etc/nginx/nginx.conf \\ --with-openssl=../openssl-1.1.0c \\ --with-http_v2_module \\ --with-http_ssl_module \\ --with-http_gzip_static_module make &amp;&amp; sudo make install # 为了方便全局执行，则创建个符号链接： sudo ln -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx 接着，就是移植老的配置了，老的配置都可以直接使用，直接拷贝过来即可。最后，启用HTTP2 -- 目前HTTP2只能和ssl(https)一起使用，只要修改下listen语句即可： # 老的配置： # listen 443; # 新的配置（启用http2）: listen 443 ssl http2; 别忘了重启nginx (sudo nginx -s reload). 尝试通过HTTP2访问搞定nginx后，随手拿个chrome就可以使用HTTP2了 -- chrome 49及以上版本都支持HTTP2，还好chrome会自动升级，基本不用担心chrome太老。 打开F12查看下HTTP头部，果然Request Headers都不一样了： 这些:authority, :method 和 :path 等冒号打头的就是HTTP2的特征之一 -- 手边没有抓包工具，只能这样粗浅的判断了。 看看HTTP2的流水： 再比比HTTP1.1的流水： HTTP2的流水简洁多了，有没有！ 性能PKHTTP2的性能一般应该比HTTP1.1的高一些，但是，可不一定哟： 上图是本博客首页在相同nginx、相同PC、相同网络条件下对HTTP2和HTTP1.1分别测试的PK结果。 可见虽然HTTP2的网络加载时间（Load）比HTTP1.1要短，但是DOM渲染时间（DOMContentLoaded）却比HTTP1.1要长。。。 可能是由于本博没有专门为HTTP2优化所至。也可能是浏览器渲染没有为HTTP2优化的缘故。 最后总结一句：HTTP2入坑要谨慎。","categories":[{"name":"nginx","slug":"nginx","permalink":"http://www.clarencep.com/categories/nginx/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"http://www.clarencep.com/tags/nginx/"}]},{"title":"一个将多说的头像变成https的简单方法","slug":"a-simple-way-to-make-duoshuo-avatar-https","date":"2016-09-24T00:00:00.000Z","updated":"2017-10-25T03:09:10.844Z","comments":true,"path":"2016/09/24/a-simple-way-to-make-duoshuo-avatar-https/","link":"","permalink":"http://www.clarencep.com/2016/09/24/a-simple-way-to-make-duoshuo-avatar-https/","excerpt":"最近启用全站https之后，却发现地址栏里面却还没有小绿锁 -- 检查了下网络请求，发现原来是多说搞的鬼： 多说的头像有一些不是https的，如：http://wx.qlogo.cn/mmopen/5YxiaxTAIu0nOId2JW67SDEgJqPNjx33IeUNG5QJLuddhd45icL0R905icmdXbSib4H9FLib1IUsjA67ePswvZ9PxVA/0 其实呢，就上面这个这个头像而言，将http协议改成https协议后其实也是能够访问的。所以呢，就有了一个很简单的解决方案：","text":"最近启用全站https之后，却发现地址栏里面却还没有小绿锁 -- 检查了下网络请求，发现原来是多说搞的鬼： 多说的头像有一些不是https的，如：http://wx.qlogo.cn/mmopen/5YxiaxTAIu0nOId2JW67SDEgJqPNjx33IeUNG5QJLuddhd45icL0R905icmdXbSib4H9FLib1IUsjA67ePswvZ9PxVA/0 其实呢，就上面这个这个头像而言，将http协议改成https协议后其实也是能够访问的。所以呢，就有了一个很简单的解决方案： 首先，把多说的嵌入脚本下载保存到本地。 wget https://static.duoshuo.com/embed.js 其次，打开这个文件，格式化一下，找到avatarUrl这个函数，将其修改为这样： avatarUrl: function (e) { return ((e.avatar_url || rt.data.default_avatar_url) + &#39;&#39;).replace(/^http:/, location.protocol); } 最后，压缩下这个js，并替换原本的js： &lt;script type=&quot;text/javascript&quot;&gt; var duoshuoQuery = {short_name:&quot;&lt;%= config.duoshuo_shortname %&gt;&quot;}; setTimeout(function() { var ds = document.createElement(&#39;script&#39;); ds.type = &#39;text/javascript&#39;; ds.async = true; ds.src = &#39;/lib/duoshuo-embed.min.js&#39;; ds.charset = &#39;UTF-8&#39;; (document.getElementsByTagName(&#39;head&#39;)[0] || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds); }, 10); &lt;/script&gt; 构建并发布网站，OK了。 有个小bug：如果头像的服务器不支持https的话，就无法显示头像了。这其实也是有办法解决的，比如搞个反向代理，将http转换成https。不过有点麻烦，懒得弄了。","categories":[{"name":"多说","slug":"多说","permalink":"http://www.clarencep.com/categories/多说/"}],"tags":[{"name":"https","slug":"https","permalink":"http://www.clarencep.com/tags/https/"},{"name":"多说","slug":"多说","permalink":"http://www.clarencep.com/tags/多说/"},{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/tags/blog/"}]},{"title":"A Note To hash_pbkdf2 in PHP","slug":"a-note-to-php-hash_pbkdf2","date":"2016-09-06T00:00:00.000Z","updated":"2017-10-25T03:09:10.844Z","comments":true,"path":"2016/09/06/a-note-to-php-hash_pbkdf2/","link":"","permalink":"http://www.clarencep.com/2016/09/06/a-note-to-php-hash_pbkdf2/","excerpt":"Please pay great attention to the $length parameter! It is exactly the return string length, NOT the length of raw binary hash result. I had a big problem about this --I thought that hash_pbkdf2(...false) should equals to bin2hex(hash_pbkdf2(...true)) just like md5($x) equals bin2hex(md5($x, true)). However I was wrong:","text":"Please pay great attention to the $length parameter! It is exactly the return string length, NOT the length of raw binary hash result. I had a big problem about this --I thought that hash_pbkdf2(...false) should equals to bin2hex(hash_pbkdf2(...true)) just like md5($x) equals bin2hex(md5($x, true)). However I was wrong: hash_pbkdf2(&#39;sha256&#39;, &#39;123456&#39;, &#39;abc&#39;, 10000, 50, false); // returns string(50) &quot;584bc5b41005169f1fa15177edb78d75f9846afc466a4bae05&quot; hash_pbkdf2(&#39;sha256&#39;, &#39;123456&#39;, &#39;abc&#39;, 10000, 50, true); // returns string(50) &quot;XKŴ\u0010\u0005\u0016�\u001f�Qw�u��j�FjK�\u0005\u0011��BFW�\u001bYpG\u001f �mp.g2�`;\u0019N�&quot; bin2hex(hash_pbkdf2(&#39;sha256&#39;, &#39;123456&#39;, &#39;abc&#39;, 10000, 50, true)); // returns string(100) &quot;584bc5b41005169f1fa15177edb78d75f9846afc466a4bae05119c82424657c81b5970471f098a6d702e6732b7603b194efe&quot; So I add such a note. Hope it will help someone else like me.","categories":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/tags/PHP/"}]},{"title":"一个关于systemd私有目录的奇怪问题","slug":"a-strange-problem-about-systemd-private","date":"2016-08-12T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2016/08/12/a-strange-problem-about-systemd-private/","link":"","permalink":"http://www.clarencep.com/2016/08/12/a-strange-problem-about-systemd-private/","excerpt":"今天遇到一个奇怪的问题 -- PHP里面访问不了/tmp/xhprof-data目录，可是这个目录明明是存在的！","text":"今天遇到一个奇怪的问题 -- PHP里面访问不了/tmp/xhprof-data目录，可是这个目录明明是存在的！ 今天要使用xhprof进行性能分析，但是打开性能分析开关然后访问页面后却发现没有任何性能数据，很奇怪。 检查了下httpd的日志，发现有个fatal error： PHP Fatal error: Uncaught exception &#39;ErrorException&#39; with message &#39;fopen(/tmp/xhprof-data/57ad36118dcf0.default.xhprof): failed to open stream: No such file or directory&#39; 而对应的PHP代码是类似这样：$file = fopen($filePath, &#39;w&#39;); 一般来说这个错误应该是目录不存在或权限不足导致的。那么就检查下对应的目录： ➜ /tmp$ ll -d xhprof-data drwxrwxrwx. 2 apache apache 41 Aug 12 10:34 xhprof-data 目录是存在的呀，而且为了让PHP能访问，特意设置了全部可以读写，并且所属的用户和组都是apache。 然后在代码里面测试下这个目录是否可以访问： // 简单粗暴点，直接加一行打印看看 var_dump(is_dir(dirname($filePath)));die; 结果令人吃惊 -- 居然打印出来是false。 难道路径错了吗？把路径也重新打印出来核对下： // 简单粗暴点，直接加一行打印看看 var_dump(dirname($filePath));die; 路径打印出来就是/tmp/xhprof-data，没有错！ 奇葩问题呀！ 最后尝试删除掉这个目录，然后在PHP里面加一行自动创建目录： is_dir(dirname($filePath)) or mkdir(dirname($filePath), 0777, true); 结果，居然通了！到tmp目录下看看跟之前创建的有啥区别： ➜ /tmp$ ll xhprof-data ls: cannot access xhprof-data: No such file or directory 奇怪了，目录呢？ 使用find找下试试： ➜ /tmp$ find . -type d -name xhprof-data find: ‘./systemd-private-bd5ddddffb9240cdad836fe13ccb096d-httpd.service-kCEghE’: Permission denied ➜ /tmp$ sudo !! ➜ /tmp$ sudo find . -type d -name xhprof-data ./systemd-private-bd5ddddffb9240cdad836fe13ccb096d-httpd.service-kCEghE/tmp/xhprof-data 原来是放到了systemd-private-bd5ddddffb9240cdad836fe13ccb096d-httpd.service-kCEghE下面。 这个是个什么鬼？ 据google一下的结果，原来是systemd可以配置/tmp目录为私有目录，以防冲突而创建的。检查下配置： ➜ /tmp$ cat /usr/lib/systemd/system/httpd.service | grep PrivateTmp PrivateTmp=true 果然是有对应的这个配置。 涨姿势了。特此记录。","categories":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/tags/PHP/"},{"name":"httpd","slug":"httpd","permalink":"http://www.clarencep.com/tags/httpd/"},{"name":"systemd","slug":"systemd","permalink":"http://www.clarencep.com/tags/systemd/"}]},{"title":"如何在静态博客HEXO中只显示摘要信息","slug":"how-to-show-less-in-home-page-of-hexo","date":"2016-07-20T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2016/07/20/how-to-show-less-in-home-page-of-hexo/","link":"","permalink":"http://www.clarencep.com/2016/07/20/how-to-show-less-in-home-page-of-hexo/","excerpt":"默认情况下hexo博客(如本站)的首页显示的是完整的文章 -- 而文章比较长的时候这无疑会带来诸多不遍。 那怎么样才能只显示个摘要呢？","text":"默认情况下hexo博客(如本站)的首页显示的是完整的文章 -- 而文章比较长的时候这无疑会带来诸多不遍。 那怎么样才能只显示个摘要呢？ 方法说白了，其实很简单 -- 只要加入一个&lt;!-- more --&gt;这样的占位符在文章正文里面即可： 这就是一个简介 &lt;!-- more --&gt; 这里更多的内容 注意：这个占位符貌似只能另起一行，不能放在行内。","categories":[{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/categories/blog/"}],"tags":[{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/tags/blog/"},{"name":"hexo","slug":"hexo","permalink":"http://www.clarencep.com/tags/hexo/"}]},{"title":"如何解决Selenium中\"Cannot find function addEventListener in object [object HTMLDocument]\"的错误","slug":"how-to-resolve-cannot-find-function-addEventListener-error-in-selenium","date":"2016-04-28T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2016/04/28/how-to-resolve-cannot-find-function-addEventListener-error-in-selenium/","link":"","permalink":"http://www.clarencep.com/2016/04/28/how-to-resolve-cannot-find-function-addEventListener-error-in-selenium/","excerpt":"今天遇到一个很坑爹的问题，某Selenium自动化用例老是失败，报错如下：","text":"今天遇到一个很坑爹的问题，某Selenium自动化用例老是失败，报错如下： 1) App\\Tests\\*********** Facebook\\WebDriver\\Exception\\UnknownServerException: TypeError: Cannot find function addEventListener in object [object HTMLDocument]. (http://**********/*) Failed to take screen-shot: org.openqa.selenium.htmlunit.HtmlUnitDriver cannot be cast to org.openqa.selenium.TakesScreenshot Google了下这个错误，发现暂时没有适合我的解决方案： 有的方案建议换firefox来测试 -- 可是我们的这个自动化用例是要跑在一台linux服务器上，装firefox不现实 有点方案建议禁用js -- 可是现在这个页面越来越复杂，js禁用的话就侧不起来了，没意义 有点方案建议换PhantomJs -- 这个PhantomJs确实不会报这个错误，以前也用过，但是PhantomJs速度太慢，也是坑 怎么办呢？本来想到HtmlUnit的官方网站上反馈这个bug，结果一搜，已经有人反馈过这个bug了： https://sourceforge.net/p/htmlunit/bugs/1536/. 这个状态为closed，说明已经解决了！ 那为啥还报这个错误呢？怀疑是Selenium引用的HtmlUnit版本太低导致的。我使用的Selenium是selenium-server-standalone-2.52.0.jar， 目前最新版本的Selenium是2.53.0，然而不能升级到2.53.0，因为2.53.0中没有自带HtmlUnit. 咋办呢？幸好懂那么一丢丢Java —— 下载个HtmlUnit的最新版本，然后重新打包selenium-server-standalone-2.52.0.jar我是不会啦，不过可以指定下classloader的加载路径: java -Djava.ext.dirs=./lib -jar selenium-server-standalone-2.52.0.jar ./lib就是放HtmlUnit的一堆jar文件的目录。这样子classloader加载HtmlUnit的类的时候就会使用./lib里面的了，就不会使用selenium-server-standalone-2.52.0.jar中的老版本中的了。 以此配置重新启动下Selenium的服务，然后再运行对应的测试用例，果然一切OK了。 完事，收工~","categories":[{"name":"Selenium","slug":"Selenium","permalink":"http://www.clarencep.com/categories/Selenium/"}],"tags":[{"name":"Selenium","slug":"Selenium","permalink":"http://www.clarencep.com/tags/Selenium/"},{"name":"Java","slug":"Java","permalink":"http://www.clarencep.com/tags/Java/"},{"name":"JavaScript","slug":"JavaScript","permalink":"http://www.clarencep.com/tags/JavaScript/"},{"name":"HTMLUnit","slug":"HTMLUnit","permalink":"http://www.clarencep.com/tags/HTMLUnit/"}]},{"title":"PHP下使用强大的imagick轻松生成组合缩略图","slug":"use-imagick-to-composite-images-thumbnail","date":"2016-02-19T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2016/02/19/use-imagick-to-composite-images-thumbnail/","link":"","permalink":"http://www.clarencep.com/2016/02/19/use-imagick-to-composite-images-thumbnail/","excerpt":"最近有个需求是要把多张图片组合起来生成缩略图，刚好可以用强大的imagick扩展。","text":"最近有个需求是要把多张图片组合起来生成缩略图，刚好可以用强大的imagick扩展。 这里说的imagick 是 ImageMagick 在PHP下的扩展。使用pecl安装起来那叫一个轻松简单 —— 一条命令就搞定： sudo pecl install imagick （扩展装好后还是要在php.ini中加上extension=imagick.so，然后记得重启apache或PHP-fpm服务。） 这个需求是要这样生成缩略图： 如果有1张图片，就直接生成这张图片的缩略图； 如果有2张图片，则一张在左边一张在右边，各一半； 如果有3张图片，则两张左边平均分配，一张独占右边； 如果有4张图片，则像田字格一样平均分配空间； 更多张图片，则只取前4张，按田字格方式生成缩略图。 这规则还真不少，不过还不算太过复杂，很快搞出来了： namespace \\clarence\\thumbnail; class Thumbnail extends \\Imagick { /** * @param array $images * @param int $width * @param int $height * @return static * @throws ThumbnailException */ public static function createFromImages($images, $width, $height){ if (empty($images)){ throw new ThumbnailException(&quot;No images!&quot;); } $thumbnail = new static(); $thumbnail-&gt;newImage($width, $height, &#39;white&#39;, &#39;jpg&#39;); $thumbnail-&gt;compositeImages($images); return $thumbnail; } public function compositeImages($images){ $imagesKeys = array_keys($images); $compositeConfig = $this-&gt;calcCompositeImagesPosAndSize($images); foreach ($compositeConfig as $index =&gt; $cfg){ $imgKey = $imagesKeys[$index]; $img = new \\Imagick($images[$imgKey]); $img = $this-&gt;makeCompositeThumbnail($img, $cfg); $this-&gt;compositeImage($img, self::COMPOSITE_OVER, $cfg[&#39;to&#39;][&#39;x&#39;], $cfg[&#39;to&#39;][&#39;y&#39;]); } } protected function makeCompositeThumbnail(\\Imagick $img, $cfg){ $img-&gt;cropThumbnailImage($cfg[&#39;size&#39;][&#39;width&#39;], $cfg[&#39;size&#39;][&#39;height&#39;]); return $img; } protected function calcCompositeImagesPosAndSize($images){ $width = $this-&gt;getImageWidth(); $height = $this-&gt;getImageHeight(); switch(count($images)){ case 0: throw new ThumbnailException(&quot;No images!&quot;); case 1: // | 0 | return [ 0 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; 0, &#39;y&#39; =&gt; 0 ], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width, &#39;height&#39; =&gt; $height, ] ] ]; case 2: // | 0 | 1 | return [ 0 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; 0, &#39;y&#39; =&gt; 0 ], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height, ] ], 1 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; $width / 2, &#39;y&#39; =&gt; 0], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height, ] ] ]; case 3: // | 0 | 1 | // | 2 | | return [ 0 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; 0, &#39;y&#39; =&gt; 0 ], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height / 2, ] ], 1 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; $width / 2, &#39;y&#39; =&gt; 0], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height, ] ], 2 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; 0, &#39;y&#39; =&gt; $height / 2 ], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height / 2, ] ], ]; default: // &gt;= 4: // | 0 | 1 | // | 2 | 3 | return [ 0 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; 0, &#39;y&#39; =&gt; 0 ], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height / 2, ] ], 1 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; $width / 2, &#39;y&#39; =&gt; 0], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height / 2, ] ], 2 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; 0, &#39;y&#39; =&gt; $height / 2 ], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height / 2, ] ], 3 =&gt; [ &#39;to&#39; =&gt; [ &#39;x&#39; =&gt; $width / 2, &#39;y&#39; =&gt; $height / 2], &#39;size&#39; =&gt; [ &#39;width&#39; =&gt; $width / 2, &#39;height&#39; =&gt; $height / 2, ] ], ]; } } } 用个试试： $thumbnail = \\clarence\\thumbnail\\Thumbnail::createFromImages($srcImages, 240, 320); $thumbnail-&gt;writeImage($outputDir.&quot;/example.jpg&quot;); 效果立马出来了： 赞一个~ （详细代码见 http://github.com/clarence-pan/thumbnail)","categories":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/tags/PHP/"},{"name":"imagick","slug":"imagick","permalink":"http://www.clarencep.com/tags/imagick/"},{"name":"thumbnail","slug":"thumbnail","permalink":"http://www.clarencep.com/tags/thumbnail/"}]},{"title":"mac上spacemacs体验小记","slug":"note-of-spacemacs-on-mac","date":"2016-01-04T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2016/01/04/note-of-spacemacs-on-mac/","link":"","permalink":"http://www.clarencep.com/2016/01/04/note-of-spacemacs-on-mac/","excerpt":"安装第一步，安装emacs-macemacs-mac是对GNU的emacs为mac环境进行了一定的定制，可能体验会更好一点。那就卸载掉以前的emacs，装下吧：","text":"安装第一步，安装emacs-macemacs-mac是对GNU的emacs为mac环境进行了一定的定制，可能体验会更好一点。那就卸载掉以前的emacs，装下吧： $ brew remove emacs $ brew tap railwaycat/emacsmacport $ brew install emacs-mac --with-spacemacs-icon 其中最后一步会花费比较长的时间，我当时在make阶段足足花费了近10分钟... 第二步，克隆下spacemacs的配置如果以前曾经有.emacs.d的配置，要备份下，再克隆： $ mv ~/.emacs.d ~/.emacs.d.bak $ git clone --recursive https://github.com/syl20bnr/spacemacs ~/.emacs.d 第三步，启动emacs注意：最好启动GUI版的emacs，而不是到控制台上去敲emacs: 第一次启动emacs，相当于安装spacemacs，会有一些选项，我是一路按默认的来。很快就装好了（我一边敲上面的第x步，一边装，敲完了也就装完了）： 看这界面，我滴个神呐，这还是我熟悉的emacs吗？ 开始使用打开文件打开个文件试试，还是C-x C-f: 只是这个minibuffer有点小绚丽，居然是竖排的，支持方向键上下移动，左右前进后退；如果输入文件名也能即时筛选文件。 执行命令执行命令还是M-x: minibuffer都变成竖排的了 查看帮助SPC f e h 是内置的spacemacs的帮助文档 (貌似很多命令都用SPC打头) 更多内容见spacemacs下的其他文章...","categories":[{"name":"emacs","slug":"emacs","permalink":"http://www.clarencep.com/categories/emacs/"}],"tags":[{"name":"emacs","slug":"emacs","permalink":"http://www.clarencep.com/tags/emacs/"},{"name":"spacemacs","slug":"spacemacs","permalink":"http://www.clarencep.com/tags/spacemacs/"},{"name":"mac","slug":"mac","permalink":"http://www.clarencep.com/tags/mac/"}]},{"title":"PHP中的null合并运算符","slug":"null-coalesce-operator-in-php","date":"2015-12-30T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/12/30/null-coalesce-operator-in-php/","link":"","permalink":"http://www.clarencep.com/2015/12/30/null-coalesce-operator-in-php/","excerpt":"null合并运算符是一个好东西，有了它我们就能很方便的获取一个参数，并能在其为空的情况下提供一个默认值。比如在js中可以用||来搞：","text":"null合并运算符是一个好东西，有了它我们就能很方便的获取一个参数，并能在其为空的情况下提供一个默认值。比如在js中可以用||来搞： function setSomething(a){ a = a || &#39;some-default-value&#39;; // ... } 而在PHP中，可惜PHP的||总是返回true或false，无法这样来搞。PHP7才正式加入了??这个运算符： // 获取user参数的值(如果为空，则用&#39;nobody&#39;) $username = $_GET[&#39;user&#39;] ?? &#39;nobody&#39;; // 等价于: $username = isset($_GET[&#39;user&#39;]) ? $_GET[&#39;user&#39;] : &#39;nobody&#39;; PHP7 估计还有很长时间才能用到生产环境中，那在目前的PHP5中有没有替代方案呢？据研究，完全有个非常便捷的替代方案： // 获取user参数的值(如果为空，则用&#39;nobody&#39;) $username = @$_GET[&#39;user&#39;] ?: &#39;nobody&#39;; // 等价于: $username = isset($_GET[&#39;user&#39;]) ? $_GET[&#39;user&#39;] : &#39;nobody&#39;; -- 运行此代码: https://3v4l.org/aDUW8 瞪大了眼睛看，跟前面的PHP7的例子差不多，主要是把 ?? 替换为了 ?: 。 这个是个什么鬼呢？其实这就是 (expr1) ? (expr2) : (expr3) 表达式的省略模式： 表达式 (expr1) ? (expr2) : (expr3) 在 expr1 求值为 TRUE 时的值为 expr2，在 expr1 求值为 FALSE 时的值为 expr3。自 PHP 5.3 起，可以省略三元运算符中间那部分。表达式 expr1 ?: expr3 在 expr1 求值为 TRUE 时返回 expr1，否则返回 expr3。-- http://PHP.net/manual/zh/language.operators.comparison.PHP 当然，这个替代方案也不是完美的 —— 如果 $_GET 中没有 &#39;user&#39;，会有一条 Notice: Undefined index: user 的错误，所以需要用@来抑制这个错误，或者关闭 E_NOTICE 的错误。","categories":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/tags/PHP/"},{"name":"Null Coalesce","slug":"Null-Coalesce","permalink":"http://www.clarencep.com/tags/Null-Coalesce/"}]},{"title":"PlantUML的实例参考","slug":"plant-uml-instances","date":"2015-12-24T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2015/12/24/plant-uml-instances/","link":"","permalink":"http://www.clarencep.com/2015/12/24/plant-uml-instances/","excerpt":"Alice -&gt; Bob: Authentication Request Bob --&gt; Alice: Authentication Response Alice -&gt; Bob: Another authentication Request Alice &lt;-- Bob: another authentication Response","text":"Alice -&gt; Bob: Authentication Request Bob --&gt; Alice: Authentication Response Alice -&gt; Bob: Another authentication Request Alice &lt;-- Bob: another authentication Response actor Foo1 boundary Foo2 control Foo3 entity Foo4 database Foo5 Foo1 -&gt; Foo2 : To boundary Foo1 -&gt; Foo3 : To control Foo1 -&gt; Foo4 : To entity Foo1 -&gt; Foo5 : To database actor Bob #red &#39; The only difference between actor &#39;and participant is the drawing participant Alice participant &quot;I have a really\\nlong name&quot; as L #99FF99 /&#39; You can also declare: participant L as &quot;I have a really\\nlong name&quot; #99FF99 &#39;/ Alice-&gt;Bob: Authentication Request Bob-&gt;Alice: Authentication Response Bob-&gt;L: Log transaction Alice -&gt; &quot;Bob()&quot; : Hello &quot;Bob()&quot; -&gt; &quot;This is very\\nlong&quot; as Long &#39; You can also declare: &#39; &quot;Bob()&quot; -&gt; Long as &quot;This is very\\nlong&quot; Long --&gt; &quot;Bob()&quot; : ok Alice-&gt;Alice: This is a signal to self.\\nIt also demonstrates\\nmultiline \\ntext Bob -&gt;x Alice Bob -&gt; Alice Bob -&gt;&gt; Alice Bob -\\ Alice Bob \\\\- Alice Bob //-- Alice Bob -&gt;o Alice Bob o\\\\-- Alice Bob &lt;-&gt; Alice Bob &lt;-&gt;o Alice Bob -[#red]&gt; Alice : hello Alice -[#0000FF]-&gt;Bob : ok autonumber Bob -&gt; Alice : Authentication Request Bob &lt;- Alice : Authentication Response autonumber 15 Bob -&gt; Alice : Another authentication Request Bob &lt;- Alice : Another authentication Response autonumber 40 10 Bob -&gt; Alice : Yet another authentication Request Bob &lt;- Alice : Yet another authentication Response autonumber &quot;&lt;b&gt;[000]&quot; Bob -&gt; Alice : Authentication Request Bob &lt;- Alice : Authentication Response autonumber 15 &quot;&lt;b&gt;(&lt;u&gt;##&lt;/u&gt;)&quot; Bob -&gt; Alice : Another authentication Request Bob &lt;- Alice : Another authentication Response autonumber 40 10 &quot;&lt;font color=red&gt;&lt;b&gt;Message 0 &quot; Bob -&gt; Alice : Yet another authentication Request Bob &lt;- Alice : Yet another authentication Response title Simple communication example Alice -&gt; Bob: Authentication Request Bob --&gt; Alice: Authentication Response Alice -&gt; Bob : Hello legend right Short legend endlegend Alice -&gt; Bob : message 1 Alice -&gt; Bob : message 2 newpage Alice -&gt; Bob : message 3 Alice -&gt; Bob : message 4 newpage A title for the\\nlast page Alice -&gt; Bob : message 5 Alice -&gt; Bob : message 6 Alice -&gt; Bob: Authentication Request alt successful case Bob -&gt; Alice: Authentication Accepted else some kind of failure Bob -&gt; Alice: Authentication Failure group My own label Alice -&gt; Log : Log attack start loop 1000 times Alice -&gt; Bob: DNS Attack end Alice -&gt; Log : Log attack end end else Another type of failure Bob -&gt; Alice: Please repeat end Alice-&gt;Bob : hello note left: this is a first note Bob-&gt;Alice : ok note right: this is another note Bob-&gt;Bob : I am thinking note left a note can also be defined on several lines end note participant Alice participant Bob note left of Alice #aqua This is displayed left of Alice. end note note right of Alice: This is displayed right of Alice. note over Alice: This is displayed over Alice. note over Alice, Bob #FFAAAA: This is displayed\\n over Bob and Alice. note over Bob, Alice This is yet another example of a long note. end note caller -&gt; server : conReq hnote over caller : idle caller &lt;- server : conConf rnote over server &quot;r&quot; as rectangle &quot;h&quot; as hexagon endrnote participant Alice participant &quot;The **Famous** Bob&quot; as Bob Alice -&gt; Bob : hello --there-- ... Some ~~long delay~~ ... Bob -&gt; Alice : ok note left This is **bold** This is //italics// This is &quot;&quot;monospaced&quot;&quot; This is --stroked-- This is __underlined__ This is ~~waved~~ end note Alice -&gt; Bob : A //well formatted// message note right of Alice This is &lt;back:cadetblue&gt;&lt;size:18&gt;displayed&lt;/size&gt;&lt;/back&gt; __left of__ Alice. end note note left of Bob &lt;u:red&gt;This&lt;/u&gt; is &lt;color #118888&gt;displayed&lt;/color&gt; **&lt;color purple&gt;left of&lt;/color&gt; &lt;s:red&gt;Alice&lt;/strike&gt; Bob**. end note note over Alice, Bob &lt;w:#FF33FF&gt;This is hosted&lt;/w&gt; by &lt;img sourceforge.jpg&gt; end note == Initialization == Alice -&gt; Bob: Authentication Request Bob --&gt; Alice: Authentication Response == Repetition == Alice -&gt; Bob: Another authentication Request Alice &lt;-- Bob: another authentication Response participant Alice actor Bob ref over Alice, Bob : init Alice -&gt; Bob : hello ref over Bob This can be on several lines end ref Alice -&gt; Bob: Authentication Request ... Bob --&gt; Alice: Authentication Response ...5 minutes latter... Bob --&gt; Alice: Bye ! Alice -&gt; Bob: message 1 Bob --&gt; Alice: ok ||| Alice -&gt; Bob: message 2 Bob --&gt; Alice: ok ||45|| Alice -&gt; Bob: message 3 Bob --&gt; Alice: ok participant User User -&gt; A: DoWork activate A A -&gt; B: &lt;&lt; createRequest &gt;&gt; activate B B -&gt; C: DoWork activate C C --&gt; B: WorkDone destroy C B --&gt; A: RequestCreated deactivate B A -&gt; User: Done deactivate A participant User User -&gt; A: DoWork activate A #FFBBBB A -&gt; A: Internal call activate A #DarkSalmon A -&gt; B: &lt;&lt; createRequest &gt;&gt; activate B B --&gt; A: RequestCreated deactivate B deactivate A A -&gt; User: Done deactivate A Bob -&gt; Alice : hello create Other Alice -&gt; Other : new create control String Alice -&gt; String note right : You can also put notes! Alice --&gt; Bob : ok [-&gt; A: DoWork activate A A -&gt; A: Internal call activate A A -&gt;] : &lt;&lt; createRequest &gt;&gt; A&lt;--] : RequestCreated deactivate A [&lt;- A: Done deactivate A [-&gt; Bob [o-&gt; Bob [o-&gt;o Bob [x-&gt; Bob [&lt;- Bob [x&lt;- Bob Bob -&gt;] Bob -&gt;o] Bob o-&gt;o] Bob -&gt;x] Bob &lt;-] Bob x&lt;-] @startuml /&#39; This is an example Sequence diagram Showing a fictional web feature flow It is easy to see roles &amp; responsibilities for each component and easy to change them too... &#39;/ title &quot;Story Feature Example - Sequence Diagram&quot; &#39;This is a single line comment /&#39; This is a multi-line comment One another line &#39;/ actor User &#39;boundary Proxy participant UIServer as UI participant API User -&gt; UI: LINK: goto /account page activate UI UI -&gt; User: deactivate UI activate User note over User Requirments: UI: Setting Page Click delete button end note &#39; user requests account/delete page User -&gt; UI: /account/delete deactivate User activate UI UI -&gt; User: deactivate UI &#39; confirmation form activate User note over User UI: Form Are you sure? end note User -&gt; UI: POST /account/delete deactivate User activate UI note over UI: Verify: user has confirmed UI -&gt; API: /account/delete activate API API -&gt; API: delete API -&gt; UI: done deactivate API UI -&gt; User: success deactivate UI @enduml","categories":[{"name":"UML","slug":"UML","permalink":"http://www.clarencep.com/categories/UML/"}],"tags":[{"name":"PlantUML","slug":"PlantUML","permalink":"http://www.clarencep.com/tags/PlantUML/"},{"name":"UML","slug":"UML","permalink":"http://www.clarencep.com/tags/UML/"}]},{"title":"使用PHPUnit + Selenium进行自动化测试","slug":"how-to-use-phpunit-selenium-test","date":"2015-12-22T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/12/22/how-to-use-phpunit-selenium-test/","link":"","permalink":"http://www.clarencep.com/2015/12/22/how-to-use-phpunit-selenium-test/","excerpt":"第一步，安装PHPUnit最简单的方式莫过于到PHPUnit的官网下载PHPUnit，然后把那个下载了的phpunit.phar加到PATH中。","text":"第一步，安装PHPUnit最简单的方式莫过于到PHPUnit的官网下载PHPUnit，然后把那个下载了的phpunit.phar加到PATH中。 此外，还可以通过 pear 来安装phpunit: pear clear-cache pear channel-discover pear.phpunit.de pear channel-discover components.ez.no pear channel-discover pear.symfony-project.com pear install -a -f phpunit/PHPUnit 参考：http://www.cnblogs.com/wanfox/p/4613517.html然而使用 pear 安装方式，我却是没有成功！大概是因为天朝的神奇的GFW吧！ 补记：还能通过composer来安装: composer require phpunit/phpunit 第二步，下载Selenium Standalone Server传送门：http://docs.seleniumhq.org/download/传送门2： https://selenium-release.storage.googleapis.com/index.html?path=2.48/下载下来一般是一个selenium-server-standalone-2.48.2.jar这样的文件（版本号可能会有所更新）。 第三步，下载WebDriver for Chrome传送门： https://sites.google.com/a/chromium.org/chromedriver/downloads这个要根据电脑是Windows、Linux还是MAC，来下载相应的驱动，并解压缩。 补记：如下载不了，还可以到百度云下载 http://pan.baidu.com/s/1mirOYIc 第四步，启动Server前面两步的东西都下载好了，就可以启动这个server了： # 假设1：已经装了java, 而且将java加到了PATH中 # 假设2：前面两步下载的东东都在当前目录下 java -jar selenium-server-standalone-2.42.2.jar -Dwebdriver.chrome.driver=./chromedriver p.s. 对于Windows的用户，后面的./chromedriver需要修改为.\\chromedriver.exe 补记：对于从百度云上下载的用户，直接双击start-server.bat即可运行 第四步，下载PHP的WebDriver封装库本人喜欢使用Facebook出品的这个库. 这个库可以直接用composer加载： composer require facebook/webdriver 鉴于composer在国内的悲惨现状，还是直接下载zip包，然后自行加载吧。下面是我常用的自动加载器： // file: tests/bootstrap.PHP call_user_func(function(){ $namespaces = array( &#39;Facebook\\WebDriver&#39; =&gt; __DIR__.&#39;/../PHP-webdriver/lib&#39;, ); spl_autoload_register(function($class) use ($namespaces){ $class = ltrim($class, &#39;\\\\&#39;); foreach ($namespaces as $ns =&gt; $dir) { if (strncmp($class, $ns, strlen($ns)) === 0){ $file = str_replace(&#39;\\\\&#39;, DIRECTORY_SEPARATOR, $dir . DIRECTORY_SEPARATOR . ltrim(substr($class, strlen($ns)), &#39;\\\\&#39;)) . &#39;.PHP&#39;; if (is_file($file)){ include_once($file); } } } }); }); 这个自动加载器可以放到bootstrap.PHP中，以便phpunit跑用例前加载。 第五步，编写一个简单的测试用例下面这个测试用例测试下百度是否能正常打开，检查百度的标题和URL是否符合预期。 // file: tests/sample/BaiduTest.PHP class BaiduTest extends PHPUnit_Framework_TestCase { public function testTheTitleUrl() { // 创建一个浏览器 $browser = create_browser(); // 打开百度 $browser-&gt;get(&#39;https://www.baidu.com/&#39;); // 检查下标题 $this-&gt;assertEquals(&#39;百度一下，你就知道&#39;, $browser-&gt;getTitle()); // 检查下URL $this-&gt;assertEquals(&#39;https://www.baidu.com/&#39;, $browser-&gt;getCurrentURL()); // 搜索&quot;Hello&quot; $keywordInput = $browser-&gt;findElement(By::id(&#39;kw&#39;)); $this-&gt;assertNotEmpty($keywordInput); $keywordInput-&gt;sendKeys(&#39;Hello&#39;); $searchBtn = $browser-&gt;findElement(By::id(&#39;su&#39;)); $this-&gt;assertNotEmpty($searchBtn); $searchBtn-&gt;click(); // 等待结果 $browser-&gt;wait()-&gt;until(Expect::titleContains(&#39;Hello&#39;)); // 检查结果 $keywordInput = $browser-&gt;findElement(By::id(&#39;kw&#39;)); $this-&gt;assertNotEmpty($keywordInput); $this-&gt;assertEquals(&#39;Hello&#39;, $keywordInput-&gt;getAttribute(&#39;value&#39;)); // 为了演示，留个时间看看结果 sleep(3); // 关闭浏览器 $browser-&gt;quit(); } } 注意：文件名和类名要以Test结尾，而其中的测试函数要以test开头，这样子方便phpunit查找测试用例。 此外，其中create_browser是放在bootstrap.PHP中的一个辅助函数： use Facebook\\WebDriver\\Remote\\DesiredCapabilities; use Facebook\\WebDriver\\Remote\\RemoteWebDriver; /** * @return RemoteWebDriver */ function create_browser(){ return RemoteWebDriver::create(&#39;http://localhost:4444/wd/hub&#39;, DesiredCapabilities::chrome(), 5000); } 第六步，跑一下测试用例试试phpunit --bootstrap tests/bootstrap.PHP tests/sample/BaiduTest.PHP screen_w600 Nice~ 成功跑通~ 最后，用phpunit.xml定义测试套，跑起来更便捷~老是敲那么一长串的命令也挺麻烦的，要是能像make一样只要敲一个make就搞定就好了 —— phpunit刚好提供了一个phpunit.xml让我们能定义常用的测试套之类的选项。 详细的介绍在官方文档中已经很详细了，我这里就不啰嗦了。只秀个我认为较为简洁有效的配置： &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;phpunit backupGlobals = &quot;false&quot; backupStaticAttributes = &quot;false&quot; colors = &quot;true&quot; convertErrorsToExceptions = &quot;true&quot; convertNoticesToExceptions = &quot;true&quot; convertWarningsToExceptions = &quot;true&quot; processIsolation = &quot;false&quot; stopOnFailure = &quot;false&quot; syntaxCheck = &quot;false&quot; bootstrap = &quot;tests/bootstrap.PHP&quot; &gt; &lt;testsuites&gt; &lt;testsuite&gt; &lt;directory&gt;tests/sample&lt;/directory&gt; &lt;/testsuite&gt; &lt;!-- ... --&gt; &lt;/testsuites&gt; &lt;/phpunit&gt; 把上述内容写入phpunit.xml中后，跑phpunit就变得非常简单了，一个phpunit就搞定了： screen_w600 Well done. 收工~ 另附完整的示例代码： http://pan.baidu.com/s/1mirOYIc","categories":[{"name":"Selenium","slug":"Selenium","permalink":"http://www.clarencep.com/categories/Selenium/"}],"tags":[{"name":"Selenium","slug":"Selenium","permalink":"http://www.clarencep.com/tags/Selenium/"},{"name":"PHPUnit","slug":"PHPUnit","permalink":"http://www.clarencep.com/tags/PHPUnit/"},{"name":"Test","slug":"Test","permalink":"http://www.clarencep.com/tags/Test/"}]},{"title":"【转】使用Sublime + PlantUML高效地画图","slug":"how-to-use-sublime-and-plant-uml-draw-diagram","date":"2015-12-17T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/12/17/how-to-use-sublime-and-plant-uml-draw-diagram/","link":"","permalink":"http://www.clarencep.com/2015/12/17/how-to-use-sublime-and-plant-uml-draw-diagram/","excerpt":"转自: http://www.jianshu.com/p/e92a52770832 （侵立删） 程序员难免要经常画流程图，状态图，时序图等。以前经常用 visio 画，经常为矩形画多大，摆放在哪等问题费脑筋。有时候修改文字后，为了较好的显示效果不得不再去修改图形。今天介绍的工具是如何使用 Sublime + PlantUML 的插件画流程图，状态图，时序图等。这是一种程序员看了就会爱上的画图方式：自然，高效。","text":"转自: http://www.jianshu.com/p/e92a52770832 （侵立删） 程序员难免要经常画流程图，状态图，时序图等。以前经常用 visio 画，经常为矩形画多大，摆放在哪等问题费脑筋。有时候修改文字后，为了较好的显示效果不得不再去修改图形。今天介绍的工具是如何使用 Sublime + PlantUML 的插件画流程图，状态图，时序图等。这是一种程序员看了就会爱上的画图方式：自然，高效。 什么是 PlantUMLPlantUML 是一个画图脚本语言，用它可以快速地画出： 时序图 流程图 用例图 状态图 组件图 简单地讲，我们使用 visio 画图时需要一个一个图去画，但使用 PlantUML 只需要用文字表达出图的内容，然后就可以直接生成图片。看一个最简单的例子： Bob -&gt; Alice : Hello, how are you Alice -&gt; Bob : Fine, thank you, and you? 软件安装这些软件全部是开源或共享软件，不存在版权问题，可以放心使用。 安装 SublimeSublime 是个强大的可扩展的文本编辑器。进入官网下载对应操作系统下的版本安装即可。 安装 graphvizgraphviz 是个开源的图片渲染库。安装了这个库才能在 Windows 下实现把 PlantUML 脚本转换为图片。 安装 PlantUML for Sublime 插件有了这个插件后，我们就可以在 Sublime 里写 PlantUML 脚本，然后直接通过一个快捷键生成图片。安装步骤如下 下载插件，并解压 通过 Preferences -&gt; Browse Packages ... 打开 sublime 的 Packages 目录，解压后的插件放在 Packages 目录下 重启 Sublime 为了简化使用，可以在 Sublime 里配置个快捷键。打开 Preferences -&gt; Key Binding - User，添加一个快捷键： { &quot;keys&quot;: [&quot;alt+d&quot;], &quot;command&quot;: &quot;display_diagrams&quot;} 上面的代码配置成按住 Alt + d 来生成 PlantUML 图片，你可以修改成你自己喜欢的按键。 效果检验最后检验一下工作安装是否正确。打开 Sublime 输入： Bob -&gt; Alice : Hello, how are you Alice -&gt; Bob : Fine, thank you, and you? 选中这些文本内容，按 Alt + d 会在当前工作目录下生成这个图片文件，同时自动弹出窗口显示图片。 PlantULM 快速入门时序图@startuml title 时序图 == 鉴权阶段 == Alice -&gt; Bob: 请求 Bob -&gt; Alice: 应答 == 数据上传 == Alice -&gt; Bob: 上传数据 note left: 这是显示在左边的备注 Bob --&gt; Canny: 转交数据 ... 不超过 5 秒钟 ... Canny --&gt; Bob: 状态返回 note right: 这是显示在右边的备注 Bob -&gt; Alice: 状态返回 == 状态显示 == Alice -&gt; Alice: 给自己发消息 @enduml TIPS： 使用 title 来指定标题 &#39;-&gt;&#39; 和 &#39;--&gt;&#39; 来指示线条的形式 在每个时序后面加冒号 : 来添加注释 使用 note 来显示备注，备注可以指定显示在左边或右边 使用 == xxx == 来分隔时序图 使用 ... 来表示延迟省略号 节点可以给自己发送消息，方法是发送方和接收方使用同一个主体即可 用例图@startuml left to right direction actor 消费者 actor 销售员 rectangle 买单 { 消费者 -- (买单) (买单) .&gt; (付款) : include (帮助) .&gt; (买单) : extends (买单) -- 销售员 } @enduml TIPS： 用例图 用例图是指由参与者（Actor）、用例（Use Case）以及它们之间的关系构成的用于描述系统功能的静态视图 百度百科上有简易的入门资料，其中用例之间的关系 (include, extends) 是关键 使用 actor 来定义参与者 使用括号 (xxx) 来表示用例，用例用椭圆形表达 使用不同的线条表达不同的关系。包括参与者与用例的关系，用例与用例的关系 流程图@startuml title 流程图 (*) --&gt; &quot;步骤1处理&quot; --&gt; &quot;步骤2处理&quot; if &quot;条件1判断&quot; then -&gt;[true] &quot;条件1成立时执行的动作&quot; if &quot;分支条件2判断&quot; then -&gt;[no] &quot;条件2不成立时执行的动作&quot; -&gt; === 中间流程汇总点1 === else --&gt;[yes] === 中间流程汇总点1 === endif if &quot;分支条件3判断&quot; then --&gt;[yes] &quot;分支条件3成立时执行的动作&quot; --&gt; &quot;Page.onRender ()&quot; as render --&gt; === REDIRECT_CHECK === else --&gt;[no] &quot;分支条件3不成立时的动作&quot; --&gt; render endif else --&gt;[false] === REDIRECT_CHECK === endif if &quot;条件4判断&quot; then -&gt;[yes] &quot;条件4成立时执行的动作&quot; --&gt; &quot;流程最后结点&quot; else endif --&gt; &quot;流程最后结点&quot; --&gt;(*) @enduml 上面的流程图写的时候还是挺直观的，但画出来的图片渲染效果不好，对逻辑的显示不清楚。由于这个原因 PlantUML 实现了另外版本的流程图脚本。 下面是 PlantUML 支持的新版本的流程图脚本，从使用角度来讲，更直观，画出来的图片也更漂亮，推荐使用。 @startuml start :&quot;步骤1处理&quot;; :&quot;步骤2处理&quot;; if (&quot;条件1判断&quot;) then (true) :条件1成立时执行的动作; if (&quot;分支条件2判断&quot;) then (no) :&quot;条件2不成立时执行的动作&quot;; else if (&quot;条件3判断&quot;) then (yes) :&quot;条件3成立时的动作&quot;; else (no) :&quot;条件3不成立时的动作&quot;; endif endif :&quot;顺序步骤3处理&quot;; endif if (&quot;条件4判断&quot;) then (yes) :&quot;条件4成立的动作&quot;; else if (&quot;条件5判断&quot;) then (yes) :&quot;条件5成立时的动作&quot;; else (no) :&quot;条件5不成立时的动作&quot;; endif endif stop @enduml TIPS： 使用 start 来表示流程开始，使用 stop 来表示流程结束 顺序流程使用冒号和分号 :xxx; 来表示 条件语句使用 if (&quot;condition 1&quot;) then (true/yes/false/no) 来表示 条件语句可以嵌套 组件图我们经常使用组件图来画部署视图，或者用来画系统的拓扑结构图。 @startuml package &quot;组件1&quot; { [&quot;组件1.1&quot;] - [&quot;组件1.2&quot;] [&quot;组件1.2&quot;] -&gt; [&quot;组件2.1&quot;] } node &quot;组件2&quot; { [&quot;组件2.1&quot;] - [&quot;组件2.2&quot;] [&quot;组件2.2&quot;] --&gt; [负载均衡服务器] } cloud { [负载均衡服务器] -&gt; [逻辑服务器1] [负载均衡服务器] -&gt; [逻辑服务器2] [负载均衡服务器] -&gt; [逻辑服务器3] } database &quot;MySql&quot; { folder &quot;This is my folder&quot; { [Folder 3] } frame &quot;Foo&quot; { [Frame 4] } } [逻辑服务器1] --&gt; [Folder 3] [逻辑服务器2] --&gt; [Frame 4] [逻辑服务器3] --&gt; [Frame 4] @enduml TIPS: 使用方括号 [xxx] 来表示组件 可以把几个组件合并成一个包，可以使用的关键字为 package, node, folder, frame, cloud, database。不同的关键字图形不一样。 可以在包内部用不同的箭头表达同一个包的组件之间的关系 可以在包内部直接表达到另外一个包内部的组件的交互关系 可以在流程图外部直接表达包之间或包的组件之间的交互关系 状态图我们一般使用状态图来画状态机。 @startuml scale 640 width [*] --&gt; NotShooting state NotShooting { [*] --&gt; Idle Idle --&gt; Processing: SignalEvent Processing --&gt; Idle: Finish Idle --&gt; Configuring : EvConfig Configuring --&gt; Idle : EvConfig } state Configuring { [*] --&gt; NewValueSelection NewValueSelection --&gt; NewValuePreview : EvNewValue NewValuePreview --&gt; NewValueSelection : EvNewValueRejected NewValuePreview --&gt; NewValueSelection : EvNewValueSaved state NewValuePreview { State1 -&gt; State2 } } @enduml TIPS: 使用 [*] 来表示状态的起点 使用 state 来定义子状态图 状态图可以嵌套 使用 scale 命令来指定生成的图片的尺寸 总结不需要去记这些标记，在需要的时候去使用它，通过不断地使用来熟悉不同的图的语法。可以下载 PlanUML 官方文档 作为参考，遇到问题的时候翻一翻，这样很快就可以学会使用 PlantUML 高效地画图。","categories":[{"name":"UML","slug":"UML","permalink":"http://www.clarencep.com/categories/UML/"}],"tags":[{"name":"sublime","slug":"sublime","permalink":"http://www.clarencep.com/tags/sublime/"},{"name":"PlantUML","slug":"PlantUML","permalink":"http://www.clarencep.com/tags/PlantUML/"},{"name":"UML","slug":"UML","permalink":"http://www.clarencep.com/tags/UML/"},{"name":"diagram","slug":"diagram","permalink":"http://www.clarencep.com/tags/diagram/"}]},{"title":"在MAC OS X上如何启用crontab？","slug":"how-to-enable-crontab-on-osx","date":"2015-12-16T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/12/16/how-to-enable-crontab-on-osx/","link":"","permalink":"http://www.clarencep.com/2015/12/16/how-to-enable-crontab-on-osx/","excerpt":"背景本本上又一些东东是比较重要的，我使用了git进行管理，从而可以将其备份到某个git仓库上。可是鄙人喜欢偷懒，不喜欢老是手动执行备份的一系列命令，于是乎我就想到了写个备份脚本，想通过 crontab 来定期备份。","text":"背景本本上又一些东东是比较重要的，我使用了git进行管理，从而可以将其备份到某个git仓库上。可是鄙人喜欢偷懒，不喜欢老是手动执行备份的一系列命令，于是乎我就想到了写个备份脚本，想通过 crontab 来定期备份。 脚本写好了，也加了一条crontab： # m h dom mon dow command 30 11,17 * * * /Users/clarence/bin/daily-backup 可是，为啥到点没有执行呢？问了下度娘和谷哥，结果很多文章都是关于如何用OS X现在自带的 launchctl 来执行定时任务的。可是呢，鄙人这个脚本是像每天上午和下午都要执行的，用 launchctl 来搞的话有点嫌麻烦。故今天非要探究下如何启用crontab。结果不一会儿就找到了原因，现分享如下： 如何启用crontab首先，既然OS X的定时任务统统都由 launchctl 来管理了，就看看 cron 任务有没有在里面： $ LaunchAgents sudo launchctl list | grep cron 83968 0 com.vix.cron 果然在里面。那就检查下这个启动项的配置： $ LaunchAgents locate com.vix.cron /System/Library/LaunchDaemons/com.vix.cron.plist $ LaunchAgents cat /System/Library/LaunchDaemons/com.vix.cron.plist &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt; &lt;plist version=&quot;1.0&quot;&gt; &lt;dict&gt; &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;com.vix.cron&lt;/string&gt; &lt;key&gt;ProgramArguments&lt;/key&gt; &lt;array&gt; &lt;string&gt;/usr/sbin/cron&lt;/string&gt; &lt;/array&gt; &lt;key&gt;KeepAlive&lt;/key&gt; &lt;dict&gt; &lt;key&gt;PathState&lt;/key&gt; &lt;dict&gt; &lt;key&gt;/etc/crontab&lt;/key&gt; &lt;true/&gt; &lt;/dict&gt; &lt;/dict&gt; &lt;key&gt;QueueDirectories&lt;/key&gt; &lt;array&gt; &lt;string&gt;/usr/lib/cron/tabs&lt;/string&gt; &lt;/array&gt; &lt;key&gt;EnableTransactions&lt;/key&gt; &lt;true/&gt; &lt;/dict&gt; &lt;/plist&gt; 注意里面有个KeepAlive的条件是 /etc/crontab 是否存在： &lt;key&gt;KeepAlive&lt;/key&gt; &lt;dict&gt; &lt;key&gt;PathState&lt;/key&gt; &lt;dict&gt; &lt;key&gt;/etc/crontab&lt;/key&gt; &lt;true/&gt; &lt;/dict&gt; &lt;/dict&gt; 所以呢，那就看看是否是因为这个 /etc/crontab 不存在导致 cron 里面的任务无法正常运行： $ LaunchAgents ll /etc/crontab ls: /etc/crontab: No such file or directory 果然，这个文件不存在。那就创建吧！ $ sudo touch /etc/crontab 再试试 cron 任务是否成功启动... 果然能成功启动了！ 收工~","categories":[{"name":"OS X","slug":"OS-X","permalink":"http://www.clarencep.com/categories/OS-X/"},{"name":"crontab","slug":"OS-X/crontab","permalink":"http://www.clarencep.com/categories/OS-X/crontab/"}],"tags":[{"name":"OS X","slug":"OS-X","permalink":"http://www.clarencep.com/tags/OS-X/"},{"name":"MAC","slug":"MAC","permalink":"http://www.clarencep.com/tags/MAC/"},{"name":"crontab","slug":"crontab","permalink":"http://www.clarencep.com/tags/crontab/"},{"name":"定时任务","slug":"定时任务","permalink":"http://www.clarencep.com/tags/定时任务/"}]},{"title":"安装PHP扩展","slug":"installing-php-extensions","date":"2015-12-12T16:08:49.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/12/12/installing-php-extensions/","link":"","permalink":"http://www.clarencep.com/2015/12/12/installing-php-extensions/","excerpt":"前言PHP 的扩展相当丰富，可是有些扩展安装起来并不是那么地顺利，谨以此文汇总下我曾经遇到过的问题。","text":"前言PHP 的扩展相当丰富，可是有些扩展安装起来并不是那么地顺利，谨以此文汇总下我曾经遇到过的问题。 由于PHP版本也是在不断地更新，某些问题的解决方案以后可能会失效，所以此文仅作参考。 若有发现某个解决方案失效了，还请见谅，并欢迎指出以便更正。 pecl/pear的安装使用pecl/pear可以很方便地安装一些PHP扩展。下载go-pear: http://pear.PHP.net/go-pear.phar然后执行这个phar文件： sudo PHP go-pear.phar 至于提示的目录设置，一般而言默认的就够用了。如需定制请自便。 安装好了后，建议将pear和pecl的目录加入到PATH中，或者可以加个软连接到path的某个目录中，以便以后使用，如： ln -s /usr/local/Cellar/php56/5.6.16/bin/pecl /usr/local/bin/ ln -s /usr/local/Cellar/php56/5.6.16/bin/pear /usr/local/bin/ 安装intl扩展使用包管理进行安装在debian/ubuntu/centos上都有对应的包：php5-intl, 直接使用apt或yum来安装即可: sudo apt-get install -y php5-intl 可惜在 mac OS X 上并不能这样安装，只能通过pecl或源码安装 使用pecl进行安装sudo pecl update-channels sudo pecl install intl 如遇到询问icu的路径，则请寻找其路径并提供给安装程序，如：/usr/local/Cellar/icu4c/56.1 从源码安装下载地址： http://pecl.PHP.net/package/intl下载最新版本，然后解压缩后： phpize ./configure make sudo make install 成功的安装将创建 intl.so 并放置于 PHP 的扩展库目录中。需要调整 PHP.ini，加入 extension=intl.so 这一行之后才能使用此扩展库。 问题：icu-config找不到？现象： checking for icu-config... no checking for location of ICU headers and libraries... not found configure: error: Unable to detect ICU prefix or no failed. Please verify ICU install prefix and make sure icu-config works. 解决方案：对于debian/ubuntu/centos则可以安装下icu libicu libicu-devel： sudo apt-get install -y icu libicu libicu-devel 对于mac OS X则需要安装icu4c: brew install icu4c 然后再编译intl的时候提供这个icu的路径，如： cd path/to/intl-v3.0.0 ./configure --with-icu-dir=/usr/local/Cellar/icu4c/56.1 注意：替换下版本号。 安装mcrypt扩展mcrypt是一个功能很强大的加密算法扩展库，一般直接有这个的包 使用包管理功能安装# for ubuntu/debian sudo apt-get install php5-mcrypt # for centos sudo yum install libmcrypt libmcrypt-devel sudo yum install PHP-mcrypt # for OS X brew install php56-mcrypt 从源码安装// TODO: 待续 -- 目前在安装其依赖的mhash的时候一直有问题还没解决 一个常用的PHP编译配置参数./configure --prefix=/usr/local/PHP\\ --with-libdir=lib64\\ --enable-fpm\\ --with-fpm-user=PHP-fpm\\ --with-fpm-group=www\\ --enable-mysqlnd\\ --with-mysql=mysqlnd\\ --with-mysqli=mysqlnd\\ --with-pdo-mysql=mysqlnd\\ --enable-opcache\\ --enable-pcntl\\ --enable-mbstring\\ --enable-soap\\ --enable-zip\\ --enable-calendar\\ --enable-bcmath\\ --enable-exif\\ --enable-ftp\\ --enable-intl\\ --with-openssl\\ --with-zlib\\ --with-curl\\ --with-gd\\ --with-zlib-dir=/usr/lib\\ --with-png-dir=/usr/lib\\ --with-jpeg-dir=/usr/lib\\ --with-gettext\\ --with-mhash\\ --with-ldap","categories":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://www.clarencep.com/tags/PHP/"},{"name":"extension","slug":"extension","permalink":"http://www.clarencep.com/tags/extension/"}]},{"title":"关于clarence-pan.gitcafe.io","slug":"about-clarence-pan.gitcafe.io","date":"2015-11-30T13:09:50.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/11/30/about-clarence-pan.gitcafe.io/","link":"","permalink":"http://www.clarencep.com/2015/11/30/about-clarence-pan.gitcafe.io/","excerpt":"由于github.io在国内访问的会比较慢，并且时常会出现无法连接的现象（原因你懂的），特设立了clarence-pan.gitcafe.io作为本博客的镜像站点。欢迎访问。","text":"由于github.io在国内访问的会比较慢，并且时常会出现无法连接的现象（原因你懂的），特设立了clarence-pan.gitcafe.io作为本博客的镜像站点。欢迎访问。 若问如何架设gitcafe上的博客？请移步这里观看官方文档，很简单的。 后记：gitcafe已经挂了，请访问 clarencep.com.","categories":[{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/categories/blog/"},{"name":"gitcafe","slug":"blog/gitcafe","permalink":"http://www.clarencep.com/categories/blog/gitcafe/"}],"tags":[{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/tags/blog/"},{"name":"gitcafe","slug":"gitcafe","permalink":"http://www.clarencep.com/tags/gitcafe/"}]},{"title":"一个短信中最多可以容纳多少中英文混合的字符？","slug":"max-chars-in-a-sms","date":"2015-09-23T09:53:36.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/09/23/max-chars-in-a-sms/","link":"","permalink":"http://www.clarencep.com/2015/09/23/max-chars-in-a-sms/","excerpt":"今天遇到一个问题——一个短信里面最多可以容纳多少个中英文混编的字符？顺手google了以下，发现这个事情跟我的直觉还是不太一样的，特此记录，以备后查。","text":"今天遇到一个问题——一个短信里面最多可以容纳多少个中英文混编的字符？顺手google了以下，发现这个事情跟我的直觉还是不太一样的，特此记录，以备后查。 直觉是： 一条短信最多70个中文字符 一条短信最多140个英文字符或数字 （一个中文字符 = 2个英文字符或数字） 混合中文和英文的话，就按中文2字节，英文或数字1字节算，比如一半一半的情况总共有35个中文，70个英文... 然而，直觉是错误的！ 真实情况： 一条短信最多70个中文字符 （这个没错） 一条短信最多160个英文字符或数字 （稍后解释） 混合中英文的话，最多70个字符，一个中文、英文或数字都算一个字符！ （稍后解释） 为什么呢？ 当初发明短信的时候，都是使用英文的，然后，估计是拍脑袋，定下了一条短信160个字符的限制 —— 160 = 80 * 2, 貌似刚好是传统打字机两行文本的长度，难道不只是巧合？ 然而，这160个字符在网络上传输的时候，并不是按一个字节8个bit存放一个字符进行传输的——估计是为了节省空间吧，使用了7个bit存放一个字符的方式进行传输，即只能发ASCII字符。算一下，160 7bit = 1120bit = 140 8bit, 刚好PDU是140字节。后来这个140字节的限制就写入了短信标准中去了 -- GSM 03.38 到了手机短信国际化的年代，比如使用中文的时候怎么办? 后来就通常使用16bit来表示一个中文字符，注意哦，这个用的是UCS-2编码，是固定长度的编码方式——即使是英文或数字，也得占用16bit. 算一下，140 8bit = 1120bit = 70 16bit, 刚好只能容纳70个字符...详见：GSM 03.38 这些标准看起来都是2G时代的标准，不知道以后3G、LTE等的标准是否对此进行了扩展... 参考 手机短信的编码和长度限制-天缘博客 UTF-16/UCS-2 GSM 03.38","categories":[{"name":"string","slug":"string","permalink":"http://www.clarencep.com/categories/string/"},{"name":"encoding","slug":"string/encoding","permalink":"http://www.clarencep.com/categories/string/encoding/"}],"tags":[{"name":"sms","slug":"sms","permalink":"http://www.clarencep.com/tags/sms/"},{"name":"unicode","slug":"unicode","permalink":"http://www.clarencep.com/tags/unicode/"},{"name":"UCS-2","slug":"UCS-2","permalink":"http://www.clarencep.com/tags/UCS-2/"},{"name":"UTF-16","slug":"UTF-16","permalink":"http://www.clarencep.com/tags/UTF-16/"},{"name":"encoding","slug":"encoding","permalink":"http://www.clarencep.com/tags/encoding/"},{"name":"string","slug":"string","permalink":"http://www.clarencep.com/tags/string/"}]},{"title":"如何在静态博客中嵌入评论","slug":"how-to-embed-comments-to-static-blog","date":"2015-09-10T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/09/10/how-to-embed-comments-to-static-blog/","link":"","permalink":"http://www.clarencep.com/2015/09/10/how-to-embed-comments-to-static-blog/","excerpt":"背景静态博客（如本博客使用的是hexo来生成的），有很多优点，比如能抗很大的流量，而且有http://github.io这样的免费的托管可以使用。但是，毕竟只是html，于是一般只能浏览，没法与访问者进行互动，访问者没法评论。这那能行呢？","text":"背景静态博客（如本博客使用的是hexo来生成的），有很多优点，比如能抗很大的流量，而且有http://github.io这样的免费的托管可以使用。但是，毕竟只是html，于是一般只能浏览，没法与访问者进行互动，访问者没法评论。这那能行呢？ 这两天在访问mindhacks上的一篇文章的时候，发现这位博主使用的多说挺有意思的，能提供对这种静态博客的评论。于是乎，闲暇之际在偶自己的静态博客试用下，看看如何... 偶的多说试用小记首先，登录多说进入多说的官网，然后有一个【我要安装】，点击后会提示登录。这时可以有好多种open API登录方式可以选择，偶就随便选个QQ登录，然后登录上去了。 接着，获取评论框代码多说的API还是很简洁的，除了公共js代码外，评论框就一行： &lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;请将此处替换成文章在你的站点中的ID&quot; data-title=&quot;请替换成文章的标题&quot; data-url=&quot;请替换成文章的网址&quot;&gt;&lt;/div&gt; 然后，嵌入到博客中本博客是hexo生成的，当然不能直接每篇文章都直接插入这段代码，肯定得用模版来插入。翻了下源代码，根据渲染出来的html结构去搜索（感谢grep，感谢xargs，感谢find...），再连猜带蒙，终于找到了渲染博客页面的模版文件：themes/landscape/layout/_partial/article.ejs。定眼一看，原来hexo的这个模版已经包含了 disqus 的评论功能！晕，早知道就直接注册个 disqus 的帐号就好了。 &lt;footer class=&quot;article-footer&quot;&gt; &lt;%- partial(&#39;post/tag&#39;) %&gt; &lt;a data-url=&quot;&lt;%- post.permalink %&gt;&quot; data-id=&quot;&lt;%= post.path %&gt;&quot; class=&quot;article-share-link&quot;&gt;Share&lt;/a&gt; &lt;% if (post.comments){ %&gt; &lt;% if (config.disqus_shortname){ %&gt; &lt;a href=&quot;&lt;%- post.permalink %&gt;#disqus_thread&quot; class=&quot;article-comment-link&quot;&gt;Comments&lt;/a&gt; &lt;% } %&gt; &lt;% } %&gt; &lt;/footer&gt; 不过事已至此，先把多说的评论功能加上去再说。 多说的评论需要三个参数，经过研究hexo的模版和文档，总结如下： 参数 含义 hexo模版的值 thread-key 文章ID post.path title 文章标题 post.title url 文章链接 域名+make_url(post.path) 填充到模版中，就是： &lt;footer class=&quot;article-footer&quot;&gt; &lt;%- partial(&#39;post/tag&#39;) %&gt; &lt;a data-url=&quot;&lt;%- post.permalink %&gt;&quot; data-id=&quot;&lt;%= post._id %&gt;&quot; class=&quot;article-share-link&quot;&gt;Share&lt;/a&gt; &lt;% if (post.comments){ %&gt; &lt;div id=&quot;post-comments&quot;&gt; &lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;&lt;%= post._id %&gt;&quot; data-title=&quot;&lt;%= post.title %&gt;&quot; data-url=&quot;http://clarence-pan.github.io&lt;%- url_for(post.path) %&gt;&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;% } %&gt; &lt;/footer&gt; 其次，多说公共JS的添加经过上述步骤，还是不能跑起来的 —— 因为所有的前台交互都是在js里面，即多说公共JS。既然是公共的JS，那么其他页面也可能都会用到的，比如以后要在首页添加最新点评、添加热门文章之类的功能，也都需要这JS。而且既然是JS，那最好应放到页面尾部，以防止阻塞页面（以防万一）。找了下hexo的模版，发现有footer.ejs还有after-footer.ejs，显然after-footer.ejs位置更靠后，加进去试试： // ... &lt;script src=&quot;/lib/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;% if (theme.fancybox){ %&gt; &lt;%- css(&#39;fancybox/jquery.fancybox&#39;) %&gt; &lt;%- js(&#39;fancybox/jquery.fancybox.pack&#39;) %&gt; &lt;% } %&gt; &lt;%- js(&#39;js/script&#39;) %&gt; &lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt; &lt;script type=&quot;text/javascript&quot;&gt; var duoshuoQuery = {short_name:&quot;clarence-pan&quot;}; (function() { var ds = document.createElement(&#39;script&#39;); ds.type = &#39;text/javascript&#39;;ds.async = true; ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;; ds.charset = &#39;UTF-8&#39;; (document.getElementsByTagName(&#39;head&#39;)[0] || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds); })(); &lt;/script&gt; &lt;!-- 多说公共JS代码 end --&gt; 最后，构建hexo并发布hexo generate --deploy 搞定~ 最后的问题 -- 样式额，这个评论框左上角【喜欢】和右上角【分享】时候不太搭啊~~ 调一调吧： #post-comments #ds-thread #ds-reset a.ds-like-thread-button float: left margin-top: -3em .article-tag-list margin-left: 7em 在article.styl中加入以上代码，重新构建并发布，果然好看了点... 使用disqus相对于多说，disqus的嵌入就颇为简单了 —— hexo的模版已经嵌入好了，只要： 打开disqus 登录/注册，可以直接用google/facebook/twitter帐号快速登录~ 点击右上角人物头像右边的齿轮，然后选择Add Disqus To Site 填写网站，并选个合适的短名称 把短名称填入_config.yml中，如偶的是： disqus_shortname: clarence-pan 构建，发布即可 over~ 附：评论插件比较 登录方式 评论格式 其他 多说 QQ、新浪、网易、搜狐、豆瓣、人人等 纯文本 disqus Disqus, Facebook, Twitter, Google 文本 + 图片 需要翻墙！！！ 待续.. 可见多说是以国内用户为主的，disqus是以国外和可翻墙用户为主的。不过对于偶们开发人员，翻个墙还不是小意思吗。 附：参考文档 mindhacks上的一篇文章 hexo中文文档 多说评论框调用代码参数说明 告别多说，拥抱 Disqus","categories":[{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/categories/blog/"},{"name":"comments","slug":"blog/comments","permalink":"http://www.clarencep.com/categories/blog/comments/"}],"tags":[{"name":"多说","slug":"多说","permalink":"http://www.clarencep.com/tags/多说/"},{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/tags/blog/"},{"name":"hexo","slug":"hexo","permalink":"http://www.clarencep.com/tags/hexo/"},{"name":"comments","slug":"comments","permalink":"http://www.clarencep.com/tags/comments/"}]},{"title":"Ubuntu下配置DNS服务器","slug":"how-to-config-dns-server-in-ubuntu","date":"2015-07-30T00:00:00.000Z","updated":"2015-09-10T00:00:00.000Z","comments":true,"path":"2015/07/30/how-to-config-dns-server-in-ubuntu/","link":"","permalink":"http://www.clarencep.com/2015/07/30/how-to-config-dns-server-in-ubuntu/","excerpt":"一、安装DNS服务器-bind9bind9可以直接用apt-get安装： sudo apt-get install bind9","text":"一、安装DNS服务器-bind9bind9可以直接用apt-get安装： sudo apt-get install bind9 #二、配置服务器bind9的配置文件在/etc/bind/目录下，入口文件是named.conf，这个文件包含了named.conf.options, named.conf.local和named.conf.default-zones。其中named.conf.options中包含了以下内容： options { // 缓存目录 directory &quot;/var/cache/bind&quot;; // 本机解析不了的DNS该转发到哪里 forwarders { 8.8.8.8; }; dnssec-validation auto; auth-nxdomain no; # conform to RFC1035 listen-on-v6 { any; }; }; named.conf.local一般是空的，不用管它。named.conf.default-zones中包含了解析的域名的配置，节选如下： // 正向解析配置，即从域名localhost解析到127.0.0.1 zone &quot;localhost&quot; { type master; file &quot;/etc/bind/db.local&quot;; }; // 反向解析配置，即从IP 127.0.0.1解析到localhost zone &quot;127.in-addr.arpa&quot; { type master; file &quot;/etc/bind/db.127&quot;; }; 具体的配置都在文件db.xxxx中，比如db.local中如下： ; ; BIND data file for local loopback interface ; $TTL 604800 ; 下面的root.localhost.是管理员邮箱，其中的&#39;@&#39;被替换为了&#39;.&#39; @ IN SOA localhost. root.localhost. ( 2 ; Serial 即序列号，或者说版本号，每次改动后应修改下这里 604800 ; Refresh 刷新时间(单位秒，下同) 86400 ; Retry 重试时间 2419200 ; Expire 过期时间 604800 ) ; Negative Cache TTL 缓存TTL ; @ IN NS localhost. ; 指定域名 @ IN A 127.0.0.1 ; A记录，即指向IPv4地址的记录 @ IN AAAA ::1 ; 指向IPv6地址的记录 三、 如何增加一条DNS记录最简单的办法，copy+paste，然后改吧改吧试试，比如增加example.com的记录: 从db.local拷贝成db.example, 然后把里面的localhost都改成example.com:$TTL 604800 @ IN SOA example. root.example. ( 2 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 604800 ) ; Negative Cache TTL ; @ IN NS example. @ IN A 127.0.0.1 @ IN AAAA ::1 将named.conf.default-zones中的localhost的zone拷贝一份，将localhost都改成example.com:zone &quot;example.com&quot; { type master; file &quot;/etc/bind/db.example&quot;; }; 重启bind9服务$ sudo /etc/init.d/bind9 restart * Stopping domain name service... bind9 waiting for pid 2759 to die [ OK ] * Starting domain name service... bind9 [ OK ] 好了，试试解析example.com，此处就使用简单方便的dig:```$ dig @localhost example.com ; &lt;&lt;&gt;&gt; DiG 9.9.5-4.3ubuntu0.3-Ubuntu &lt;&lt;&gt;&gt; @localhost example.com; (1 server found);; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59594;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1 ;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096;; QUESTION SECTION:;example.com. IN A ;; ANSWER SECTION:example.com. 604800 IN A 127.0.0.1 ;; AUTHORITY SECTION:example.com. 604800 IN NS example. ;; Query time: 4 msec;; SERVER: 127.0.0.1#53(127.0.0.1);; WHEN: Tue Aug 04 10:14:15 CST 2015;; MSG SIZE rcvd: 77`` 看到了ANSWER SECTION: example.com. 604800 IN A 127.0.0.1`，就说明OK了。 附 - 什么是A记录?A记录，即主机记录，根据RFC 1035的定义，A记录用于将特定主机名映射到对应主机的IP地址上。常见的DNS资源记录还有： CNAME - 别名记录，将某个主机名映射到另外一个主机名 AAAA - IPv6记录，类似A记录，是映射到IPv6地址 NAPTR - 正则表达式匹配域名然后映射","categories":[{"name":"linux","slug":"linux","permalink":"http://www.clarencep.com/categories/linux/"},{"name":"DNS","slug":"linux/DNS","permalink":"http://www.clarencep.com/categories/linux/DNS/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://www.clarencep.com/tags/linux/"},{"name":"DNS","slug":"DNS","permalink":"http://www.clarencep.com/tags/DNS/"}]},{"title":"又是一个渐变色生成算法","slug":"generate_gradient_color","date":"2015-05-07T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2015/05/07/generate_gradient_color/","link":"","permalink":"http://www.clarencep.com/2015/05/07/generate_gradient_color/","excerpt":"背景简化了下背景，给定一个指标X，比较小的时候是正常的，比较大的时候比较危险。为了更直观地地显示，前端显示的时候希望使用颜色来高亮这个值——比较小的时候颜色是绿色，较大的时候显示红色，并且用一些黄色进行过渡。 使用google搜了搜，没有找到合适的代码。于是乎，露珠自己打算搞个~贻笑大方了···","text":"背景简化了下背景，给定一个指标X，比较小的时候是正常的，比较大的时候比较危险。为了更直观地地显示，前端显示的时候希望使用颜色来高亮这个值——比较小的时候颜色是绿色，较大的时候显示红色，并且用一些黄色进行过渡。 使用google搜了搜，没有找到合适的代码。于是乎，露珠自己打算搞个~贻笑大方了··· 分析颜色在HTML中可以用RGB值来表示——绿色是rgb(0,255,0), 红色是rgb(255,0,0),黄色是rgb(255,255,0). 为了达到渐变效果，需要设计一个函数F: F(0) = rgb(0,255,0); F(比较大的值) = rgb(255,0,0); F(中间的值) = rgb(255,255,0); 结果函数貌似很复杂，但是调了一会就出来了，效果来不错。 晒晒代码： /** * 生成渐变色，从绿色到红色的渐变 * @param int $x 指标值 * @param int $threshold 渐变阈值，$x等于这个值的时候刚好是黄色 * @param float $brightness 亮度，从0到1 * @return string RGB格式的颜色值 */ function generateGradientColor($x, $threshold, $brightness = 1){ return sprintf(&#39;rgb(%d, %d, 0)&#39;, intval(min(255, ($x * 1.0 / $threshold * 255)) * $brightness), intval(max(0, min(255, (2 - $x * 1.0 / $threshold) * 255)) * $brightness)); } 效果生成的渐变色的效果如下（threshold = 25）： 附生成上述效果的PHP代码： &lt;style&gt; div{ display: block; font-size: 10px; height: 1em; } &lt;/style&gt; &lt;?PHP for ($i = 1; $i &lt; 50; $i++){ echo strtr(&quot;&lt;div style=&#39;width: {width}em; background-color: {color}&#39;&gt;$i&lt;/div&gt;&quot;, array( &#39;{width}&#39; =&gt; $i, &#39;{color}&#39; =&gt; generateGradientColor($i, 25) )); } ?&gt; [ ](http://pic.cnblogs.com/face/u97202.gif)","categories":[{"name":"algorithm","slug":"algorithm","permalink":"http://www.clarencep.com/categories/algorithm/"}],"tags":[{"name":"algorithm","slug":"algorithm","permalink":"http://www.clarencep.com/tags/algorithm/"},{"name":"image","slug":"image","permalink":"http://www.clarencep.com/tags/image/"}]},{"title":"【转】linux中巧用ctrl-z后台运行程序","slug":"zhuan_ctrl_z_in_linux","date":"2014-12-21T23:10:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2014/12/21/zhuan_ctrl_z_in_linux/","link":"","permalink":"http://www.clarencep.com/2014/12/21/zhuan_ctrl_z_in_linux/","excerpt":"cnblogs Post date: 2014-12-21 23:10 背景： 最近在执行一些长时间程序的时候，老是一不小心忘了输入‘&amp;’ ， 结果终端就卡在那里了，很是郁闷 以前总是再新开一个终端。","text":"cnblogs Post date: 2014-12-21 23:10 背景： 最近在执行一些长时间程序的时候，老是一不小心忘了输入‘&amp;’ ， 结果终端就卡在那里了，很是郁闷 以前总是再新开一个终端。 今天翻看《鸟哥的linux私房菜》的时候，发现介绍vim的时候介绍了一个ctrl-z命令可以将当前的程序切到后台，很好用！可是怎么再切回去呢？搜了下，见下文： -----------转载自：http://blog.chinaunix.net/uid-10219166-id-2968756.html ----------- 以下是原文 假设你发现前台运行的一个程序需要很长的时间,但是需要干其他的事情,你就可以用 Ctrl-Z ,终止这个程序,然后可以看到系统提示: [1]+ Stopped /root/bin/rsync.sh 然后我们可以把程序调度到后台执行:(bg 后面的数字为作业号) #bg 1 [1]+ /root/bin/rsync.sh &amp; 用 jobs 命令查看正在运行的任务: #jobs [1]+ Running /root/bin/rsync.sh &amp; 如果想把它调回到前台运行,可以用 #fg 1 /root/bin/rsync.sh 这样,你在控制台上就只能等待这个任务完成了. &amp; 将指令丢到后台中去执行 [ctrl]+z 将前台任务丢到后台中暂停 jobs 查看后台的工作状态 fg %jobnumber 将后台的任务拿到前台来处理 bg %jobnumber 将任务放到后台中去处理 kill 管理后台的任务 命令运行时使用CTRL+Z，强制当前进程转为后台，并使之停止。 1. 使进程恢复运行（后台） （1）使用命令bg Example： zuii@zuii-desktop：~/unp/tcpcliserv\\$ ./tcpserv01 *这里使用CTRL+Z，此时serv01是停止状态* [1]+ Stopped ./tcpserv01 zuii@zuii-desktop：~/unp/tcpcliserv\\$ bg [1]+ ./tcpserv01 &amp; *此时serv01运行在后台* zuii@zuii-desktop：~/unp/tcpcliserv\\$ （2）如果用CTRL+Z停止了几个程序呢？ Example： zuii@zuii-desktop：~/unp/tcpcliserv\\$ jobs [1]- Running ./tcpserv01 &amp; [2]+ Stopped ./tcpcli01 127.0.0.1 zuii@zuii-desktop：~/unp/tcpcliserv\\$ bg %1 bash： bg：任务 1 已转入后台 *后台运行* 使进程恢复至前台运行** Example： zuii@zuii-desktop：~/unp/tcpcliserv\\$ ./tcpserv04 [1]+ Stopped ./tcpserv04 zuii@zuii-desktop：~/unp/tcpcliserv\\$ fg 。/tcpserv04 总结：** （1） CTRL+Z停止进程并放入后台 （2） jobs 显示当前暂停的进程 （3） bg %N 使第N个任务在后台运行（%前有空格） （4） fg %N 使第N个任务在前台运行 默认bg，fg不带%N时表示对最后一个进程操作！ --------- 以上是原文 后记： 《鸟哥的linux私房菜》后面也有章节介绍fg和bg，只是当时还没看到","categories":[{"name":"Linux","slug":"Linux","permalink":"http://www.clarencep.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://www.clarencep.com/tags/Linux/"},{"name":"Background Jobs","slug":"Background-Jobs","permalink":"http://www.clarencep.com/tags/Background-Jobs/"}]},{"title":"优秀的程序员总是使得自己看起来是多余的...","slug":"p_2013_01_11_2857145","date":"2013-01-11T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2013/01/11/p_2013_01_11_2857145/","link":"","permalink":"http://www.clarencep.com/2013/01/11/p_2013_01_11_2857145/","excerpt":"","text":"cnblogs Post date: 2013-01-11 22:41 优秀的程序员总是使得自己看起来是多余的，他们能让系统在缺少他们的情况下仍能不停的工作、生产有价值的东西。只有最开明的公司老板才能真正认识到这种人的真正价值。","categories":[{"name":"Thoughts","slug":"Thoughts","permalink":"http://www.clarencep.com/categories/Thoughts/"}],"tags":[{"name":"Thoughts","slug":"Thoughts","permalink":"http://www.clarencep.com/tags/Thoughts/"}]},{"title":"C函数调用中对入参取地址引发的问题","slug":"p_2013_01_11_2855675","date":"2013-01-11T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2013/01/11/p_2013_01_11_2855675/","link":"","permalink":"http://www.clarencep.com/2013/01/11/p_2013_01_11_2855675/","excerpt":"cnblogs Post date: 2013-01-11 00:05 看这段代码：","text":"cnblogs Post date: 2013-01-11 00:05 看这段代码： void set(int* a, int* b); void setA(int a) { set(&amp;a, 0); } void setB(int b) { set(0, &amp;b); } int g_a = 0, g_b = 0; void set(int* a, int* b) { if (a) g_a = *a; if (b) g_b = *b; } 看看这段代码，乍一看没什么问题 仔细琢磨，能发现这个setA和setB函数有个问题： 如果编译器默认调用约定是fastcall类型的寄存器调用（如现在的ARM、PPC），那么可能会将入参存放在寄存器中，而对入参取地址则就算对寄存器取地址，这个行为很可能出问题 -- 目前程序在PPC上是没问题的 -- 如果真的没问题就不会思考这件事了：在某些情况下会概率性地失效，详细原因有待挖掘","categories":[{"name":"C","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"Parameter","slug":"Parameter","permalink":"http://www.clarencep.com/tags/Parameter/"}]},{"title":"项目管理随想一","slug":"p_2012_12_20_2827283","date":"2012-12-20T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2012/12/20/p_2012_12_20_2827283/","link":"","permalink":"http://www.clarencep.com/2012/12/20/p_2012_12_20_2827283/","excerpt":"cnblogs Post date: 2012-12-20 23:49 很多时候项目管理就是平衡。","text":"cnblogs Post date: 2012-12-20 23:49 很多时候项目管理就是平衡。 资源vs质量vs进度 资源： 1.1人力资源：10人新人vs 1个老人 1.2 硬件资源：办公场所、生产设备、操作的电脑等等 1.3 软件资源：良好的工作氛围、舒适的心理状态、融洽的团队关系等等 质量 2.1 功能：用户需要这么多功能如何取舍 2.2 性能：耐用、容量、速度等 2.3 成本：节省成本还是不在乎成本 2.4 个性化： 现在是追求个性化，一切皆可以定制的时代 进度 3.1 时间：什么时候需要交付产品","categories":[{"name":"Project Management","slug":"Project-Management","permalink":"http://www.clarencep.com/categories/Project-Management/"}],"tags":[{"name":"Project Management","slug":"Project-Management","permalink":"http://www.clarencep.com/tags/Project-Management/"}]},{"title":"文件名乱码转换器","slug":"p_2012_11_02_chgEncode","date":"2012-11-02T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2012/11/02/p_2012_11_02_chgEncode/","link":"","permalink":"http://www.clarencep.com/2012/11/02/p_2012_11_02_chgEncode/","excerpt":"cnblogs Post date: 2012-11-02 23:35 今天上网下点歌曲，结果发现是乱码！！ 这可怎么办呢？","text":"cnblogs Post date: 2012-11-02 23:35 今天上网下点歌曲，结果发现是乱码！！ 这可怎么办呢？ 打开文件，自然可以听出是什么歌，但是问题关键在于我不止下载了一首，而且一首歌一首歌听过来也未免太浪费时间了. 作为一个程序猿，自然想到了编程解决这个问题: 我选择的是用.net的文本编码类来做这个编码转换，因为对.Net比较熟悉 来晒晒代码：http://files.cnblogs.com/pcy0/chgEncode.zip (话说园子居然不让上传.tgz的文件，害得我又重新学了下zip的命令） 核心转换算法（汗）： 将字符串先按A编码解成码流，再按B编码组织为字符串，这样完成从A到B的转换 // Convert @s from encoding @A to @B public static string ConvertEncoding (String s, Encoding A, Encoding B) { try { var bytes = A.GetBytes (s); return B.GetString (bytes); } catch(Exception ex) { debug (ex.ToString()); return &quot;&gt;&gt;&gt;FAILED:&quot; + ex.Message + &quot;&lt;&lt;&lt;&quot;; } } 处理入参等逻辑（C语言写惯了，都把C#写成过程式的了）： 主要实现了一下功能： 查看当前可选的N种编码类型（命令行 -l / --list-all-encoding参数） 尝试N -> N的编码转换，并打印出转换后的文件名（命令行-t / --try-all-encoding参数） -- 最终发现一般中文编码是GBK/GB2312/GB18030等GB开头的，而linux下目录的编码都是ISO-8859-X，不过N*N个编码转换也很容易通过CTRL+F来找到合适的编码类型 确认编码类型后，转换并重命名文件（交互式的哦～） // Complie: mono-csc chgEncode.cs // Example: chgEncode.exe ~/Music iso-8859-9 GB18030 public static int Main (String[]args) { if (args.Count () &lt; 1) { } else if (args.Length == 1 &amp;&amp; (args [0] == &quot;--list-all-encoding&quot; || args [0] == &quot;-l&quot;)) { var encodings = Encoding.GetEncodings (); debug (&quot;Found &quot; + encodings.Count () + &quot; encoding(s)&quot;); println (&quot;name\\tcode-page\\tdisplay-name&quot;); foreach (var e in encodings) { println (e.Name + &quot;\\t&quot; + e.CodePage + &quot;\\t&quot; + e.DisplayName); } return 0; } else if (args.Length == 2 &amp;&amp; (args [0] == &quot;--try-all-encoding&quot; || args [0] == &quot;-t&quot;)) { var dir = args [1]; debug (&quot;Input dir is &quot; + dir); var files = Directory.EnumerateFiles (dir); debug (&quot;Found &quot; + files.Count () + &quot; file(s)&quot;); var filename = files.First(); var encodings = Encoding.GetEncodings (); debug (&quot;Found &quot; + encodings.Length + &quot; encoding(s)&quot;); foreach (var e in encodings) { foreach (var f in encodings) { try{ // I don&#39;t know the cause but it always failed hear! So I add the try... catch. println (&quot;file &quot; + filename + &quot; &quot; + e.Name + &quot; -&gt; &quot; + f.Name + &quot; : &quot; + ConvertEncoding (filename, e.GetEncoding (), f.GetEncoding ())); } catch{} } } } else if (args.Length == 3) { var dir = args [0]; debug (&quot;Input dir is &quot; + dir); var files = Directory.EnumerateFiles (dir); debug (&quot;Found &quot; + files.Count () + &quot; file(s)&quot;); var encodings = Encoding.GetEncodings (); debug (&quot;Found &quot; + encodings.Count () + &quot; encoding(s)&quot;); var A = encodings.FirstOrDefault (e =&gt; e.Name == args[1]); var B = encodings.FirstOrDefault (e =&gt; e.Name == args[2]); if (null == A || null == B) { println (&quot;Error: failed to find the encodings!&quot;); return 1; } foreach (var file in files) { var newFile = ConvertEncoding (file, A.GetEncoding (), B.GetEncoding ()); Console.Write(file + &quot; -&gt; \\&quot;&quot; + newFile + &quot;\\&quot; [Y/N]?&quot;); Console.Out.Flush(); try { if (&quot;y&quot; == Console.ReadLine().ToLower()) { File.Move(file, newFile); } } catch(Exception ex) { debug (ex.ToString()); println(&quot;Failed: &quot;+ex.Message); } } } else { println (&quot;Usage1: chgEncode &lt;dir&gt; &lt;encode-A&gt; &lt;encode-B&gt;&quot;); println (&quot; change the encoding of files in @dir&quot;); println (&quot;Usage2: chgEncode --list-all-encoding&quot;); println (&quot; chgEncode -l&quot;); println (&quot; list all encodings&quot;); println (&quot;Usage3: chgEncode --try-all-encoding &lt;dir&gt;&quot;); println (&quot; chgEncode -t &lt;dir&gt;&quot;); println (&quot; try all encoding to convert the first file of @dir&quot;); } return 0; } 居然花费了一个小时才搞定，真的水平退步了 不过效果还挺好，至少达成咱的目的了 使用效果： # 将~/tmp目录下的文件从iso-8859-1编码转换为gb2312编码peter@peter-K43SJ:~/Code/chgEncode$ ./chgEncode.exe ~/tmp iso-8859-1 gb2312 Input dir is /home/peter/tmp Found 2 file(s) Found 95 encoding(s) /home/peter/tmp/Å£×ÐºÜÃ¦.mp3 -&gt; &quot;/home/peter/tmp/牛仔很忙.mp3&quot; [Y/N]?y /home/peter/tmp/ÌýÂèÂèµÄ»°.mp3 -&gt; &quot;/home/peter/tmp/听妈妈的话.mp3&quot; [Y/N]?y # 显示帮助 peter@peter-K43SJ:~/Code/chgEncode$ ./chgEncode.exe --help Usage1: chgEncode &lt;dir&gt; &lt;encode-A&gt; &lt;encode-B&gt; change the encoding of files in @dir Usage2: chgEncode --list-all-encoding chgEncode -l list all encodings Usage3: chgEncode --try-all-encoding &lt;dir&gt; chgEncode -t &lt;dir&gt; try all encoding to convert the first file of @dir","categories":[{"name":"Encoding","slug":"Encoding","permalink":"http://www.clarencep.com/categories/Encoding/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"Encoding","slug":"Encoding","permalink":"http://www.clarencep.com/tags/Encoding/"}]},{"title":"【转载】/proc目录中的重要信息","slug":"p_2012_11_01_proc_has_what","date":"2012-11-01T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2012/11/01/p_2012_11_01_proc_has_what/","link":"","permalink":"http://www.clarencep.com/2012/11/01/p_2012_11_01_proc_has_what/","excerpt":"cnblogs Post date: 2012-11-01 23:46 /proc目录中的重要信息","text":"cnblogs Post date: 2012-11-01 23:46 /proc目录中的重要信息 原文链接： http://blog.chinaunix.net/space.PHP?uid=12290680&amp;do=blog&amp;id=26894/proc/cpuinfo - CPU信息 (i.e. vendor, Mhz, flags like mmx)/proc/interrupts - 中断/proc/ioports - 设备IO端口/proc/meminfo - 内存信息(i.e. mem used, free, swap size)/proc/partitions - 所有设备的所有分区/proc/pci - PCI设备的信息/proc/swaps - 所有Swap分区的信息/proc/version - Linux的版本号/proc/sys/fs/file-max该文件指定了可以分配的文件句柄的最大数目/proc/sys/fs/file-nr有三个值: 已分配文件句柄的数目/已使用文件句柄的数目/文件句柄的最大数目/proc/sys/fs/inode-*任何以名称“inode”开头的文件所执行的操作与上面那些以名称“file”开头的文件所执行的操作一样/proc/sys/fs/super-max指定超级块处理程序的最大数目,缺省设置：256/proc/sys/fs/super-nr该文件显示当前已分配超级块的数目/proc/sys/kernel/acct有三个可配置值，根据包含日志的文件系统上可用空间的数量（以百分比表示）/proc/sys/kernel/ctrl-alt-del该值控制系统在接收到 ctrl+alt+delete 按键组合时如何反应。这两个值表示：零（0）值表示捕获 ctrl+alt+delete，并将其送至 init 程序。这将允许系统可以完美地关闭和重启，就好象您输入 shutdown 命令一样。壹（1）值表示不捕获 ctrl+alt+delete，将执行非干净的关闭，就好象直接关闭电源一样。/proc/sys/kernel/domainname该文件允许您配置网络域名/proc/sys/kernel/hostname该文件允许您配置网络主机名/proc/sys/kernel/msgmax该文件指定了从一个进程发送到另一个进程的消息的最大长度,一般8192/proc/sys/kernel/msgmnb该文件指定在一个消息队列中最大的字节数，缺省设置：16384/proc/sys/kernel/msgmni该文件指定消息队列标识的最大数目，缺省设置：16/proc/sys/kernel/panic发生“内核严重错误（kernel panic）”，则内核在重新引导之前等待的时间（以秒为单位）。缺省0为禁止重新引导/proc/sys/kernel/printk该文件有四个数字值，它们根据日志记录消息的重要性，定义将其发送到何处。关于不同日志级别的更多信息，请阅读 syslog(2) 联机帮助页。该文件的四个值为： 控制台日志级别：优先级高于该值的消息将被打印至控制台 缺省的消息日志级别：将用该优先级来打印没有优先级的消息 最低的控制台日志级别：控制台日志级别可被设置的最小值（最高优先级） 缺省的控制台日志级别：控制台日志级别的缺省值缺省设置：6 4 1 7 /proc/sys/kernel/shmall在任何给定时刻系统上可以使用的共享内存的总量（以字节为单位），缺省设置：2097152/proc/sys/kernel/shmmni该文件表示用于整个系统共享内存段的最大数目，缺省设置：4096/proc/sys/kernel/sysrq如果该文件指定的值为非零，则激活 System Request Key，缺省设置：0/proc/sys/kernel/threads-max该文件指定内核所能使用的线程的最大数目，缺省设置：14436/proc/sys/net/core/message_burst-写新的警告消息所需的时间（以 1/10 秒为单位）；在这个时间内所接收到的其它警告消息会被丢弃。这用于防止某些企图用消息“淹没”您系统的人所使用的拒绝服务（Denial of Service）攻击。缺省设置：50（5 秒）/proc/sys/net/core/message_cost该文件存有与每个警告消息相关的成本值。该值越大，越有可能忽略警告消息。缺省设置：5/proc/sys/net/core/netdev_max_backlog该文件指定了，在接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目。缺省设置：300/proc/sys/net/core/optmem_max该文件指定了每个套接字所允许的最大缓冲区的大小。缺省10240/proc/sys/net/core/rmem_default该文件指定了接收套接字缓冲区大小的缺省值（以字节为单位）。为65535/proc/sys/net/core/rmem_max该文件指定了接收套接字缓冲区大小的最大值（以字节为单位）。为131071/proc/sys/net/core/wmem_default该文件指定了发送套接字缓冲区大小的缺省值（以字节为单位）。为65535/proc/sys/net/core/wmem_max该文件指定了发送套接字缓冲区大小的最大值（以字节为单位）。为131071/proc/sys/net/ipv4所有 IPv4 和 IPv6 的参数都被记录在内核源代码文档中。请参阅文件/usr/src/linux/Documentation/networking/ip-sysctl.txt。/proc/sys/vm/buffermem该文件控制用于缓冲区内存的整个系统内存的数量（以百分比表示）。它有三个值，通过把用空格相隔的一串数字 写入该文件来设置这三个值。用于缓冲区的内存的最低百分比；如果发生所剩系统内存不多，而且系统内存正在减少这种情况，系统将试图维护缓冲区内存的数量； 用于缓冲区的内存的最高百分比。缺省设置：2 10 60/proc/sys/vm/freepages该文件控制系统如何应对各种级别的可用内存。它有三个值，通过把用空格相隔的一串数字写入该文件来设置这三个值。如果系统中可用页面的数目达到了最低限制，则只允许内核分配一些内存。如果系统中可用页面的数目低于这一限制，则内核将以较积极的方式启动交换，以释放内存，从而维持系统性能。内核将试图保持这个数量的系统内存可用。低于这个值将启动内核交换。缺省设置：512 768 1024 /proc/sys/vm/kswapd该文件控制允许内核如何交换内存。它有三个值，通过把用空格相隔的一串数字写入该文件来设置这三个值：内核试图一次释放的最大页面数目。如果想增加内存交换过程中的带宽，则需要增加该值。内核在每次交换中试图释放页面的最少次数。内核在一次交换中所写页面的数目。这对系统性能影响最大。这个值越大，交换的数据越多，花在磁盘寻道上的时间越少。然而，这个值太大会因“淹没”请求队列而反过来影响系统性能。缺省设置：512 32 8/proc/sys/vm/pagecache该文件与 /proc/sys/vm/buffermem 的工作内容一样，但它是针对文件的内存映射和一般高速缓存。","categories":[{"name":"Linux","slug":"Linux","permalink":"http://www.clarencep.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://www.clarencep.com/tags/Linux/"},{"name":"/proc","slug":"proc","permalink":"http://www.clarencep.com/tags/proc/"}]},{"title":"编译通过的代码不算什么，一眼能看懂的代码才算好代码","slug":"p_2012_06_07_2541074","date":"2012-06-07T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2012/06/07/p_2012_06_07_2541074/","link":"","permalink":"http://www.clarencep.com/2012/06/07/p_2012_06_07_2541074/","excerpt":"cnblogs Post date: 2012-06-07 23:11 代码可读性是非常重要的，尤其是在大项目中","text":"cnblogs Post date: 2012-06-07 23:11 代码可读性是非常重要的，尤其是在大项目中 一段可读性高的代码，往往意味着人们愿意去看它——发现了问题能够迅速解决，并往往继续保持优良传统——高可读性【一个良性循环】 一段可读性低的代码，往往意味着没人想去动它--不到万不得已--往往更懒得花费时间去理解它；既使发现了问题也只希望就事论事，不愿意优化招惹麻烦--天知道当初为什么这样写，优化引入新的问题怎么办 【一个恶性循环】 --记今天一个严重问题 --后记：单元测试是重构的防护网，构建好单元测试，大胆、放心去重构，在功能正确的前提下要时刻注意保持高可读性","categories":[{"name":"Coding Style","slug":"Coding-Style","permalink":"http://www.clarencep.com/categories/Coding-Style/"}],"tags":[{"name":"Coding Style","slug":"Coding-Style","permalink":"http://www.clarencep.com/tags/Coding-Style/"},{"name":"Readablilty","slug":"Readablilty","permalink":"http://www.clarencep.com/tags/Readablilty/"}]},{"title":"如何持续改进？","slug":"p_2012_06_02_2532374","date":"2012-06-02T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2012/06/02/p_2012_06_02_2532374/","link":"","permalink":"http://www.clarencep.com/2012/06/02/p_2012_06_02_2532374/","excerpt":"cnblogs Post date: 2012-06-02 23:33 很多时候，谈敏捷总是要谈小步快跑，持续改进。","text":"cnblogs Post date: 2012-06-02 23:33 很多时候，谈敏捷总是要谈小步快跑，持续改进。 可是如何做到这一点呢？ 今天从切身经历学习到，持续改进，首先是要求总结/反省过去的经验教训，其次要构建质量防护网，建立从设计到开发到测试的端到端地流程checklist，并将经验传承下去。 另外，总结/反省时不要推诿，要客观公正，这不是在追究责任。","categories":[{"name":"Project Management","slug":"Project-Management","permalink":"http://www.clarencep.com/categories/Project-Management/"}],"tags":[{"name":"Project Management","slug":"Project-Management","permalink":"http://www.clarencep.com/tags/Project-Management/"}]},{"title":"Ubuntu使用FQA -- 随便记录一些使用ubuntu12.04中的问题，贻笑大方了\\~","slug":"p_2012_05_19_2508762","date":"2012-05-19T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2012/05/19/p_2012_05_19_2508762/","link":"","permalink":"http://www.clarencep.com/2012/05/19/p_2012_05_19_2508762/","excerpt":"cnblogs Post date: 2012-05-19 11:45 http://wiki.ubuntu.org.cn/%E9%A6%96%E9%A1%B5 这个wiki很全，遇到问题多看看","text":"cnblogs Post date: 2012-05-19 11:45 http://wiki.ubuntu.org.cn/%E9%A6%96%E9%A1%B5 这个wiki很全，遇到问题多看看 Q：如何察看系统版本 A：cat /proc/version peter@peter:~/download$ cat /proc/version Linux version 3.2.0-24-generic (buildd@yellow) (gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5) ) #37-Ubuntu SMP Wed Apr 25 08:43:22 UTC 2012 Q:如何察看系统是32还是64位的 A： uname -m peter@peter:~/download$ uname -m x86_64 Q:如何屏幕截屏 A：printscreen按键可以直接截屏 -- 这一点ubuntu兼容的很不错 Q：如何关闭触摸板 A：系统自带的FN+关触摸板键兼容的很好 Q：如何用QQ A： 尝试装linux版的QQ失败：http://im.qq.com 直接使用web版：http://web.qq.com Q:淘宝购物会不会有问题 A：完全没问题，安全支付插件在ubuntu下也是兼容firefox的 Q：做为一个开发者，ubuntu上能开发什么？ A：探索中。。。。 Q：ubuntu上什么游戏好玩 A：探索中。。。 系统带的几个小游戏没啥好玩的 Q：ubuntu上中文输入法？ A：系统自带的挺好用; 浏览网页时用这个搜狗云输入法也到不错：http://pinyin.sogou.com/cloud/ Q:想要网上购物使用网银怎么办？ A: 尝试过firefox和chromium浏览器都无法正常支付 – 还是安装下虚拟机virtualbox Q：如何创建快捷方式（链接）到桌面上？有一些GUI的程序想到桌面上快捷启动 A：首先不必纠结与桌面启动 – 可以锁定在启动栏上，而且ubuntu的dash首页搜索很快 其次可以创建个符号链接到桌面上就OK了 Q: ctrl+alt+f3等可以进入控制台，可是分辨率太低了，看起来不舒服，怎么样调高分辨率？ A：装好显卡驱动，使用(Recommended)(推荐)的显卡。 修改grub文件 : sudo gedit /etc/default/grub 修改GRUB_CMDLINE_LINUX_DEFAULT GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash nomodeset video=uvesafb:mode_option=1024x768-24,mtrr=3,scroll=ywrap&quot; 修改#GRUB_GFXMODE栏 GRUB_GFXMODE=1024x768-24 修改initramfs: sudo gedit /etc/initramfs-tools/modules 最后一行写入 uvesafb mode_option=1024x768-24 mtrr=3 scroll=ywrap 更新grub和initramfs:sudo update-grub2sudo update-initramfs -u Q: 如何在控制台下显示中文 A：TODO。。。 Q：GNOME不好看，如何安装KDE？ A: sudo apt-get install kUbuntu-destop sudo apt-get install language-pack-kde-zh language-pack-kde-zh-base language-pack-zh language-pack-zh-base language-support-zh 如果安装后不能再进入GNOME，则可以进入KDE设置面板，找到gtk style，改回human，重新登录x windows就行了 Q：怎么安装deb软件包？ A：sudo dpkg -i xxxx.deb Q：怎么样安装RPM软件包？ A：Ubuntu的软件包格式是deb，如果要安装rpm的包，则要先用alien把rpm转换成deb。 sudo apt-get install alien #alien默认没有安装，所以首先要安装它 （或者sudo apt-get install rpm alien） sudo alien xxxx.rpm #将rpm转换位deb，完成后会生成一个同名的xxxx.deb sudo dpkg -i xxxx.deb #安装 Q: 常见的归档文件.tar.gz、.tar.bz2怎么解压缩？ A：.tar.gz: tar xzvf .tar.bz2: tar xjvf example.tar.bz2 tar [-cxtzjvfpPN]**文件与目录....参数： -c：建立一个压缩文件的参数指令(create的意思)； -x：解开一个压缩文件的参数指令！ -t：查看tarfile里面的文件！ 特别注意，在参数的下达中，c/x/t仅能存在一个！不可同时存在！ 因为不可能同时压缩与解压缩。 -z：是否同时具有gzip的属性？亦即是否需要用gzip压缩？ -j：是否同时具有bzip2的属性？亦即是否需要用bzip2**压缩？ 特别注意，在参数的下达中， z/j**要和文件属性匹配，另外归档文件名的扩展名是手工制定的，一般约定gzip的为.gz,而bzip2的是bz2。-v：压缩的过程中显示文件！这个方便压缩/解压过程中直接查看有哪些文件！ -f：使用档名，如果未指定该参数则会输入文件默认是stdin-p：使用原文件的原来属性（属性不会依据使用者而变）-P：可以使用绝对路径来压缩！-N：比后面接的日期(yyyy/mm/dd)还要新的才会被打包进新建的文件中！--exclude FILE：在压缩的过程中，不要将FILE打包！** Q: 使用APT或ubuntu软件中心安装软件卡住了，怎么办？ sudo fuser -vki /var/lib/dpkg/lock;sudo dpkg --configure -a 将会有所帮助 Q：有没有像u-iso一样制作ISO和虚拟光驱的软件？ A：不需要额外软件即可搞定： 制作ISO： dd if=/dev/cdrom of=some-thing.iso mkisofs -o somet-thing.iso /dev/cdrom # 这个程序还可有将一个目录树制作为一个ISO文件 虚拟光驱： mount -o loop some-thing.iso path/to/mount Q: 如何查看CPU型号？i386/i586/i686分别什么型号？ A: cat /proc/cpuinfo即可看到。 i386 几乎适用于所有的 x86 平台，不论是旧的 pentum 或者是新的 pentum-IV 与 K7 系列的 CPU等等，都可以正常的工作！那个 i 指的是 Intel 兼容的 CPU 的意思，至于 386 不用说，就是 CPU 的等级。 i586 就是 586 等级的计算机，包括 pentum 第一代 MMX CPU， AMD 的 K5, K6 系列 CPU ( socket 7 插脚 ) 等 i686 在 pentun II 以后的 Intel 系列 CPU ，及 K7 以后等级的 CPU 都属于这个 686 等级 注：proc目录下的常见信息综述 :http://www.cnblogs.com/pcy0/archive/2012/11/01/proc_has_what.html","categories":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"http://www.clarencep.com/categories/Ubuntu/"}],"tags":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"http://www.clarencep.com/tags/Ubuntu/"},{"name":"Linux","slug":"Linux","permalink":"http://www.clarencep.com/tags/Linux/"}]},{"title":"卸了360和QQ，用WEBQQ吧！","slug":"p_2010_11_06_1870647","date":"2010-11-06T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/11/06/p_2010_11_06_1870647/","link":"","permalink":"http://www.clarencep.com/2010/11/06/p_2010_11_06_1870647/","excerpt":"cnblogs Post date: 2010-11-06 16:54 最近360与QQ干架，搞的我们自己电脑上360与QQ老出问题！","text":"cnblogs Post date: 2010-11-06 16:54 最近360与QQ干架，搞的我们自己电脑上360与QQ老出问题！ 解决方案： 把360和QQ都卸了 想登QQ的用[WebQQ](http://web2.qq.com)吧！ 哥用的是Win7, 360基本没什么用，卸了真干净！ 需要清洁系统的时候用用Win7优化大师之类的就够了\\~","categories":[{"name":"Web APP","slug":"Web-APP","permalink":"http://www.clarencep.com/categories/Web-APP/"}],"tags":[{"name":"QQ","slug":"QQ","permalink":"http://www.clarencep.com/tags/QQ/"},{"name":"WebQQ","slug":"WebQQ","permalink":"http://www.clarencep.com/tags/WebQQ/"}]},{"title":"Nothing","slug":"p_2010_09_07_nothing","date":"2010-09-07T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/09/07/p_2010_09_07_nothing/","link":"","permalink":"http://www.clarencep.com/2010/09/07/p_2010_09_07_nothing/","excerpt":"","text":"cnblogs Post date: 2010-09-07 11:35 Nothing is important except the mind.","categories":[{"name":"Thoughts","slug":"Thoughts","permalink":"http://www.clarencep.com/categories/Thoughts/"}],"tags":[{"name":"Thoughts","slug":"Thoughts","permalink":"http://www.clarencep.com/tags/Thoughts/"}]},{"title":"Opera的一个小BUG","slug":"p_2010_08_03_opera_bug_zzz","date":"2010-08-03T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/08/03/p_2010_08_03_opera_bug_zzz/","link":"","permalink":"http://www.clarencep.com/2010/08/03/p_2010_08_03_opera_bug_zzz/","excerpt":"cnblogs Post date: 2010-08-03 09:32 简介这个BUG是关于\\&lt;!DOCTYPE>标签的。","text":"cnblogs Post date: 2010-08-03 09:32 简介这个BUG是关于\\&lt;!DOCTYPE>标签的。 这个标签一般可以简单的写作： &lt;!DOCTYPE HTML&gt; 表示这是一个HTML文档 对于HTML 4.01的三个标准分别还有三种写法 详见http://www.w3school.com.cn/tags/tag_doctype.asp 发现最近使用eclipse做jsp网页，其中自动生成的\\&lt;!DOCTYPE>标签为： &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &gt; 乍一看也没什么问题，平时也没注意到有什么问题 当用jQuery时就出现问题了： 正常显示： 不正常显示： 不正常的地方： 对话框的标题变高了，Cancel和ok按键也是位置变高了 一开始我还以为是Opera内置的默认样式的问题（IE,chrome，firefox下正常显示），把默认样式覆盖掉，依旧还有这样的问题 然后，采用原始的办法，把页面中其他元素去掉，只留这个对话框所必须的，再把jsp生成的源代码和正常显示的代码一行行相比较…… 最终发现是\\&lt;!DOCTYPE>这个元素的问题：估计是Opera找不到那个DTD。 解决把jsp中\\&lt;!DOCTYPE>改成一下两种即可正常显示： &lt;!DOCTYPE html&gt; &lt;!-- 使用默认DTD也行 --&gt; 或 &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt; 无论用HTML或XHTML最后这个URL都要指定，防止找不到DTD。如果找不到，浏览器将使用公共标识符后面的 URL 作为寻找 DTD 的位置。","categories":[{"name":"Browser","slug":"Browser","permalink":"http://www.clarencep.com/categories/Browser/"}],"tags":[{"name":"Opera","slug":"Opera","permalink":"http://www.clarencep.com/tags/Opera/"},{"name":"Browser","slug":"Browser","permalink":"http://www.clarencep.com/tags/Browser/"}]},{"title":"解决get方法提交的表单乱码问题","slug":"p_2010_08_03_1791048","date":"2010-08-03T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/08/03/p_2010_08_03_1791048/","link":"","permalink":"http://www.clarencep.com/2010/08/03/p_2010_08_03_1791048/","excerpt":"cnblogs Post date: 2010-08-03 11:46 问题get方法提交的表单数据中有中文时会出现乱码","text":"cnblogs Post date: 2010-08-03 11:46 问题get方法提交的表单数据中有中文时会出现乱码 原因get提交的数据在url中，默认不会转换编码（浏览器发送时是utf-8编 码，jsp默认用iso-8859-1编码） 解决 jsp页面首部加入 \\&lt;%request.setCharacterEncoding(&quot;utf-8&quot;);%> 或者使用filter设置编码 对tomcat配置文件(conf/server.xml)中进行更改： &lt;!-- Define a non-SSL HTTP/1.1 Connector on port 8080 --&gt; &lt;!-- &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt; --&gt; &lt;Connector port=&quot;8080&quot; maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot; enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; acceptCount=&quot;100&quot; debug=&quot;0&quot; connectionTimeout=&quot;20000&quot; useBodyEncodingForURI=&quot;true&quot; disableUploadTimeout=&quot;true&quot; /&gt; 页面中就可以直接使用request.getParameter(&quot;name&quot;)","categories":[{"name":"Encoding","slug":"Encoding","permalink":"http://www.clarencep.com/categories/Encoding/"}],"tags":[{"name":"Form","slug":"Form","permalink":"http://www.clarencep.com/tags/Form/"},{"name":"Encoding","slug":"Encoding","permalink":"http://www.clarencep.com/tags/Encoding/"}]},{"title":"博客园这登录的安全性","slug":"p_2010_07_30_cnblogs_sercurity_problem","date":"2010-07-30T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/07/30/p_2010_07_30_cnblogs_sercurity_problem/","link":"","permalink":"http://www.clarencep.com/2010/07/30/p_2010_07_30_cnblogs_sercurity_problem/","excerpt":"cnblogs Post date: 2010-07-30 08:20 事情是这样的： 前天看到有人说QQ Mail未使用HTTPS，然后我就到mail.qq.com上看一下，结果发现QQ Mail登录是必须使用HTTPS的，还可以全程使用HTTPS……","text":"cnblogs Post date: 2010-07-30 08:20 事情是这样的： 前天看到有人说QQ Mail未使用HTTPS，然后我就到mail.qq.com上看一下，结果发现QQ Mail登录是必须使用HTTPS的，还可以全程使用HTTPS…… 再然后想到博客园登录是否是使用HTTPS呢？ 到博客园登录界面一看，没有HTTPS的标志。 抓个包试试呢？ 抓包结果：（使用Wireshark） POST /login.aspx HTTP/1.1 User-Agent: Opera/9.80 (Windows NT 5.1; U; Edition IBIS; zh-cn) Presto/2.6.30 Version/10.60 Host: passport.cnblogs.com Accept: text/html, application/xml;q=0.9, application/xhtml+xml, image/png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1 Accept-Language: zh-CN,zh;q=0.9,en;q=0.8 Accept-Charset: iso-8859-1, utf-8, utf-16, *;q=0.1 Accept-Encoding: deflate, gzip, x-gzip, identity, *;q=0 Referer: http://passport.cnblogs.com/login.aspx Cookie: __gads=ID=0b8e2ba58fbea034:T=1279341585:S=ALNI_MbQjYDttpopP4ovrG6jjC2yz7UBXQ; SyntaxHighlighter=html; __utmz=226521935.1280297628.3.4.utmcsr=google|utmccn=(organic)|utmcmd=organic|utmctr=reflactor; __utma=226521935.112080506.1280280411.1280363182.1280371448.5 Cookie2: $Version=1 Connection: Keep-Alive, TE TE: deflate, gzip, chunked, identity, trailers Content-Length: 327 Content-Type: application/x-www-form-urlencoded __EVENTTARGET=&amp;__EVENTARGUMENT=&amp;__VIEWSTATE=%2FwEPDwUJLTI5NjAzODk2ZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WAQULY2hrUmVtZW1iZXKHW0DW4nQrSrBHBomKrt3%2FMjtBLA%3D%3D&amp;__EVENTVALIDATION=%2FwEWBQKE2u7lCQLyj%2FOQAgK3jsrkBALR55GJDgKC3IeGDO8x1Jd0k%2FhBY1a%2F6Yl9fTpP16ti&amp;tbUserName=abc&amp;tbPassword=123&amp;btnLogin=%E7%99%BB++%E5%BD%95 看到最后一行： tbUserName=abc&amp;tbPassword=123 用户名和密码全是明文发送到服务器的。这安全性……","categories":[{"name":"Security","slug":"Security","permalink":"http://www.clarencep.com/categories/Security/"}],"tags":[{"name":"cnblogs","slug":"cnblogs","permalink":"http://www.clarencep.com/tags/cnblogs/"},{"name":"Security","slug":"Security","permalink":"http://www.clarencep.com/tags/Security/"}]},{"title":"屏蔽网页中鼠标右键、上下文菜单","slug":"p_2010_07_28_1787302","date":"2010-07-28T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/07/28/p_2010_07_28_1787302/","link":"","permalink":"http://www.clarencep.com/2010/07/28/p_2010_07_28_1787302/","excerpt":"cnblogs Post date: 2010-07-28 20:18 据整理，使用一下js脚本就能完成：","text":"cnblogs Post date: 2010-07-28 20:18 据整理，使用一下js脚本就能完成： if(window.Event) document.captureEvents(Event.MOUSEUP); function nocontextmenu() { event.cancelBubble = true event.returnvalue = false; return false; } function norightclick(e) { if (window.Event) { if (e.which == 2 || e.which == 3) return false; } else if (event.button == 2 || event.button == 3) { event.cancelBubble = true event.returnvalue = false; return false; } } document.oncontextmenu = nocontextmenu; // for IE5+ document.onmousedown = norightclick; //","categories":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://www.clarencep.com/categories/JavaScript/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://www.clarencep.com/tags/JavaScript/"},{"name":"Context Menu","slug":"Context-Menu","permalink":"http://www.clarencep.com/tags/Context-Menu/"}]},{"title":"统计web服务器类型","slug":"p_2010_07_26_1785583","date":"2010-07-26T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/07/26/p_2010_07_26_1785583/","link":"","permalink":"http://www.clarencep.com/2010/07/26/p_2010_07_26_1785583/","excerpt":"cnblogs Post date: 2010-07-26 21:34 现在做web开发肯定离不开web服务器。知道各大网站用的都是什么服务器吗？","text":"cnblogs Post date: 2010-07-26 21:34 现在做web开发肯定离不开web服务器。知道各大网站用的都是什么服务器吗？ 今天我就怀着这样一个好奇心写了个搜索web服务器类型的工具，具体代码就不贴了。程序和代码在这里 主要思路是： 向一个网站发送HTTP请求，收到HTTP回复后检测其头部Server的值。 为了实现批量获取，还需要指定一系列网站的URL。 为了偷懒，我就从一个网页开始遍历其中所有的网址，然后获取其服务器类型。 光有数据还不行，还要对数据进行分析。我的策略是只分析服务器大的种类，具体版本就忽略了，这样就可以使用linq进行按服务器类型分组、排序等待 运行结果： 从www.hao123.com开始搜索，前三个用的最多的服务器是Apache(38.64%),nginx(21.36%),Microsoft IIS(17.27%). 然后还可以发现：Apache真的还有很多人用；尽管微软的IIS都有7.5的了，但6.0的IIS依旧还有很多在用。 下面是搜索到的服务器： chexian.pingan.com: wenku.baidu.com:lighttpd www.hao123.com:lighttpd hi.baidu.com:apache 1.1.26.0 www.baidu.com:BWS/1.0 top.baidu.com:Apache dict.baidu.com:Apache www.ifeng.com:DnionOS/1.0 www.sohu.com:Apache www.cntv.cn:Apache www.hunantv.com:nginx/0.6.35 www.gov.cn:Apache www.people.com.cn:nginx www.kaixin001.com:Apache baike.baidu.com:Apache www.google.com.hk:gws utility.hao123.com:Apache www.zhcw.com:Apache/2.0.63 (Unix) DAV/2 www.sina.com.cn:Apache/2.0.63 (Unix) www.163.com:nginx www.youku.com:bjwww www.autohome.com.cn:Microsoft-IIS/6.0 www.renren.com:nginx/0.7.64 www.xinhuanet.com:Apache www.eastmoney.com:nginx/0.8.36 www.51seer.com:WS CDN Server www.ctrip.com:Microsoft-IIS/6.0 youa.baidu.com:Apache www.58.com:Microsoft-IIS/6.0 www.rayli.com.cn:Apache www.ganji.com:nginx/0.7.62 www.zhaopin.com:Apache/1.3.29 (Unix) mod_webapp/1.2.0-dev www.anjuke.com:nginx www.icbc.com.cn:Microsoft-IIS/6.0 10086.cn:Apache house.sina.com.cn:Apache/2.0.63 (Unix) www.pconline.com.cn:DnionOS/1.0 www.zol.com.cn:Apache www.qq.com:nginx/0.6.39 www.chinahr.com:Microsoft-IIS/6.0 tl.changyou.com:Apache www.bitauto.com:Microsoft-IIS/6.0 www.qunar.com:nginx/0.7.64 www.lafaso.com:nginx/0.7.61 www.justonline.cn:Apache/2.2.15 (Win32) PHP/5.2.8 www.moonbasa.com:DnionOS/1.0 union.360buy.com:jdws www.baihe.com:Apache/2.0.59 (Unix) huangguan.yijia.com:nginx/0.8.34 www.taobao.com:Apache www.s.cn:nginx/51086858 video.sina.com.cn:nginx/0.5.35 www.lashou.com:Apache/2.2.15 (Unix) mod_ssl/2.2.15 OpenSSL/0.9.8e-fips-rhel5 PHP/5.3.2 DAV/2 www.qiyi.com:nginx www.letv.com:nginx/0.7.65 jipiao.kuxun.cn:lighttpd www.letao.com:Microsoft-IIS/6.0 www.m1905.com:nginx/0.7.61 www.elong.com:Microsoft-IIS/6.0 www.mbaobao.com: www.funshion.com:lighttpd/1.4.22 www.17173.com:Apache tv.sohu.com:Apache www.4399.com:Microsoft-IIS/6.0 www.7k7k.com:Microsoft-IIS/6.0 my.91.com:Apache/2.2.6 (Unix) zt.ztgame.com:DnionOS/1.0 news.sina.com.cn:Apache/2.0.63 (Unix) dhsh.changyou.com:Apache news.qq.com:nginx/0.6.39 military.china.com:nginx/0.7.63 mil.news.sina.com.cn:Apache/2.0.63 (Unix) www.shumenol.com: war.news.163.com:nginx news.ifeng.com:DnionOS/1.0 news.sohu.com:Apache/1.3.37 (Unix) mod_gzip/1.3.26.1a www.china.com.cn:Sun-ONE-Web-Server/6.1 www.warcraftchina.com:Apache www.tiexue.net:Microsoft-IIS/6.0 www.mod.gov.cn:Apache han.70yx.com:Microsoft-IIS/6.0 pv.7fgame.com:Microsoft-IIS/6.0 www.amazon.cn:Server www.qq163.com:Microsoft-IIS/6.0 www.5173.com:Microsoft-IIS/6.0 www.1ting.com: kok3.ztgame.com:DnionOS/1.0 mail.cn.yahoo.com: www.aiting.com:Microsoft-IIS/6.0 www.kuwo.cn:nginx/0.6.34 mail.qq.com:TWS www.qidian.com:Microsoft-IIS/6.0 mp3.baidu.com:apache 1.6.14.0 www.xxsy.net:Microsoft-IIS/6.0 mail.sina.com.cn:Apache/2.2.9 (FreeBSD) mod_ssl/2.2.9 OpenSSL/0.9.7e-p1 PHP/5.2.6 with Suhosin-Patch home.woool.sdo.com:SNDA CDN Cache Server act.dn.sdo.com:SNDA CDN Cache Server www.readnovel.com: www.jiayuan.com:nginx email.163.com:Apache www.126.com:Apache www.xs8.cn: www.51mole.com:nginx/CHINACACHE hua.61.com:nginx/CHINACACHE www.91wan.com:lighttpd/1.4.26 www.265g.com:Microsoft-IIS/6.0 www.jjwxc.net:Apache www.3366.com:lighttpd/1.4.20 xiaoyou.qq.com:Apache www.mop.com:dx136 finance.sina.com.cn:Apache 17roco.com:Apache r.dangdang.com:nginx/0.6.37 finance.qq.com:nginx/0.6.39 www.hotmail.com:Microsoft-IIS/6.0 www.jrj.com.cn: www.zhenai.com:Apache business.sohu.com:SWS www.pcpop.com:Microsoft-IIS/6.0 www.stockstar.com:nginx/0.7.59 www.tianya.cn:Microsoft-IIS/6.0 www.marry5.com:Apache tieba.baidu.com:apache 2.7.18.0 www.onlinedown.net:Microsoft-IIS/6.0 www.skycn.com:Apache www.cmbchina.com: blog.sina.com.cn:nginx/0.7.62 www.51.com:Apache blog.163.com:nginx blog.sohu.com:nginx www.abchina.com:Microsoft-IIS/7.5,M2 www.ccb.com:Apache sports.sina.com.cn:Apache t.sina.com.cn:Apache sports.sohu.com:SWS qzone.qq.com:Apache sports.qq.com:nginx/0.6.39 nba.tom.com:nginx/0.6.32 sports.tom.com:Apache tech.sina.com.cn:Apache www.hoopchina.com:[SA: xifan hcw/web-12-10-53 chexian.pingan.com wenku.baidu.com lighttpd www.hao123.com lighttpd hi.baidu.com apache 1.1.26.0 www.baidu.com BWS/1.0 top.baidu.com Apache dict.baidu.com Apache www.ifeng.com DnionOS/1.0 www.sohu.com Apache www.cntv.cn Apache www.hunantv.com nginx/0.6.35 www.gov.cn Apache www.people.com.cn nginx www.kaixin001.com Apache baike.baidu.com Apache www.google.com.hk gws utility.hao123.com Apache www.zhcw.com Apache/2.0.63 (Unix) DAV/2 www.sina.com.cn Apache/2.0.63 (Unix) www.163.com nginx www.youku.com bjwww www.autohome.com.cn Microsoft-IIS/6.0 www.renren.com nginx/0.7.64 www.xinhuanet.com Apache www.eastmoney.com nginx/0.8.36 www.51seer.com WS CDN Server www.ctrip.com Microsoft-IIS/6.0 youa.baidu.com Apache www.58.com Microsoft-IIS/6.0 www.rayli.com.cn Apache www.ganji.com nginx/0.7.62 www.zhaopin.com Apache/1.3.29 (Unix) mod\\_webapp/1.2.0-dev www.anjuke.com nginx www.icbc.com.cn Microsoft-IIS/6.0 10086.cn Apache house.sina.com.cn Apache/2.0.63 (Unix) www.pconline.com.cn DnionOS/1.0 www.zol.com.cn Apache www.qq.com nginx/0.6.39 www.chinahr.com Microsoft-IIS/6.0 tl.changyou.com Apache www.bitauto.com Microsoft-IIS/6.0 www.qunar.com nginx/0.7.64 www.lafaso.com nginx/0.7.61 www.justonline.cn Apache/2.2.15 (Win32) PHP/5.2.8 www.moonbasa.com DnionOS/1.0 union.360buy.com jdws www.baihe.com Apache/2.0.59 (Unix) huangguan.yijia.com nginx/0.8.34 www.taobao.com Apache www.s.cn nginx/51086858 video.sina.com.cn nginx/0.5.35 www.lashou.com Apache/2.2.15 (Unix) mod\\_ssl/2.2.15 OpenSSL/0.9.8e-fips-rhel5 PHP/5.3.2 DAV/2 www.qiyi.com nginx www.letv.com nginx/0.7.65 jipiao.kuxun.cn lighttpd www.letao.com Microsoft-IIS/6.0 www.m1905.com nginx/0.7.61 www.elong.com Microsoft-IIS/6.0 www.mbaobao.com www.funshion.com lighttpd/1.4.22 www.17173.com Apache tv.sohu.com Apache www.4399.com Microsoft-IIS/6.0 www.7k7k.com Microsoft-IIS/6.0 my.91.com Apache/2.2.6 (Unix) zt.ztgame.com DnionOS/1.0 news.sina.com.cn Apache/2.0.63 (Unix) dhsh.changyou.com Apache news.qq.com nginx/0.6.39 military.china.com nginx/0.7.63 mil.news.sina.com.cn Apache/2.0.63 (Unix) www.shumenol.com war.news.163.com nginx news.ifeng.com DnionOS/1.0 news.sohu.com Apache/1.3.37 (Unix) mod\\_gzip/1.3.26.1a www.china.com.cn Sun-ONE-Web-Server/6.1 www.warcraftchina.com Apache www.tiexue.net Microsoft-IIS/6.0 www.mod.gov.cn Apache han.70yx.com Microsoft-IIS/6.0 pv.7fgame.com Microsoft-IIS/6.0 www.amazon.cn Server www.qq163.com Microsoft-IIS/6.0 www.5173.com Microsoft-IIS/6.0 www.1ting.com kok3.ztgame.com DnionOS/1.0 mail.cn.yahoo.com www.aiting.com Microsoft-IIS/6.0 www.kuwo.cn nginx/0.6.34 mail.qq.com TWS www.qidian.com Microsoft-IIS/6.0 mp3.baidu.com apache 1.6.14.0 www.xxsy.net Microsoft-IIS/6.0 mail.sina.com.cn Apache/2.2.9 (FreeBSD) mod\\_ssl/2.2.9 OpenSSL/0.9.7e-p1 PHP/5.2.6 with Suhosin-Patch home.woool.sdo.com SNDA CDN Cache Server act.dn.sdo.com SNDA CDN Cache Server www.readnovel.com www.jiayuan.com nginx email.163.com Apache www.126.com Apache www.xs8.cn www.51mole.com nginx/CHINACACHE hua.61.com nginx/CHINACACHE www.91wan.com lighttpd/1.4.26 www.265g.com Microsoft-IIS/6.0 www.jjwxc.net Apache www.3366.com lighttpd/1.4.20 xiaoyou.qq.com Apache www.mop.com dx136 finance.sina.com.cn Apache 17roco.com Apache r.dangdang.com nginx/0.6.37 finance.qq.com nginx/0.6.39 www.hotmail.com Microsoft-IIS/6.0 www.jrj.com.cn www.zhenai.com Apache business.sohu.com SWS www.pcpop.com Microsoft-IIS/6.0 www.stockstar.com nginx/0.7.59 www.tianya.cn Microsoft-IIS/6.0 www.marry5.com Apache tieba.baidu.com apache 2.7.18.0 www.onlinedown.net Microsoft-IIS/6.0 www.skycn.com Apache www.cmbchina.com blog.sina.com.cn nginx/0.7.62 www.51.com Apache blog.163.com nginx blog.sohu.com nginx www.abchina.com Microsoft-IIS/7.5,M2 www.ccb.com Apache sports.sina.com.cn Apache t.sina.com.cn Apache sports.sohu.com SWS qzone.qq.com Apache sports.qq.com nginx/0.6.39 nba.tom.com nginx/0.6.32 sports.tom.com Apache tech.sina.com.cn Apache www.hoopchina.com [SA: xifan hcw/web-12-10-53 程序和代码在这里","categories":[{"name":"Web Server","slug":"Web-Server","permalink":"http://www.clarencep.com/categories/Web-Server/"}],"tags":[{"name":"Web Server","slug":"Web-Server","permalink":"http://www.clarencep.com/tags/Web-Server/"}]},{"title":"JSON小记","slug":"p_2010_07_26_json_note_1","date":"2010-07-26T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/07/26/p_2010_07_26_json_note_1/","link":"","permalink":"http://www.clarencep.com/2010/07/26/p_2010_07_26_json_note_1/","excerpt":"cnblogs Post date: 2010-07-26 13:27 首先，JSON是什么？JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式…… 详见 http://www.json.org/json-zh.html","text":"cnblogs Post date: 2010-07-26 13:27 首先，JSON是什么？JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式…… 详见 http://www.json.org/json-zh.html JSON的语法JSON的语法很简单，有五大要素，即object, array, value, string, number. 使用起来很简单很方便。 解析JSONJSON的解析器很多，比如C#的就有 JSONSharpLitJSONJSON for .NET等等 不过，在使用中发现，JSON的语法似乎并没有被很多解析器严格遵循，比如org.json对待JSON中string解析得并不是很严格，如果一个string中间没有歧义字符，则可以省略双引号的。这可能和javascript的写法有关系吧。 C# 4.0中使用JSON我用的是这个解析器，它很小巧，用起来很方便： string input = @&quot;{ &quot;&quot;date&quot;&quot;: { &quot;&quot;year&quot;&quot; : 2010, &quot;&quot;month&quot;&quot; : 7, &quot;&quot;day&quot;&quot; : 26 }, &quot;&quot;note&quot;&quot; : &quot;&quot;test json&quot;&quot; }&quot;; dynamic json = JSON.JsonHydrate(input); Console.WriteLine( &quot;date: {0}-{1}-{2}\\n&quot;+ &quot;note: {3}&quot;, json.date.year, json.date.month, json.date.day, json.note ); 不过这个解析器很严格的，不能省略双引号。 也许自己可以慢慢写个JSON解析器，代码量也不是很多，顺便还可以复习下编译原理…… 测试程序在这里（含代码）","categories":[{"name":"JSON","slug":"JSON","permalink":"http://www.clarencep.com/categories/JSON/"}],"tags":[{"name":"JSON","slug":"JSON","permalink":"http://www.clarencep.com/tags/JSON/"}]},{"title":"使用Transaction来使hibernate的缓存刷新","slug":"p_2010_07_23_1783734","date":"2010-07-23T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/07/23/p_2010_07_23_1783734/","link":"","permalink":"http://www.clarencep.com/2010/07/23/p_2010_07_23_1783734/","excerpt":"cnblogs Post date: 2010-07-23 14:57 今天遇到个问题： 使用hibernate的数据做的一个页面在数据库数据改变之后还不能及时刷新，在浏览器中强制刷新也没有用。 到百度谷歌搜到的方法大多是禁用缓存之类的——没有效果","text":"cnblogs Post date: 2010-07-23 14:57 今天遇到个问题： 使用hibernate的数据做的一个页面在数据库数据改变之后还不能及时刷新，在浏览器中强制刷新也没有用。 到百度谷歌搜到的方法大多是禁用缓存之类的——没有效果 最终发现： 使用Transaction可以使hibernate的缓存刷新 //session is a hibernate session session.beginTransaction().commit(); 原因： 应该是hibernate在提交一个Transaction时就会认为缓存已经脏了，就会刷新缓存了","categories":[{"name":"Java","slug":"Java","permalink":"http://www.clarencep.com/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://www.clarencep.com/tags/Java/"},{"name":"hibernate","slug":"hibernate","permalink":"http://www.clarencep.com/tags/hibernate/"}]},{"title":"很好的Opera","slug":"p_2010_07_18_1780101","date":"2010-07-18T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/07/18/p_2010_07_18_1780101/","link":"","permalink":"http://www.clarencep.com/2010/07/18/p_2010_07_18_1780101/","excerpt":"cnblogs Post date: 2010-07-18 13:28 最近喜欢上Opera","text":"cnblogs Post date: 2010-07-18 13:28 最近喜欢上Opera 我用的是Opera 10.60中文版，界面如下图： 最快的浏览器Opera称作是最快的浏览器。不过对于这个速度快，我倒是没什么感觉。 无假死不过相对于IE而言，Opera不存在IE中常见的假死现象——这一点是用起来很舒服的。 Opera LinkOpera有个功能叫Opera Link，用来将本地的资料与服务器同步： 这个功能很强大，至少重装系统后不用担心收藏夹丢失了。 腾讯TT也有个类似的功能： 可惜TT是基于IE内核的，老是会有浏览器假死的。 标签缩略图Opera还可以直接显示标签页的缩略图 不过这个功能对我显得有些鸡肋——我的屏幕分辨率很低的，显示的缩略图太占空间了。 还好的是鼠标浮上去也会显示缩略图： Opera Dragonfly对于我们Web开发人员而言，浏览器中的开发者工具是很重要的。 Opera Dragonfly是Opera内置的开发者工具，使用它我们可以很方便地分析一个网页的架构： 上图这个DOM分析器可以高亮选中的元素，还可以对该元素的样式进行分析…… Opera Dragonfly还内置了一个网络分析器： 原始请求和响应的头部都可以看到的： 如上图，我们还可以看到百度使用的PHP服务器是BWS/1.0，发送的页面是gzip压缩后的…… WidgetOpera的Widget也很多，如有个Widget名叫Ruler可用来测量屏幕： ……","categories":[{"name":"Browser","slug":"Browser","permalink":"http://www.clarencep.com/categories/Browser/"}],"tags":[{"name":"Opera","slug":"Opera","permalink":"http://www.clarencep.com/tags/Opera/"},{"name":"Browser","slug":"Browser","permalink":"http://www.clarencep.com/tags/Browser/"}]},{"title":"让你的WinForm不会在ALT+TAB中出现","slug":"p_2010_07_11_1775108","date":"2010-07-11T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/07/11/p_2010_07_11_1775108/","link":"","permalink":"http://www.clarencep.com/2010/07/11/p_2010_07_11_1775108/","excerpt":"cnblogs Post date: 2010-07-11 09:41 问题是这样的： 我有个程序有个置顶的小提示窗口。然后，在使用ALT+TAB切换窗口时老是会不小心切换到这个提示窗口（和我的本意不符合的），很烦人。","text":"cnblogs Post date: 2010-07-11 09:41 问题是这样的： 我有个程序有个置顶的小提示窗口。然后，在使用ALT+TAB切换窗口时老是会不小心切换到这个提示窗口（和我的本意不符合的），很烦人。 如何解决： 也就是说：如何让WinForm不会在ALT+TAB中出现？ 学过Win32窗口编程的都知道：Windows窗口的显示样式主要由创建窗口（CreateWindowEx）时dwExStyle和dwStyle两种样式决定。（WinForm最终还是用API创建窗口的） 其中，dwExStyle中WS_EX_TOOLWINDOW正是我们需要的样式，它表示工具窗口，是不会在ALT+TAB中显示的。 如何更改dwExStyle样式呢？ 首先想到的是改变CreateWindowEx中的dwExStyle参数。具体而言，WinForm中有个属性CreateParams可以更改： CreateParams.ExStyle = CreateParams.ExStyle | Win32Native.WS_EX_TOOLWINDOW; 似乎，这条语句应该在WinForm创建前执行，但是有个问题是WinForm相关联的句柄创建的很早，即使你把这一句放到构造函数的最开始部分，结果也不能更改窗体样式。 还有没有其他办法呢？那只能在WinForm窗体创建后更改dwExStyle样式了。还好，API中有Get/SetWindowLong函数可以用来对已创建的窗口的相关信息进行更改。具体做法如下： [DllImport(&quot;user32.dll&quot;)] public static extern Int32 GetWindowLong(IntPtr hwnd, Int32 index); [DllImport(&quot;user32.dll&quot;)] public static extern Int32 SetWindowLong(IntPtr hwnd, Int32 index, Int32 newValue); public const int GWL_EXSTYLE = (-20); public static void AddWindowExStyle(IntPtr hwnd,Int32 val) { int oldValue = GetWindowLong(hwnd,GWL_EXSTYLE); if (oldValue == 0) { throw new System.ComponentModel.Win32Exception(); } if (0 == SetWindowLong(hwnd, GWL_EXSTYLE, oldValue | val)) { throw new System.ComponentModel.Win32Exception(); } } public static int WS_EX_TOOLWINDOW = 0x00000080; //我把这个过程封装下： public static void SetFormToolWindowStyle(System.Windows.Forms.Form form) { AddWindowExStyle(form.Handle, WS_EX_TOOLWINDOW); } 如此这般，对一个WinForm调用SetFormToolWindowStyle就行了。 需要注意的是： WS_EX_TOOLWINDOW和WS_EX_APPWINDOW（对应WinForm中ShowInTaskBar）是会冲突的。 如果，这个窗口是APPWINDOW，那么还需要将ShowInTaskBar属性设为false.","categories":[{"name":"Windows","slug":"Windows","permalink":"http://www.clarencep.com/categories/Windows/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"Windows","slug":"Windows","permalink":"http://www.clarencep.com/tags/Windows/"},{"name":"Win32","slug":"Win32","permalink":"http://www.clarencep.com/tags/Win32/"},{"name":"WinForm","slug":"WinForm","permalink":"http://www.clarencep.com/tags/WinForm/"}]},{"title":"【杂想】IT已死论","slug":"p_2010_06_20_1761226","date":"2010-06-20T00:00:00.000Z","updated":"2017-10-25T03:09:10.852Z","comments":true,"path":"2010/06/20/p_2010_06_20_1761226/","link":"","permalink":"http://www.clarencep.com/2010/06/20/p_2010_06_20_1761226/","excerpt":"cnblogs Post date: 2010-06-20 09:53 IT是从上个世界下半段开始迅猛发展的&quot;信息技术&quot;。当然，在我们国家，IT发展得相对晚一些。 &quot;IT已死&quot;是昨天晚上看到的一本书的论调，大致讲：","text":"cnblogs Post date: 2010-06-20 09:53 IT是从上个世界下半段开始迅猛发展的&quot;信息技术&quot;。当然，在我们国家，IT发展得相对晚一些。 &quot;IT已死&quot;是昨天晚上看到的一本书的论调，大致讲： IT泡沫 云计算等IT服务的兴起 这本书以爱迪生时代电网的发展历程对比IT的发展，根据同样是从各公司的私营到作为一种服务的营运（如我国的国家电网），最终得出IT也会变成电力这种最后可以由一个IT核电站提供服务，而我们普通人与一般的公司可以像用电一样只要连上网络就可以轻松方便地使用这些服务（计算与存储等）。 的确，很难去反驳书中的观点。 IT与电力，像书中说的一样，很相似，电力通过电网输送的是能源，而IT通过因特网传输的是数据。 IT与电力很大的不同是： IT的产品（如软件等）复制起来很容易，几乎是零成本。而IBM与微软等这种IT巨头就是靠着这种零成本的复制来牟取暴利。 IT的服务更容易，相对电力，进行模块化划分。因此，IT虽死，但应该很难出现向国家电网那样的全面垄断。IT服务的发展是会有很多IT公司分别提供一个相对专一领域的服务，如今天亚马逊提供的存储服务。 &quot;IT已死&quot;这个观点初听起来很震撼的（可能鄙人以前太狭隘了），不过看完这本书，发现并不是向表面上那个样子。IT行业现在，在各行各业中，冗余太多。（具体就不细说了，太明显了） IT服务的出现是必然的。而作为一种服务，自然是专而精的，进而占据该行业的大部分业务…… IT必然不会彻底死掉。&quot;百足之虫死而不僵&quot;。很多公司还是并不很放心把核心业务与数据托付给其他公司的（尤其是向国家政府与军队等）。就像现在很多公司会备有备用发电机一样，IT服务必然不会占据全部的市场。 ……","categories":[{"name":"Thoughts","slug":"Thoughts","permalink":"http://www.clarencep.com/categories/Thoughts/"}],"tags":[{"name":"IT","slug":"IT","permalink":"http://www.clarencep.com/tags/IT/"},{"name":"Thoughts","slug":"Thoughts","permalink":"http://www.clarencep.com/tags/Thoughts/"}]},{"title":"微软笔试小感","slug":"p_2010_05_29_1747205","date":"2010-05-29T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/29/p_2010_05_29_1747205/","link":"","permalink":"http://www.clarencep.com/2010/05/29/p_2010_05_29_1747205/","excerpt":"cnblogs Post date: 2010-05-29 21:46 今天下午参加了微软实习生的笔试，感觉很纠结…… 题目不是很难","text":"cnblogs Post date: 2010-05-29 21:46 今天下午参加了微软实习生的笔试，感觉很纠结…… 题目不是很难 客观题我是都有把握的 最后的编程题就郁闷了，一个类似迷宫的问题 怎么解决我也知道，而且有好几种方法 但是 关键太简单了点 不过 还要求设计测试用例——这是我所知甚少的地方 《软件工程》中也就提到了点软件测试的内容，要设计测试用例就不太好设计了，于是时间不够了 看来以后要再多了解些软件测试","categories":[{"name":"Interview","slug":"Interview","permalink":"http://www.clarencep.com/categories/Interview/"}],"tags":[{"name":"Microsoft","slug":"Microsoft","permalink":"http://www.clarencep.com/tags/Microsoft/"},{"name":"Interview","slug":"Interview","permalink":"http://www.clarencep.com/tags/Interview/"}]},{"title":"闲话VS家族中工程文件之组织生成篇","slug":"p_2010_05_29_1747258","date":"2010-05-29T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/29/p_2010_05_29_1747258/","link":"","permalink":"http://www.clarencep.com/2010/05/29/p_2010_05_29_1747258/","excerpt":"cnblogs Post date: 2010-05-29 23:52 前言：闲话，并不重要，之所以还要写，主要是对这方面感兴趣。 闲话，其实也很重要，平时也许不太关注这方面，当需要时就很重要了。","text":"cnblogs Post date: 2010-05-29 23:52 前言：闲话，并不重要，之所以还要写，主要是对这方面感兴趣。 闲话，其实也很重要，平时也许不太关注这方面，当需要时就很重要了。 起因：为什么还要写呢？ 前两天做一个VC6的小项目，需要添加一些已有的源文件，一般是选择【工程】|【添加到工程】|【文件】再选择文件等，就OK了，但我的VC6却弹出了如下的一个ERROR框： 无法直接添加到工程，该怎么办呢？ 方法一有个方法是从【文件】|【新建】然后新建（并添加到工程）一个源文件，再把要添加的文件COPY&amp;PASTE到这个文件中。有效，但有些麻烦，特别是要添加到工程的文件不在当前目录下的时候，或者如果要添加的文件是要和另外一个工程共享的文件时就会遇到维护性问题等。 方法二我是很快想到，当使用VC6&quot;选择【工程】|【添加到工程】|【文件】等&quot;这个过程中VC6到底做了什么，如果能手工完成这个过程，不就能解决问题了吗？ 注意到VC6是使用工作空间(*.dsw)和工程(*.dsp)来组织管理一个项目的，一般VC6的一个项目使用一个&quot;工作空间&quot;来代表，其中又可以分为几个子项目（工程）并使用&quot;工程&quot;来代表。而dsw文件是工作空间文件，它是用来协调该工作空间内各个工程之间关系的。Dsp文件则就是对应工程的配置文件，工程中包含的文件、工程的编译方式等都在dsp文件中可以配置。 这样要添加一个文件到工程中，只要改一改dsp文件就可以了。 怎么改使用记事本打开dsp文件： 可以看到，dsp文件的格式和Makefile很相似。这样就不难理解其内容了（怎么理解的——一看就看懂了的，我就是直接看懂了，虽然我对Makefile也只是了解）。 如果添加源文件可以如下图这样添加： 这样就添加了.\\Sample2.cpp到该工程中了，然后就是保存，到VC6中更新下，就OK了。 说明：VS系列的IDE管理项目（这里单指应用程序项目，其他项目类似），最终的目的是要能编译（生成）该项目为一个相应的目标文件（.exe,.dll,.lib等）。这个生成过程： 如图可以看到，一般是先编译，后链接，相应地，这个过程是由cl.exe和link.exe等来完成的。VS这样的IDE有一个很主要的功能就是配置好这些工具的参数（命令行）等，然后再在我们点击编译（生成）时运行这些工具而已（当然还有其他行为，如保存文件）。如VS2008中VC项目的属性中就明确有其命令行配置结果： 如果熟悉这些命令行工具，使用VS这样的IDE，使用这样的属性页真的很方便。 为什么使用IDE？上面的话也引出一个新的问题，为什么使用IDE，既然命令行工具这么直接和方便，IDE也就是对命令行工具进行了封装而已？ 答案就在于这个&quot;封装&quot;。有了这个封装我们就不要再输那么长的命令行了，不要老是对着黑底白字的控制台敲命令的，只要点点鼠标就OK了…… 当然，命令行也不一定完全就是那么地不堪，使用Makefile来组织一个工程是也很方便的（不过总会有人对命令行情有独钟，也有人对GUI情有独钟）。","categories":[{"name":"Visual Studio","slug":"Visual-Studio","permalink":"http://www.clarencep.com/categories/Visual-Studio/"}],"tags":[{"name":"Visual Studio","slug":"Visual-Studio","permalink":"http://www.clarencep.com/tags/Visual-Studio/"}]},{"title":"C#动态地调用Win32 DLL中导出的函数","slug":"p_2010_05_25_CSharp_dynamic_invoke_native_dll_function_exported","date":"2010-05-25T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/25/p_2010_05_25_CSharp_dynamic_invoke_native_dll_function_exported/","link":"","permalink":"http://www.clarencep.com/2010/05/25/p_2010_05_25_CSharp_dynamic_invoke_native_dll_function_exported/","excerpt":"cnblogs Post date: 2010-05-25 20:17 关于这种C#中调用Win32 DLL中导出的函数的方法有很多种了，本文做个小结。","text":"cnblogs Post date: 2010-05-25 20:17 关于这种C#中调用Win32 DLL中导出的函数的方法有很多种了，本文做个小结。 大致有两种情况： 编译时已知DLL文件名和函数名 运行时才能获知DLL文件名（函数名） 编译时已知DLL文件名这种情况下可以简单的使用Pinvoke机制，使用DllImport如： [System.Runtime.InteropServices.DllImport(&quot;kernel32.dll&quot;)] public static extern bool Beep(uint freq,uint time); 运行时才能获知DLL文件名有两种解决方案： 首先，可以想到使用Win32 API中LoadLibrary和GetProcAddress，象在C/C++中一样来动态调用DLL中函数，这里就不细说了； 其次，考虑如何才能动态使用DllImport, 很容易想到使用.Net中的反射（Reflection&amp;Emit）来动态生成一个Pinvoke函数，如下例： 代码 /// &lt;summary&gt; /// 获取DLL中函数 /// &lt;/summary&gt; /// &lt;param name=&quot;dllName&quot;&gt;DLL文件的名字（路径），如果在PATH环境变量下或当期目录中则可以直接指定DLL的名字，否则应包括其路径信息&lt;/param&gt; /// &lt;param name=&quot;methodName&quot;&gt;函数名字&lt;/param&gt; /// &lt;param name=&quot;returnType&quot;&gt;返回类型&lt;/param&gt; /// &lt;param name=&quot;paramTypes&quot;&gt;参数类型，如果无参数则为null&lt;/param&gt; /// &lt;param name=&quot;declareCallingConvertions&quot;&gt;生成的函数的调用约定&lt;/param&gt; /// &lt;param name=&quot;nativeCallingConvertions&quot;&gt;DLL函数的调用约定&lt;/param&gt; /// &lt;param name=&quot;nativeCharSet&quot;&gt;字符集&lt;/param&gt; /// &lt;returns&gt;代表指定DLL中指定函数的MethodInfo,是一个静态方法&lt;/returns&gt; public static MethodInfo GetMethodInfoInDll(string dllName, string methodName, Type returnType, Type[] paramTypes, CallingConventions declareCallingConvertions, System.Runtime.InteropServices.CallingConvention nativeCallingConvertions, System.Runtime.InteropServices.CharSet nativeCharSet) { AssemblyName assemblyName=new AssemblyName(&quot;Assembly&quot;+Environment.TickCount); AssemblyBuilder assemblyBuilder = AppDomain.CurrentDomain.DefineDynamicAssembly( assemblyName, AssemblyBuilderAccess.Run); ModuleBuilder moduleBuilder = assemblyBuilder.DefineDynamicModule(assemblyName.Name); MethodInfo method = moduleBuilder.DefinePInvokeMethod(methodName, dllName, MethodAttributes.PinvokeImpl | MethodAttributes.Static | MethodAttributes.Public, declareCallingConvertions, returnType, paramTypes, nativeCallingConvertions, nativeCharSet); moduleBuilder.CreateGlobalFunctions(); MethodInfo methodInfo = moduleBuilder.GetMethod(methodName,paramTypes); return methodInfo; } 当然，适应于第二中情况的解决方案也适应于第一中情况。","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"Win32","slug":"Win32","permalink":"http://www.clarencep.com/tags/Win32/"},{"name":".Net","slug":"Net","permalink":"http://www.clarencep.com/tags/Net/"},{"name":"DLL","slug":"DLL","permalink":"http://www.clarencep.com/tags/DLL/"}]},{"title":"Debug和Trace使用小记","slug":"p_2010_05_19_about_debug_trace_in_dotNet","date":"2010-05-19T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/19/p_2010_05_19_about_debug_trace_in_dotNet/","link":"","permalink":"http://www.clarencep.com/2010/05/19/p_2010_05_19_about_debug_trace_in_dotNet/","excerpt":"cnblogs Post date: 2010-05-19 14:49 Debug和Trace?Debug和Trace这里指.Net中System.Diagnostics（System程序集）中的Debug和Trace工具类。","text":"cnblogs Post date: 2010-05-19 14:49 Debug和Trace?Debug和Trace这里指.Net中System.Diagnostics（System程序集）中的Debug和Trace工具类。 如何使用？Debug和Trace两个类都有很多静态方法和属性可以使用，并且Debug和Trace大部分方法都不仅名称一样，用法也很相似。 如： Write系列和WriteLine系列方法，同TextWriter中一样，是用作输出的。要注意的是Debug中有个Print方法，它和WriteLine的功能是一样的，而不是和Write一样。WriteIf系列函数只是加了个 判断。 Indent/Unindent这样个方法和IndentLevel, IndentSize这两个属性，它们是控制缩进的。 AutoFlush属性是控制刷新的，为true是每次调用Write都会刷新。 Listeners属性，类型是TracerListenersCollection, 可以通过这个属性来添加Debug/Trace输出的监听者。 Fail方法，指示出错信息。一般会弹出一个错误对话框： 关于TraceTrace翻译为跟踪，Trace类一般是用于跟踪应用程序的相关信息。Trace类中也有TraceInformation/TraceWarning/TraceError这样的方法，分别用于输出不同程度的跟踪信息。 Debug算是Trace的一种特殊应用吧——专用于DEBUG版的Trace. 关于TraceListenerTraceListener是一个抽象类，用于监听输出的跟踪信息，一般可以用它的子类，如: DefaultTracerListener, 一般会使用kernel32.dll中的OutputDebugString来输出； TextWriterTracerListener, 输出到给定的Stream或TextWriter或文件； EventLogTracerListener, 输出到日志（EventLog）； 还有其他如WebPageTraceListener等，当然也可以自己实现一个TraceListener. 关于Trace.Listeners/Debug.Listeners操作这Debug类的Listeners属性和Trace类的Listeners属性，实际上效果是一样的。就实现而言，它们都是简单的对TraceInternal.Listeners封装了一下，实现代码用reflector查看为： public static TraceListenerCollection Listeners { get { return TraceInternal.Listeners; } } 关于Debug/Trace的效率Debug和Trace所有的公有方法都有[Conditional(&quot;DEBUG&quot;)]或[Conditional(&quot;TRACE&quot;)]属性（Attribute），所以只要编译时不定义DEBUG/TRACE宏，Debug/Trace的相应方法都不会被调用。 VS中默认配置中Debug配置下定义了DEBUG和TRACE，Release配置下定义了TRACE。 在调试时VS会自动添加一个TraceListener，输出到输出窗口（Output）: 测试代码下载(TestDebugTrace.rar)","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"debug","slug":"debug","permalink":"http://www.clarencep.com/tags/debug/"},{"name":"trace","slug":"trace","permalink":"http://www.clarencep.com/tags/trace/"},{"name":".Net","slug":"Net","permalink":"http://www.clarencep.com/tags/Net/"}]},{"title":"Debug和Trace配置小记","slug":"p_2010_05_19_1739392","date":"2010-05-19T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/19/p_2010_05_19_1739392/","link":"","permalink":"http://www.clarencep.com/2010/05/19/p_2010_05_19_1739392/","excerpt":"cnblogs Post date: 2010-05-19 17:09 使用配置文件(.config)可以轻松地配置程序，并且不用再次编译程序。","text":"cnblogs Post date: 2010-05-19 17:09 使用配置文件(.config)可以轻松地配置程序，并且不用再次编译程序。 在.Net配置文件(.config)中像Debug/Trace这样的调试/追踪信息在一节(父元素Configuration)中。 在&lt;system.diagnostics&gt;可以配置的子项有： &lt;assert&gt;元素，控制断言失败后是否显示对话框（assertuienabled属性opt），还可以指定一个日志文件（logfilename属性opt）； &lt;performanceCounters&gt;元素，控制性能计数器共享的全局内存大小（fileMappingSize属性req）； &lt;trace&gt;元素，对应System.Diagnostics.Trace，autoflush对应Trace.AutoFlush, indentsize对应Trace.IndentSize, useGlobalLock对应Trace.UseGlobalLock, 还可以有子元素&lt;listeners&gt;对应Trace.Listeners. &lt;listeners&gt;可以有添加、删除和清空的操作（子元素）: &lt;add type=&quot;typeName-required&quot; initializeData=&quot;data-optional&quot; name=&quot;listenerName-optional&quot; /&gt;, 其中type属性的值必须是完整类型名，或是完全限定了程序集的完全类型名，initializeData是传给type的构造函数的。TraceListener可以有TraceFilter, 这里是为&lt;add&gt;的子项&lt;filter&gt;: &lt;filter type=&quot;typeName-required&quot; initializeData=&quot;data-optional&quot; /&gt;, type和initializeData同上。 &lt;remove name=&quot;listenerName-required&quot; /&gt;, 这里name是添加TraceListener时指定的name。 , 空元素。 &lt;sources&gt;元素，用于配置程序中的TraceSource的实例，其子项为&lt;source&gt;： &lt;source name=&quot;sourceName-optional&quot; switchName=&quot;switchName-optional&quot; switchType=&quot;switchType-optional&quot; extraAttribute=&quot;attibutes&quot;&gt;, 值得注意的是，这里switchName可以在&lt;switches&gt;中定义，如果无定义则取switchName为TraceSource构造函数中的defaultLevel。这里的&lt;source&gt;也可以像&lt;trace&gt;一样拥有&lt;listeners&gt;。 &lt;sharedListeners&gt;元素，用于在&lt;trace&gt;和&lt;sources&gt;等间共享TraceListener。如同&lt;trace&gt;中的&lt;listeners&gt;，&lt;sharedListeners&gt;也可以有&lt;add&gt;操作，但是没有&lt;remove&gt;和&lt;clear&gt;。 &lt;switches&gt;元素，对应System.Diagnostics.Switch的实例集合，可以有添加&lt;add&gt;操作： &lt;add name=&quot;switchName-required&quot; value=&quot;switchValue-required&quot;&gt;, 指定相应的Switch的值，name对应Switch构造函数中的displayName。如果是TraceSwitch，value可以指定为SourceLevel的成员的字符串名字。 实例： 配置文件为： &lt;configuration&gt; &lt;system.diagnostics&gt; &lt;trace autoflush=&quot;true&quot; indentsize=&quot;4&quot;&gt; &lt;listeners&gt; &lt;add name=&quot;consoleTraceListener&quot; type=&quot;System.Diagnostics.ConsoleTraceListener&quot; /&gt; &lt;!-- &lt;add name=&quot;console&quot;/&gt; --&gt; &lt;remove name=&quot;Default&quot;/&gt; &lt;/listeners&gt; &lt;/trace&gt; &lt;sources&gt; &lt;source name=&quot;testTraceSource&quot; switchName=&quot;sourceSwitch&quot; switchType=&quot;System.Diagnostics.SourceSwitch&quot;&gt; &lt;listeners&gt; &lt;add name=&quot;console&quot; /&gt; &lt;remove name=&quot;Default&quot; /&gt; &lt;/listeners&gt; &lt;/source&gt; &lt;/sources&gt; &lt;switches&gt; &lt;add name=&quot;sourceSwitch&quot; value =&quot;All&quot;/&gt; &lt;/switches&gt; &lt;sharedListeners&gt; &lt;add name=&quot;console&quot; type=&quot;System.Diagnostics.ConsoleTraceListener&quot; initializeData=&quot;false&quot; /&gt; &lt;/sharedListeners&gt; &lt;/system.diagnostics&gt; &lt;/configuration&gt; 分析配置文件： &lt;trace autoflush=&quot;true&quot; indentsize=&quot;4&quot;&gt; 对System.Diagnostics.Trace的AutoFlush和IndentSize分别进行设置。 &lt;add name=&quot;consoleTraceListener&quot; type=&quot;System.Diagnostics.ConsoleTraceListener&quot; /&gt; 添加一个TraceListener, 类型为System.Diagnostics.ConsoleTraceListener（输出到控制台），名为&quot;consoleTraceListener&quot;。 &lt;remove name=&quot;Default&quot;/&gt; 移除名为&quot;Default&quot;的TraceListener. &lt;source name=&quot;testTraceSource&quot; switchName=&quot;sourceSwitch&quot; switchType=&quot;System.Diagnostics.SourceSwitch&quot;&gt; 设置名为&quot;testTraceSource&quot;的SourceTrace的Switch 为 名为&quot;sourceSwitch&quot;的，类型为&quot;System.Diagnostics.SourceSwitch&quot;的Switch. &lt;add name=&quot;console&quot; /&gt; 向testTraceSource添加名为&quot;console&quot;的TraceListener. &lt;remove name=&quot;Default&quot; /&gt; 移除名为&quot;Default&quot;的TraceListener. &lt;add name=&quot;sourceSwitch&quot; value =&quot;All&quot;/&gt; 添加一个名为&quot;sourceSwitch&quot;，值(Level)为&quot;All&quot;的Switch. &lt;add name=&quot;console&quot; type=&quot;System.Diagnostics.ConsoleTraceListener&quot; initializeData=&quot;false&quot; /&gt; 添加一个名为&quot;console&quot;, 类型为&quot;System.Diagnostics.ConsoleTraceListener&quot;并初始化为false的TraceListener. 这样这个配置文件的目的其实和以下代码相同： //&lt;configuration&gt; //&lt;system.diagnostics&gt; // &lt;trace autoflush=&quot;true&quot; indentsize=&quot;4&quot;&gt; Trace.AutoFlush = true; Trace.IndentSize = 4; // &lt;listeners&gt; // &lt;add name=&quot;consoleTraceListener&quot; type=&quot;System.Diagnostics.ConsoleTraceListener&quot; /&gt; Trace.Listeners.Add(new ConsoleTraceListener() { Name = &quot;consoleTraceListener&quot; }); //&lt;!-- &lt;add name=&quot;console&quot;/&gt; --&gt; //&lt;remove name=&quot;Default&quot;/&gt; Trace.Listeners.Remove(&quot;Default&quot;); // &lt;/listeners&gt; // &lt;/trace&gt; // &lt;sources&gt; // &lt;source name=&quot;testTraceSource&quot; switchName=&quot;sourceSwitch&quot; // switchType=&quot;System.Diagnostics.SourceSwitch&quot;&gt; SourceSwitch sourceSwitch=new SourceSwitch(&quot;sourceSwitch&quot;); TraceSource ts = new TraceSource(&quot;testTraceSource&quot;) { Switch = sourceSwitch }; // &lt;listeners&gt; // &lt;add name=&quot;console&quot; /&gt; TraceListener console = new ConsoleTraceListener(false) { Name = &quot;console&quot; }; // &lt;add name=&quot;console&quot; type=&quot;System.Diagnostics.ConsoleTraceListener&quot; initializeData=&quot;false&quot; /&gt; ts.Listeners.Add(console); // &lt;remove name=&quot;Default&quot; /&gt; ts.Listeners.Remove(&quot;Default&quot;); // &lt;/listeners&gt; // &lt;/source&gt; // &lt;/sources&gt; // &lt;switches&gt; // &lt;add name=&quot;sourceSwitch&quot; value =&quot;All&quot;/&gt; sourceSwitch.Level = SourceLevels.All; // &lt;/switches&gt; // &lt;sharedListeners&gt; // &lt;add name=&quot;console&quot; type=&quot;System.Diagnostics.ConsoleTraceListener&quot; initializeData=&quot;false&quot; /&gt; //TraceListener console = new ConsoleTraceListener(false) { Name = &quot;console&quot; }; // 已°?经-提¬¨¢前¡ã执¡ä行D // &lt;/sharedListeners&gt; // &lt;/system.diagnostics&gt; //&lt;/configuration&gt; 不过，使用配置文件来对应用程序配置可以省得再次编译了。","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"debug","slug":"debug","permalink":"http://www.clarencep.com/tags/debug/"},{"name":"trace","slug":"trace","permalink":"http://www.clarencep.com/tags/trace/"},{"name":".Net","slug":"Net","permalink":"http://www.clarencep.com/tags/Net/"}]},{"title":"外包、构件和黑盒抽象等杂想","slug":"p_2010_05_12_1733642","date":"2010-05-12T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/12/p_2010_05_12_1733642/","link":"","permalink":"http://www.clarencep.com/2010/05/12/p_2010_05_12_1733642/","excerpt":"cnblogs Post date: 2010-05-12 13:42 外包是什么现在有很多人（和公司）在做外包，但我对外包是什么一直都不太清楚，于是百度一下，很多人在问这个问题。","text":"cnblogs Post date: 2010-05-12 13:42 外包是什么现在有很多人（和公司）在做外包，但我对外包是什么一直都不太清楚，于是百度一下，很多人在问这个问题。 据百度百科的解释： 外包是一个战略管理模型,所谓外包（Outsourcing），在讲究专业分工的二十世纪末，企业为维持组织竞争核心能力，且因组织人力不足的困境，可将组织的非核心业务委托给外部的专业公司，以降低营运成本，提高品质，集中人力资源，提高顾客满意度。 外包的范围按工作性质可分为&quot;蓝领外包&quot;和&quot;白领外包&quot;。&quot;蓝领外包&quot;指产品制造过程外包。&quot;白领外包&quot;亦称&quot;服务外包&quot;，指技术开发与支持其他服务活动的外包。其中技术开发与支持的外包一般采用一次性项目合同的方式寻求第三方专业公司的服务，称为&quot;合同外包&quot;；其他服务活动的外包多通过签定长期合同的方式交由专业外包提供商进行，称为&quot;职能外包&quot;。 相应而言，软件项目中的外包——&quot;软件外包&quot;： 所谓软件外包就是一些发达国家的软件公司将他们的一些非核心的软件项目通过外包的形式交给人力资源成本相对较低的国家的公司开发，以达到降低软件开发成本的目的。众所周知，软件开发的成本中70%是人力资源成本，所以，降低人力资源成本将有效地降低软件开发的成本。 然而&quot;外包&quot;这个名词有时容易和&quot;离岸外包&quot;相混淆： 外包和离岸外包经常被混用，但是外包主要是与组织的重组相关，而离岸外包更强调的是国家。当然，在当今全球化的前提下，这两个概念并不是互斥的。从根本和历史上讲，外包是一个有关在团体内和团体间对劳动力进行组织的术语。 这种解释很功利却很现实。 构件的争议&quot;构件&quot;、&quot;组件&quot;这两个词一直很令人费解。 在《构件化软件——超越面向对象编程》（Component Software: Beyond Object-Oriented Programming）一书中构件是指Component, 其定义为： 软件构件是一种组装单位，它具有规范的接口规约和显式的语境依赖。软件构件可以被独立地部署并由第三方任意地组装。 在《.Net 组件开发》（.NET Component-Oriented Programmlng）一书中组件就是指.Net中的Component。 由此可见&quot;组件&quot;和&quot;构件&quot;仅仅只是译法不同而已。 另外， &quot;构件&quot;（Component）不能和&quot;控件&quot;（Control）搞混淆了。控件一般是指可视化的可操作的GUI单元。控件是一个构件，就如同Control派生自Component一样。 黑盒测试与黑盒抽象黑盒测试时软件工程中一种测试方法。 黑盒测试是用来检测每个功能是否能正常使用，因此又称功能测试。之所以叫黑盒测试，是因为在测试中，把程序看作一个不能打开的黑盒子，在完全不考虑程序内部结构和内部特性的情况下，在程序接口进行测试，它只检查程序功能是否按照需求规格说明书的规定正常使用，程序是否能适当地接收输入数据而产生正确的输出信息。 从黑盒测试的模式来做设计有黑盒抽象和黑盒重用。 黑盒抽象的设计中，客户对接口和规约之外的实现细节一无所知。例如.Net 中的Thread类，我们不知道它是如何实现（虽然可能很好奇），但却可以直接创建它的实例来创建一个托管线程。相应的这个过程就叫黑盒重用，具体而言，要在重用时仅仅依赖接口和规约，不需要了解构件的实现细节。 与黑盒抽象相反的是白盒抽象，它来自白盒测试，要求客户了解实现细节。 相应的白盒重用就也是需要用户了解实现细节的。一个例子是MFC编程，在重用MFC类库来创建一个窗口时，一般要从CWnd或其子类来派生出一个新的子类，在新的子类中添加一些消息响应函数，重写父类的一些行为，这样达到自定义窗口的目的。一般而言白盒抽象中，在接口限制了用户行为并确保了封装性的情况下，客户仍然可以通过继承对构件的实现细节进行修改。当然为了修改实现细节，首先要对原构件的实现细节有一定的了解，这就是学MFC这样的类库学到深处总是需要研究其源代码的原因。 事实上，白盒重用中，被重用的构件不可以轻易被替换（升级），否则，有可能破坏正在重用的客户，因为这些客户端依赖于那些在未来可能发生改变的实现细节。 据了解，很多兼容性问题是由于白盒重用对实现细节的依赖引起的。 算是结语吧&quot;外包&quot;、&quot;构件&quot;和&quot;黑盒抽象&quot;是这两天学习的一个内容。 软件构件的思想很早（上世纪六七十年代）就提出了，但直到了这个世纪，真正的软件构件的才成功形成市场。很多公司对构件进行了探索，如微软的VBX, COM, COM+, OLE/ActiveX到现在的.Net构件技术，OMG的CORMA, CCM, OMA和MDA， SUN公司的Java, JavaBean, EJB等。 顺便说一句：然而在学校中，令人郁闷的是，学到的还是很古老（当然很经典的）面向过程式的软件工程分析设计，然后面向对象的分析和设计居然还只是选学（老师只是提了提），至于构件式的开发，则是根本没讲过。 很传统的开发方式——从头开始，只借助开发工具和平台函数库——有人叫&quot;定制软件&quot;，定制软件可能具有一定的潜在的优势，但目前来看定制软件却又很多明显的内在不足，如开发代价和滞后性等。 构件式的开发（多以外包的形式）则相对而言具有很大的优势，构件式能迅速适应变化的需求，良好的设计能给用户更多自由定制的空间。","categories":[{"name":"Project Management","slug":"Project-Management","permalink":"http://www.clarencep.com/categories/Project-Management/"}],"tags":[{"name":"Project Management","slug":"Project-Management","permalink":"http://www.clarencep.com/tags/Project-Management/"}]},{"title":"SharpSniffer--C#版Sniffer","slug":"p_2010_05_03_SharpSniffer","date":"2010-05-03T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/03/p_2010_05_03_SharpSniffer/","link":"","permalink":"http://www.clarencep.com/2010/05/03/p_2010_05_03_SharpSniffer/","excerpt":"cnblogs Post date: 2010-05-03 12:46 虽然网上已经有了SharpSniffer这一个SharpSniffer还是原创的无他，唯为学习","text":"cnblogs Post date: 2010-05-03 12:46 虽然网上已经有了SharpSniffer这一个SharpSniffer还是原创的无他，唯为学习 工程文件下载：SharpSniffer.rar 主要过程1、创建套接字2、绑定到本机3、设置IOControl4、接收数据5、处理（显示）数据 关键代码创建socket ，据MSDN，IOControlCode.ReceiveAll（后面要使用到）使用时有以下限制： ReceiveAll - 启用对网络上的所有 IPv4 数据包的接收。套接字必须有 InterNetwork地址族，套接字类型必须是 Raw，并且协议类型必须为 IP。当前用户必须属于本地计算机上的 Administrators 组，并且套接字必须绑定到特定端口。Windows 2000 及更高版本的操作系统支持此控制代码。此值等于 Winsock 2 SIO_RCVALL 常数。 Socket socket = new Socket(AddressFamily.InterNetwork, SocketType.Raw, ProtocolType.IP); //直接new一个 绑架到本机，只有绑定到本机才可以监听数据包： socket.Bind(new IPEndPoint(GetHostAdress(), 0)); 获取本机IP地址，从一个主机名可能解析到好几个地址，这要看你电脑的网络适配器的状态了，这里只取第一个： private static IPAddress GetHostAdress(){ string hostName=Dns.GetHostName(); var hostAddreses=Dns.GetHostAddresses(hostName); return hostAddreses[0]; } 很关键的一步，对IOControl进行设置。这里输入参数为1表示RCVALL_ON（启用接收所有包），当输入参数为0时表示RCVALL_OFF，具体定义在MSDN中WSAIoctl函数的Remark中说的很清楚： byte[] outValue = BitConverter.GetBytes(0); byte[] inValue = BitConverter.GetBytes(1); socket.IOControl(IOControlCode.ReceiveAll,inValue, outValue); //对IO设置为可以接受所有包 很关键的，接收数据： int recvedSize = socket.ReceiveFrom(buf, ref ep); //用ReceiveFrom接受数据 // socket.Receive(buf); //用Receive也能接受到数据，不过使用ReceiveFrom可以直接获取发送方IP地址 接下来要显示数据了，这里只是简单的把数据打印出来，如果想获取该数据包的更多信息则就需要按IP数据包的格式来解析包的内容了： string s = GetByteArrayHexString(buf, 0, recvedSize); //此函数把字节数组格式化，详细参考源代码PrintLine(s); 详细过程参考源代码本程序在WinXP sp3, VS2010, .Net Framework 4.0 Client &amp; .Net Framework 2.0下编译运行通过能成功抓包，如ping发出和收到的数据包能抓到，打开网页的数据包也能抓到。 不足之处暂时没有分析包的内容","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"sniffer","slug":"sniffer","permalink":"http://www.clarencep.com/tags/sniffer/"}]},{"title":"C++类型转换小记（一）——C++转换操作符","slug":"p_2010_05_03_Cpp_type_cast_note1","date":"2010-05-03T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/05/03/p_2010_05_03_Cpp_type_cast_note1/","link":"","permalink":"http://www.clarencep.com/2010/05/03/p_2010_05_03_Cpp_type_cast_note1/","excerpt":"cnblogs Post date: 2010-05-03 14:31 C++转换操作符ISO-C++中有四种转换操作符","text":"cnblogs Post date: 2010-05-03 14:31 C++转换操作符ISO-C++中有四种转换操作符 dynamic_cast: 在多态类型转换时使用，实现在运行时，并进行运行时检测，如果转换失败，返回值是NULLstatic_cast：与dynamic_cast相反，static_cast是在编译时转换类型的，故称为static_cast，它可以用在值类型转换中const_cast：一般用于去除const, volatile等修饰属性上.reinterpret_cast：这个很厉害，几乎可以在任意类型间转换，reinterpret的中文意思是重新解释 在Visual C++ 2005及以后版本中C++/clr又添加了一个新的转换safe_cast：用于在托管类型间进行转换，如果不成功会抛出InvalidCastException. 关于C风格的类型转换型如(type-name)value的转换是C风格的类型转换，这种转换对任意类型的都能使用。一般而言C风格的类型转换可以替代static_cast,const_cast,reinterpret_cast,safe_cast, 但是一般不能替代dynamic_cast。原因在于，C风格的类型转换是编译时的，对于C语言中各个不同的类型，编译成汇编代码时，这些类型信息会丢失掉，所剩下的是其长度和符号信息，而C风格的转换就是把这些长度和符号信息统一起来。 如对于两个指针间转换而言A* pa=(A*)pb，所生成的中间代码则会是 mov eax, [pb]; mov [pa],eax。而dynamic_cast则是会进行运行时检查，对于下行转换（从基类到子类）而言所生成的中间代码一定会调用一个函数名类似 ___RTDynamicCast的转换函数。static_cast,const_cast,reinterpret_cast所起的作用同C风格的类型转换，只是编译时对其类型约束不同而已。safe_cast是C++/Clr中新增的关键词（Microsoft Specific），对托管类型进行C风格类型转换时， 编译器会自动使用safe_cast进行转换，这一点估计是为了和C#风格一致。","categories":[{"name":"C++","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"Type Convertion","slug":"Type-Convertion","permalink":"http://www.clarencep.com/tags/Type-Convertion/"},{"name":"C++","slug":"C","permalink":"http://www.clarencep.com/tags/C/"}]},{"title":"WPF中图形呈现问题","slug":"p_2010_04_30_WPF_IMG_P1","date":"2010-04-30T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/04/30/p_2010_04_30_WPF_IMG_P1/","link":"","permalink":"http://www.clarencep.com/2010/04/30/p_2010_04_30_WPF_IMG_P1/","excerpt":"cnblogs Post date: 2010-04-30 23:47 之前WPF中花文字小感一文中提到的问题，现在又有了新的答案：","text":"cnblogs Post date: 2010-04-30 23:47 之前WPF中花文字小感一文中提到的问题，现在又有了新的答案： 那就是，其实这是WPF图形呈现层的问题，文字的绘制也是属于图形呈现层。 WPF的图形呈现有两种模型： XPDM：Microsoft Windows XP 显示驱动程序模型。 WDDM：Windows Vista 显示驱动程序模型。 对我的电脑（XP）的问题就在于，显卡太老，不支持一些硬件加速，为此需要关闭硬件加速： “HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Avalon.Graphics\\DisableHWAcceleration”这个注册表键就是控制禁用硬件加速选项的，类型为DWORD，值 1 表示禁用硬件加速，值0表示启用硬件加速。 禁用硬件加速后终于OK了","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"WPF","slug":"WPF","permalink":"http://www.clarencep.com/tags/WPF/"},{"name":"Windows","slug":"Windows","permalink":"http://www.clarencep.com/tags/Windows/"}]},{"title":"Windows Console Application 和 Win32 Application 的区别","slug":"p_2010_03_08_1681092","date":"2010-03-08T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/03/08/p_2010_03_08_1681092/","link":"","permalink":"http://www.clarencep.com/2010/03/08/p_2010_03_08_1681092/","excerpt":"cnblogs Post date: 2010-03-08 21:56 Windows Console Application 和 Win32 Application 的区别","text":"cnblogs Post date: 2010-03-08 21:56 Windows Console Application 和 Win32 Application 的区别 区别不是很大主要就一个Stdin和Stdout的定义和控制台窗口分配的区别Windows Console Application中调用FreeConsole()就没了控制台窗口想要弄个控制台窗口，可以调用AllocConsole()关于这两个函数请参见 ms-help://MS.MSDNQTR.v90.chs/dllproc/base/console_functions.htm","categories":[{"name":"Windows","slug":"Windows","permalink":"http://www.clarencep.com/categories/Windows/"}],"tags":[{"name":"Windows","slug":"Windows","permalink":"http://www.clarencep.com/tags/Windows/"},{"name":"Console Application","slug":"Console-Application","permalink":"http://www.clarencep.com/tags/Console-Application/"},{"name":"Win32","slug":"Win32","permalink":"http://www.clarencep.com/tags/Win32/"}]},{"title":"WPF中花文字小感","slug":"p_2010_01_27_wpf_text_nn_1","date":"2010-01-27T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/01/27/p_2010_01_27_wpf_text_nn_1/","link":"","permalink":"http://www.clarencep.com/2010/01/27/p_2010_01_27_wpf_text_nn_1/","excerpt":"cnblogs Post date: 2010-01-27 17:28 WPF是一个好东东 用它来设计界面很方便，只要是能想得到的界面，都能很轻松使用WPF设计出来（相比WIN FORM和MFC）","text":"cnblogs Post date: 2010-01-27 17:28 WPF是一个好东东 用它来设计界面很方便，只要是能想得到的界面，都能很轻松使用WPF设计出来（相比WIN FORM和MFC） 但是WPF缺点也很多，首先是运行库太大来，一个WPF程序没有个几十兆的内存是运行不起来的 其次就是本文的主题“花文字”了 “花文字”这里指的是WPF程序中文字显示时不清楚的状况 经研究发现 “花文字” 居然是WPF中ClearType搞的鬼，关闭ClearType就不会有花文字了 当然“花文字”也只是在特定显示器下的情况，笔者的显示器就不幸会产生花文字","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"WPF","slug":"WPF","permalink":"http://www.clarencep.com/tags/WPF/"}]},{"title":"C#中的自定义类型转换","slug":"p_2010_01_06_cs_learning_user_cast","date":"2010-01-06T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2010/01/06/p_2010_01_06_cs_learning_user_cast/","link":"","permalink":"http://www.clarencep.com/2010/01/06/p_2010_01_06_cs_learning_user_cast/","excerpt":"cnblogs Post date: 2010-01-06 20:56 C#中一个继承自C++的优良特性是可以自定义类型转换。 以前在C++中这样写：","text":"cnblogs Post date: 2010-01-06 20:56 C#中一个继承自C++的优良特性是可以自定义类型转换。 以前在C++中这样写： class CBrush{ //摘自MFC中CBrush类的部分代码。 public: operator HBRUSH() const; }; 在C#中也有类似的写法，不过要注意的是C#中这种类型转换函数必须是静态的，相比较与C++，C++中的类型转换则就没有这样的限制。 此外，自定义类型转换可以设置修饰符explicit或implicit。explicit表示显式，也就是在使用这个转换时必须显式写在代码中。implicit修饰符表示隐式，隐式使用即使用时不必要显式写出来，如下例： class A{ public static explicit operator A(B b){省略内容} //这是一个显式转换 public static implicit operator B(A a){省略内容} //这是一个隐式转换 } B b=new B(); A a=(A)b; //显式使用显式转换 b=a; //隐式使用隐式转换 自定义转换还需要注意的一点与as这个运算符有关。as一般情况下相当于 expression is type ? (type)expression : (type)null但只计算一次 expression。as 运算符只执行引用转换和装箱转换。as 运算符无法执行其他转换，如用户定义的转换，这类转换应使用强制转换表达式来执行。 然后就是发现在值类型和引用类型之间的自定义转换比较麻烦,装箱和不装箱的值类型在转换时的行为是有区别的。 下面的MyInt是一个引用类型，用作测试和值类型int之间的转换。 class MyInt { int data; public MyInt():this(10){} public MyInt(int val) { data = val; } public static explicit operator int(MyInt x) { return x.data; } public static explicit operator MyInt(int x) { MyInt a = new MyInt(); a.data = x; return a; } public override string ToString() { return data.ToString(); } } static void Main(string[] args) { try { MyInt myInt = new MyInt(); int t = 100; myInt = (MyInt)t; //执行自定义转换 operator MyInt(int) Console.WriteLine(&quot;myInt={0}&quot;, (myInt == null ? &quot;null&quot; : myInt.ToString())); //myInt=100 int x = (int)myInt; //执行自定义转换 operator int(MyInt) Console.WriteLine(&quot;x={0}&quot;, x); //x=100 // myInt = x as MyInt; //错误CS0039: 无法通过引用转换、装箱转换、取消装箱转换、包装转换或 Null 类型转换将类型“int”转换为“MyInt” object xobj = x; //把x装箱 myInt = xobj as MyInt; //as不会调用自定义转换 Console.WriteLine(&quot;myInt={0}&quot;, (myInt == null ? &quot;null&quot; : myInt.ToString())); //myInt=null myInt = (MyInt)xobj; //装箱后这样转换会出异常 //必须要显式拆箱再转换，如:myInt=(MyInt)(int)xobj; Console.WriteLine(&quot;myInt={0}&quot;, (myInt == null ? &quot;null&quot; : myInt.ToString())); //这一句不会执行 } catch(Exception e) { Console.Error.WriteLine(e); //System.InvalidCastException ... } }","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"Type Convertion","slug":"Type-Convertion","permalink":"http://www.clarencep.com/tags/Type-Convertion/"}]},{"title":"用于XML格式存储的工具类","slug":"p_2009_12_12_DotNetEx_XmlFormater","date":"2009-12-12T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2009/12/12/p_2009_12_12_DotNetEx_XmlFormater/","link":"","permalink":"http://www.clarencep.com/2009/12/12/p_2009_12_12_DotNetEx_XmlFormater/","excerpt":"cnblogs Post date: 2009-12-12 23:37 最近很喜欢使用XML(C#的Linq to XML)。写个类后总想把它能用XML文件保存起来，一般我都是写个ToXElement函数然后在里面……","text":"cnblogs Post date: 2009-12-12 23:37 最近很喜欢使用XML(C#的Linq to XML)。写个类后总想把它能用XML文件保存起来，一般我都是写个ToXElement函数然后在里面…… 今天写烦了，想写一个通用的工具类，以便很方便地把一个类保存化为XML。 看看写出来的结果： /************************************************************************\\ * 把一个对象格式化为XML（元素），即： * 1、该XML元素的名字为该对象的类型 * 2、对该对象中每一个公共属性（Property）转换为字符串（String） * 保存到XML元素的属性中 * 把一个XML粘贴到一个对象中，即为上一过程的逆过程。 * * 对象信息保存到XML中（然后再保存到文件）很显然将具有很高的可读性 \\************************************************************************/ using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Xml.Linq; namespace DotNetEx.FormatAsXml { /// &lt;summary&gt; /// 标识能格式化为XML，可以被用在类和结构上，不可以继承，不支持多重标记 /// &lt;/summary&gt; [AttributeUsage(AttributeTargets.Class|AttributeTargets.Struct, Inherited = false, AllowMultiple = false)] public sealed class CanFormatToXmlAttribute : Attribute { public CanFormatToXmlAttribute () { } } /// &lt;summary&gt; /// 标识该属性不用被格式化 /// &lt;/summary&gt; [AttributeUsage(AttributeTargets.Property,Inherited=false, AllowMultiple=false)] public sealed class DonotFormatToXmlAttribute:Attribute { public DonotFormatToXmlAttribute(){} } /// &lt;summary&gt; /// 格式化为XML的格式器 /// &lt;/summary&gt; public static class XmlFormater { /// &lt;summary&gt; /// 把一个对象格式化为XML，这个对象必须有CanFormatToXml属性（Attribute） /// &lt;/summary&gt; /// &lt;param name=&quot;o&quot;&gt;要格式的对象&lt;/param&gt; /// &lt;returns&gt;格式化的XML元素&lt;/returns&gt; /// &lt;exception type=&quot;UnsurportedTypeException&quot;&gt;输入的对象的类型必须是支持格式化为XML的类型（有CanFormatToXml属性）&lt;/exception&gt; /// &lt;exception type=&quot;ArgumentNullException&quot;&gt;输入的对象不能为NULL&lt;/exception&gt; public static XElement ToXElement(object o){ if(o==null){ throw new ArgumentNullException(&quot;o&quot;); } Type t=o.GetType(); var atts= t.GetCustomAttributes(typeof(CanFormatToXmlAttribute),false); if(atts.Length==0){ throw new UnsurportedTypeException(t); } XElement xml=new XElement(t.Name); var propertyInfos=t.GetProperties(); foreach (var proi in propertyInfos) { if(proi.CanRead){ if(proi.GetCustomAttributes(typeof(DonotFormatToXmlAttribute),false) .Length==0){ var pg = proi.GetGetMethod(); object ret = pg.Invoke(o, null); xml.Add(new XAttribute(proi.Name, Convert.ChangeType(ret, typeof(string)))); } } } return xml; } /// &lt;summary&gt; /// 从一个格式化好的XML中粘贴相关格式化信息到对象 /// &lt;/summary&gt; /// &lt;param name=&quot;xml&quot;&gt;输入的格式化好的XML&lt;/param&gt; /// &lt;param name=&quot;obj&quot;&gt;一个目标对象，其必须支持格式化为XML（有CanFormatToXml属性）&lt;/param&gt; public static void Pase(XElement xml, object obj){ if (xml == null) { throw new ArgumentNullException(&quot;xml&quot;); } if(obj==null){ throw new ArgumentNullException(&quot;obj&quot;); } Type type = obj.GetType(); if (( type.GetCustomAttributes(typeof(CanFormatToXmlAttribute), false) .Length == 0 ) || xml.Name!=type.Name ) { throw new UnsurportedTypeException(type); } var pis = type.GetProperties(); foreach (var pi in pis) { if(pi.CanWrite){ if(pi.GetCustomAttributes(typeof(DonotFormatToXmlAttribute),false) .Length==0){ var psm = pi.GetSetMethod(true); psm.Invoke(obj, new object[]{ Convert.ChangeType( xml.Attribute(pi.Name).Value, pi.PropertyType)} ); } } } } /// &lt;summary&gt; /// 不是支持格式化为XML（有CanFormatToXml属性）的类型 /// &lt;/summary&gt; public sealed class UnsurportedTypeException:Exception { public UnsurportedTypeException(Type t){ Type=t; } public Type Type{ private set; get; } public override string Message { get { return &quot;类型\\&quot;&quot;+Type+&quot;\\&quot;不支持格式化为XML&quot;; } } } } //* static class Test { [CanFormatToXml()] class Person{ public Person(String name ){ Name = name; } public string Name{ get; private set; } public int Age{ get; set; } public DateTime BirthDay { get; set; } [DonotFormatToXml()] public Person Test{ get; set; } } static void Main(){ Person p=new Person(&quot;Hack&quot;){ BirthDay=new DateTime(1990,1,1), Age=19, Test=new Person(&quot;Test&quot;){ Age=20 } }; var x=XmlFormater.ToXElement(p); Console.WriteLine(x.ToString()); x.Attribute(&quot;Name&quot;).Value = &quot;Changed&quot;; XmlFormater.Pase(x, p); Console.WriteLine(XmlFormater.ToXElement(p).ToString()); } } //*/ } 那个静态类Test是用于测试的，测试结果： &lt;Person Name=&quot;Hack&quot; Age=&quot;19&quot; BirthDay=&quot;1990/1/1 0:00:00&quot; /\\&gt; &lt;Person Name=&quot;Changed&quot; Age=&quot;19&quot; BirthDay=&quot;1990/1/1 0:00:00&quot; /\\&gt; 还不错，能把一个对象的公有属性都写到XML元素中，反过来也能粘贴回对象。 原理分析：(代码很短很清晰，这里就不多说了) 从对象格式化到XML时，使用反射从Type得到属性信息，再得到属性的Getter，然后调用就行了；反过来也差不多。 注意那个Person.Name属性，它的Setter是私有的，不过粘贴时也能正常工作。","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"XML","slug":"XML","permalink":"http://www.clarencep.com/tags/XML/"}]},{"title":"C#中解析并运行一个本地命令行","slug":"p_2009_11_20_cs_execute_cmdline","date":"2009-11-20T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2009/11/20/p_2009_11_20_cs_execute_cmdline/","link":"","permalink":"http://www.clarencep.com/2009/11/20/p_2009_11_20_cs_execute_cmdline/","excerpt":"cnblogs Post date: 2009-11-20 17:28前几天我想在一个程序中运行类似这样一个命令行“javac test.java”，环境变量我都设定得好好的，但使用Process.Start时依旧会有找不到文件的异常。后来发现Process.Start函数不支持自动搜索PATH环境变量。","text":"cnblogs Post date: 2009-11-20 17:28前几天我想在一个程序中运行类似这样一个命令行“javac test.java”，环境变量我都设定得好好的，但使用Process.Start时依旧会有找不到文件的异常。后来发现Process.Start函数不支持自动搜索PATH环境变量。 很是郁闷。闲着没事，写了个能搜索PATH的运行命令行函数Execute()，详见下面代码。 /// &lt;summary&gt; /// 运行一个命令 /// &lt;/summary&gt; /// &lt;param name=&quot;cmdLine&quot;&gt;要运行的命令行&lt;/param&gt; /// &lt;param name=&quot;workDirectory&quot;&gt;命令的工作目录&lt;/param&gt; /// &lt;returns&gt;该命令对应的进程&lt;/returns&gt; public static Process Execute(string cmdLine, string workDirectory) { string fileName; string args; SplitCmdLineIntoFileAndArg(cmdLine, out fileName, out args); Process pro = null; pro = Process.Start(new ProcessStartInfo() { FileName = fileName, Arguments = args, WorkingDirectory = workDirectory, }); return pro; } 其中最重要的莫过于如何寻找可执行文件所在路径了。我们知道windows和Linux中都有个环境变量PATH，其中包含了可执行文件的搜索路径，于是寻找可执行文件路径的问题就很容易解决了。这时我又想到：在windows中命令行中的可执行文件的扩展名经常可以被省略。如何才能给文件填上扩展名呢？这要牵扯到另外一个环境变量了——PATHEXT，它包含可执行文件的扩展名，其顺序就是命令行可执行文件的搜索顺序。如此一来整个问题就解决了。其代码如下： /// &lt;summary&gt; /// 把命令行分割为文件名和参数 /// &lt;/summary&gt; /// &lt;param name=&quot;cmdLine&quot;&gt;输入的命令行，不能为null&lt;/param&gt; /// &lt;param name=&quot;fileName&quot;&gt;输出的文件名&lt;/param&gt; /// &lt;param name=&quot;args&quot;&gt;参数&lt;/param&gt; /// &lt;exception name=&quot;FileNotFoundException&quot;&gt;找不到相应的可执行文件，命令行无法解析&lt;/exception&gt; static void SplitCmdLineIntoFileAndArg(string cmdLine, out string fileName, out string args) { if (cmdLine == null) throw new ArgumentNullException(&quot;cmdLine&quot;, &quot;cmdLine必须是有效的命令行&quot;); fileName = string.Empty; args = string.Empty; bool hasFound = false; //环境变量path，可执行文件的路径 string path = Environment.GetEnvironmentVariable(&quot;path&quot;)+&quot;;.&quot;; var splitedPath = path.Split(&#39;;&#39;); //环境变量pathext，可执行文件的扩展名 string pathext = Environment.GetEnvironmentVariable(&quot;pathext&quot;); string[] splitedPathext = pathext.Split(&#39;;&#39;); //有些系统中可能没有这个变量，那么就忽略扩展名 if (splitedPathext == null || splitedPathext.Length == 0) { splitedPathext = new string[] { string.Empty }; } for (int i = 0; i &lt;= cmdLine.Length; ++i) { //命令行由空白字符分割，而可执行文件名就是第一个参数。有可能其路径中包含空白字符，故搜索时还要向后搜索 if (i == cmdLine.Length || char.IsWhiteSpace(cmdLine, i)) { hasFound = false; string partFileName=cmdLine.Substring(0,i); foreach (string pathx in splitedPath) { fileName = pathx + &quot;\\\\\\\\&quot; + partFileName; if (File.Exists(fileName)) { hasFound = true; break; } else { foreach (string pathextx in splitedPathext) { fileName = pathx + &quot;\\\\\\\\&quot; + partFileName + pathextx; if (File.Exists(fileName)) { hasFound = true; break; } } } if (hasFound) break; } if (hasFound) { i++; if (i &gt;= cmdLine.Length) args = string.Empty; else args = cmdLine.Substring(i); break; } } } if (!hasFound) { throw new FileNotFoundException(&quot;无法找到文件\\\\&quot;&quot;+cmdLine+&#39;&quot;&#39;, cmdLine); } } 测试一下： static void Main(string[] args) { Stopwatch sw = new Stopwatch(); try { sw.Start(); Process pro = Execute(&quot;winver&quot;, &quot;.&quot;); sw.Stop(); Console.WriteLine(pro.StartInfo.FileName + &quot; &quot; + pro.StartInfo.Arguments); Console.WriteLine(&quot;elapsed:{0}&quot;, sw.ElapsedMilliseconds); pro.WaitForExit(10000); } catch(Exception e) { Console.Error.WriteLine(e.ToString()); } } 运行结果： **C:\\\\windows\\\\system32\\\\winver.EXE** **elapsed:77** ****","categories":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/categories/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"commandline","slug":"commandline","permalink":"http://www.clarencep.com/tags/commandline/"}]},{"title":"我的VS插件——保存即编译","slug":"p_2009_11_09_vsAddin-SaveToBuild","date":"2009-11-09T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2009/11/09/p_2009_11_09_vsAddin-SaveToBuild/","link":"","permalink":"http://www.clarencep.com/2009/11/09/p_2009_11_09_vsAddin-SaveToBuild/","excerpt":"cnblogs Post date: 2009-11-09 14:44 今天使用Eclipse时突发奇想：给VS2008做个插件，实现保存文件就编译。","text":"cnblogs Post date: 2009-11-09 14:44 今天使用Eclipse时突发奇想：给VS2008做个插件，实现保存文件就编译。 这个想法的缘自一个很烦人的问题：我的VS2008中的快捷键老是会变，如“编译”这个命令有时是F7,有时是F6，有些诡异。我也懒得去记这些快捷键，所以想找一个简单的方法来解决，想到CTL+S这个是一个从来不变的快捷键，又由于我们保存文件时通常是一些工作已经做好了，这时无疑很适合编译。 选择什么工具来解决呢？ Eclipse提醒我，可以在VS2008中也可以弄个插件。 想到就去做，VS2008中提供了“Visual Studio外接程序”的模板。 使用该模板创建一个工程后，该想一想怎么加入什么样的代码。 分析一下“保存即编译”的目标，程序必须要实现： 能捕获“文档保存”这样的事件； 能“编译”整个工程/解决方案。 文档保存和编译都是VS的活动，一个插件怎么获取VS的活动呢？ 需要慢慢分析模板代码啦…… 从VS自动生成的代码可以看到程序的主体是一个类： public class Connect : IDTExtensibility2, IDTCommandTarget; 它有两个字段： private DTE2 _applicationObject; private AddIn _addInInstance; 分析代码可以看到这两个将在 OnConnection(object application, ext_ConnectMode connectMode, object addInInst, ref Array custom)中获得赋值，而OnConnection()是在VS初始化加载插件时调用，而 _applicationObject=application 代表宿主应用程序的根对象，_addInInstance=addInInst 代表表示此外接程序的对象。 找到关键点了 “宿主应用程序” 在此自然代表VS啦，接下来看看能不能从_applicationObject得到些有用信息。 _applicationObject的类型是DTE2,查看其成员，我当然希望能直接找到个DocumentSave或DocumentSaving事件，再有一个Build方法就能直接解决问题了。可惜找了半天没找到，不过有替代方案:发现有Documents属性和ExecuteCommand方法。 从Documents中可以得到每一个Document，而Document中有个属性Saved能指示其是否被保存了，于是捕获文档保存事件的代码可以这样写： Timer monitorDocSaveTimer = new Timer(1000); //每1秒检测一遍 monitorDocSaveTimer.Elapsed += delegate(object sender, System.Timers.ElapsedEventArgs arg) { static bool _lastSaved=true; bool curSaved=true; //文件保存 是指 所有文件都保存 所以用到遍历 foreach (Document doc in _applicationObject.Documents) { if (!doc.Saved) curSaved = false; } if(!_lastSaved &amp;&amp; curSaved) { //此时刻前文件保存了 Build();//可以编译了，该方法见下文 } _lastSaved=curSaved; }; 为了方便阅读这里用匿名方法来写，实际中可以另外定义个函数来创建委托。 文件保存事件现在能被检测到了，可是怎么编译项目呢？ 这就用到了ExecuteCommand()了，它有两个参数分别代表要执行的命令和其命令参数，这里的命令是指可以在VS“命令窗口”中执行的命令，刚好其中有一个命令是Build.BuildSolution可以编译整个解决方案，当然编译单个工程的命令也有，这里就直接使用编译整个解决方案的了。如此，Build方法可以如下： void Build() { _applicationObject.ExecuteCommand(&quot;Build.BuildSolution&quot;, &quot;&quot;); } 这样以来整个插件的功能点已经都有了。 再随便加点用户配置和异常处理的模块就能用了。","categories":[{"name":"Visual Studio","slug":"Visual-Studio","permalink":"http://www.clarencep.com/categories/Visual-Studio/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.clarencep.com/tags/C/"},{"name":"Visual Studio Extension","slug":"Visual-Studio-Extension","permalink":"http://www.clarencep.com/tags/Visual-Studio-Extension/"},{"name":"Visual Studio","slug":"Visual-Studio","permalink":"http://www.clarencep.com/tags/Visual-Studio/"}]},{"title":"About Windows Live Writer","slug":"p_2009_11_09_1599112","date":"2009-11-09T00:00:00.000Z","updated":"2017-10-25T03:09:10.848Z","comments":true,"path":"2009/11/09/p_2009_11_09_1599112/","link":"","permalink":"http://www.clarencep.com/2009/11/09/p_2009_11_09_1599112/","excerpt":"","text":"cnblogs Post date: 2009-11-09 16:01 Windows Live Writer 也算是一个很好的编辑器了，但是我觉得并不适合我们程序员来用，主要缺憾是不能对代码区域进行语法着色，真不知道博客园为什么推荐使用Windows Live Writer。","categories":[{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/categories/blog/"}],"tags":[{"name":"blog","slug":"blog","permalink":"http://www.clarencep.com/tags/blog/"},{"name":"Live Writer","slug":"Live-Writer","permalink":"http://www.clarencep.com/tags/Live-Writer/"}]}]}